define(["./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-6f81ad4c","./RuntimeError-2109023a","./WebGLConstants-76bb35d1","./ComponentDatatype-6d99a1ee","./GeometryAttribute-700c1da0","./GeometryAttributes-4fcfcf40","./AttributeCompression-9fc99391","./GeometryPipeline-e6a15a43","./EncodedCartesian3-4df2eabb","./IndexDatatype-53503fee","./IntersectionTests-7f3bcd5c","./Plane-b6058d9b","./VertexFormat-7572c785","./GeometryInstance-bee96382","./arrayRemoveDuplicates-ebc732b0","./BoundingRectangle-4f9baeda","./EllipsoidTangentPlane-c3f203b0","./OrientedBoundingBox-b5830afd","./CoplanarPolygonGeometryLibrary-5c5e85b0","./ArcType-dc1c5aee","./EllipsoidRhumbLine-c704bf4c","./PolygonPipeline-1aceedbc","./PolygonGeometryLibrary-82c2c5a4"],(function(e,t,a,n,r,o,i,l,s,c,p,y,m,u,d,g,b,h,f,C,v,x,P,w,A,F,G){"use strict";var L=new n.Cartesian3,E=new C.BoundingRectangle,T=new n.Cartesian2,D=new n.Cartesian2,_=new n.Cartesian3,k=new n.Cartesian3,V=new n.Cartesian3,R=new n.Cartesian3,I=new n.Cartesian3,M=new n.Cartesian3,H=new r.Quaternion,B=new r.Matrix3,O=new r.Matrix3,z=new n.Cartesian3;function S(t){var a=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).polygonHierarchy,r=e.defaultValue(t.vertexFormat,b.VertexFormat.DEFAULT);this._vertexFormat=b.VertexFormat.clone(r),this._polygonHierarchy=a,this._stRotation=e.defaultValue(t.stRotation,0),this._ellipsoid=n.Ellipsoid.clone(e.defaultValue(t.ellipsoid,n.Ellipsoid.WGS84)),this._workerName="createCoplanarPolygonGeometry",this.packedLength=G.PolygonGeometryLibrary.computeHierarchyPackedLength(a)+b.VertexFormat.packedLength+n.Ellipsoid.packedLength+2}S.fromPositions=function(t){return new S({polygonHierarchy:{positions:(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).positions},vertexFormat:t.vertexFormat,stRotation:t.stRotation,ellipsoid:t.ellipsoid})},S.pack=function(t,a,r){return r=e.defaultValue(r,0),r=G.PolygonGeometryLibrary.packPolygonHierarchy(t._polygonHierarchy,a,r),n.Ellipsoid.pack(t._ellipsoid,a,r),r+=n.Ellipsoid.packedLength,b.VertexFormat.pack(t._vertexFormat,a,r),r+=b.VertexFormat.packedLength,a[r++]=t._stRotation,a[r]=t.packedLength,a};var N=n.Ellipsoid.clone(n.Ellipsoid.UNIT_SPHERE),Q=new b.VertexFormat,j={polygonHierarchy:{}};return S.unpack=function(t,a,r){a=e.defaultValue(a,0);var o=G.PolygonGeometryLibrary.unpackPolygonHierarchy(t,a);a=o.startingIndex,delete o.startingIndex;var i=n.Ellipsoid.unpack(t,a,N);a+=n.Ellipsoid.packedLength;var l=b.VertexFormat.unpack(t,a,Q);a+=b.VertexFormat.packedLength;var s=t[a++];return a=t[a],e.defined(r)||(r=new S(j)),r._polygonHierarchy=o,r._ellipsoid=n.Ellipsoid.clone(i,r._ellipsoid),r._vertexFormat=b.VertexFormat.clone(l,r._vertexFormat),r._stRotation=s,r.packedLength=a,r},S.createGeometry=function(e){var t=e._vertexFormat,o=e._polygonHierarchy,i=e._stRotation,p=o.positions;if(!((p=f.arrayRemoveDuplicates(p,n.Cartesian3.equalsEpsilon,!0)).length<3)){var m=_,d=k,g=V,b=I,C=M;if(P.CoplanarPolygonGeometryLibrary.computeProjectTo2DArguments(p,R,b,C)){m=n.Cartesian3.cross(b,C,m),m=n.Cartesian3.normalize(m,m),n.Cartesian3.equalsEpsilon(R,n.Cartesian3.ZERO,a.CesiumMath.EPSILON6)||(v=e._ellipsoid.geodeticSurfaceNormal(R,z),n.Cartesian3.dot(m,v)<0&&(m=n.Cartesian3.negate(m,m),b=n.Cartesian3.negate(b,b)));var v=P.CoplanarPolygonGeometryLibrary.createProjectPointsTo2DFunction(R,b,C),x=P.CoplanarPolygonGeometryLibrary.createProjectPointTo2DFunction(R,b,C);t.tangent&&(d=n.Cartesian3.clone(b,d)),t.bitangent&&(g=n.Cartesian3.clone(C,g)),v=(o=G.PolygonGeometryLibrary.polygonsFromHierarchy(o,v,!1)).hierarchy;var w=o.polygons;if(0!==v.length){p=v[0].outerRing,o=r.BoundingSphere.fromPoints(p);for(var A=G.PolygonGeometryLibrary.computeBoundingRectangle(m,x,p,i,E),S=[],N=0;N<w.length;N++){var Q=new h.GeometryInstance({geometry:function(e,t,o,i,p,y,m,d){var g=e.positions,b=F.PolygonPipeline.triangulate(e.positions2D,e.holes);b.length<3&&(b=[0,1,2]),(e=u.IndexDatatype.createTypedArray(g.length,b.length)).set(b);var h=B;0!==i?(b=r.Quaternion.fromAxisAngle(y,i,H),h=r.Matrix3.fromQuaternion(b,h),(t.tangent||t.bitangent)&&(b=r.Quaternion.fromAxisAngle(y,-i,H),v=r.Matrix3.fromQuaternion(b,O),m=n.Cartesian3.normalize(r.Matrix3.multiplyByVector(v,m,m),m),t.bitangent&&(d=n.Cartesian3.normalize(n.Cartesian3.cross(y,m,d),d)))):h=r.Matrix3.clone(r.Matrix3.IDENTITY,h);var f=D;t.st&&(f.x=o.x,f.y=o.y);for(var C=g.length,v=3*C,x=new Float64Array(v),P=t.normal?new Float32Array(v):void 0,w=t.tangent?new Float32Array(v):void 0,A=t.bitangent?new Float32Array(v):void 0,G=t.st?new Float32Array(2*C):void 0,E=0,_=0,k=0,V=0,R=0,I=0;I<C;I++){var M,z=g[I];x[E++]=z.x,x[E++]=z.y,x[E++]=z.z,t.st&&(M=p(r.Matrix3.multiplyByVector(h,z,L),T),n.Cartesian2.subtract(M,f,M),z=a.CesiumMath.clamp(M.x/o.width,0,1),M=a.CesiumMath.clamp(M.y/o.height,0,1),G[R++]=z,G[R++]=M),t.normal&&(P[_++]=y.x,P[_++]=y.y,P[_++]=y.z),t.tangent&&(w[V++]=m.x,w[V++]=m.y,w[V++]=m.z),t.bitangent&&(A[k++]=d.x,A[k++]=d.y,A[k++]=d.z)}return v=new c.GeometryAttributes,t.position&&(v.position=new s.GeometryAttribute({componentDatatype:l.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:x})),t.normal&&(v.normal=new s.GeometryAttribute({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:P})),t.tangent&&(v.tangent=new s.GeometryAttribute({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:w})),t.bitangent&&(v.bitangent=new s.GeometryAttribute({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:A})),t.st&&(v.st=new s.GeometryAttribute({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:G})),new s.Geometry({attributes:v,indices:e,primitiveType:s.PrimitiveType.TRIANGLES})}(w[N],t,A,i,x,m,d,g)});S.push(Q)}return(v=y.GeometryPipeline.combineInstances(S)[0]).attributes.position.values=new Float64Array(v.attributes.position.values),v.indices=u.IndexDatatype.createTypedArray(v.attributes.position.values.length/3,v.indices),p=v.attributes,t.position||delete p.position,new s.Geometry({attributes:p,indices:v.indices,primitiveType:v.primitiveType,boundingSphere:o})}}}},function(t,a){return e.defined(a)&&(t=S.unpack(t,a)),S.createGeometry(t)}}));