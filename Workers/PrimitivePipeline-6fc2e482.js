define(["exports","./when-54c2dc71","./Check-6c0211bc","./Cartesian2-bddc1162","./Transforms-6f81ad4c","./ComponentDatatype-6d99a1ee","./GeometryAttribute-700c1da0","./GeometryAttributes-4fcfcf40","./GeometryPipeline-e6a15a43","./IndexDatatype-53503fee","./WebMercatorProjection-df58d479"],(function(e,t,r,n,i,o,a,s,d,p,u){"use strict";function c(e,r,n){e=t.defaultValue(e,0),r=t.defaultValue(r,0),n=t.defaultValue(n,0),this.value=new Float32Array([e,r,n])}function f(e,t){var r=e.attributes,n=(e=r.position).values.length/e.componentsPerAttribute;r.batchId=new a.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:1,values:new Float32Array(n)});for(var i=r.batchId.values,s=0;s<n;++s)i[s]=t}function m(e,r,n,i){var o,a,s,d=i.length-1;s=0<=d?(o=(d=i[d]).offset+d.count,n[a=d.index].indices.length):n[a=o=0].indices.length;for(var p=e.length,u=0;u<p;++u){var c=e[u][r];t.defined(c)&&(s<o+(c=c.indices.length)&&(o=0,s=n[++a].indices.length),i.push({index:a,offset:o,count:c}),o+=c)}}Object.defineProperties(c.prototype,{componentDatatype:{get:function(){return o.ComponentDatatype.FLOAT}},componentsPerAttribute:{get:function(){return 3}},normalize:{get:function(){return!1}}}),c.fromCartesian3=function(e){return new c(e.x,e.y,e.z)},c.toValue=function(e,r){return t.defined(r)||(r=new Float32Array([e.x,e.y,e.z])),r[0]=e.x,r[1]=e.y,r[2]=e.z,r};var h={};function l(e){var r=e.length,n=1+(i.BoundingSphere.packedLength+1)*r,o=new Float32Array(n),a=0;o[a++]=r;for(var s=0;s<r;++s){var d=e[s];t.defined(d)?(o[a++]=1,i.BoundingSphere.pack(e[s],o,a)):o[a++]=0,a+=i.BoundingSphere.packedLength}return o}function g(e){for(var t=new Array(e[0]),r=0,n=1;n<e.length;)1===e[n++]&&(t[r]=i.BoundingSphere.unpack(e,n)),++r,n+=i.BoundingSphere.packedLength;return t}h.combineGeometry=function(e){var r,n,a,s,p,u,c=e.instances,h=c.length,l=!1;0<h&&(0<(r=function(e){var r,n=e.instances,a=e.projection,s=e.elementIndexUintSupported,p=e.scene3DOnly,u=e.vertexCacheOptimize,c=e.compressVertices,m=(e=e.modelMatrix,n.length);for(x=0;x<m;++x)if(t.defined(n[x].geometry)){n[x].geometry.primitiveType;break}if(function(e,r){var n=!p,o=e.length;if(!n&&1<o)for(var a=e[0].modelMatrix,s=1;s<o;++s)if(!i.Matrix4.equals(a,e[s].modelMatrix)){n=!0;break}if(n)for(s=0;s<o;++s)t.defined(e[s].geometry)&&d.GeometryPipeline.transformToWorldCoordinates(e[s]);else i.Matrix4.multiplyTransformation(r,e[0].modelMatrix,r)}(n,e),!p)for(x=0;x<m;++x)t.defined(n[x].geometry)&&d.GeometryPipeline.splitLongitude(n[x]);if(function(e){for(var r=e.length,n=0;n<r;++n){var i=e[n];t.defined(i.geometry)?f(i.geometry,n):t.defined(i.westHemisphereGeometry)&&t.defined(i.eastHemisphereGeometry)&&(f(i.westHemisphereGeometry,n),f(i.eastHemisphereGeometry,n))}}(n),u)for(x=0;x<m;++x){var h=n[x];t.defined(h.geometry)?(d.GeometryPipeline.reorderForPostVertexCache(h.geometry),d.GeometryPipeline.reorderForPreVertexCache(h.geometry)):t.defined(h.westHemisphereGeometry)&&t.defined(h.eastHemisphereGeometry)&&(d.GeometryPipeline.reorderForPostVertexCache(h.westHemisphereGeometry),d.GeometryPipeline.reorderForPreVertexCache(h.westHemisphereGeometry),d.GeometryPipeline.reorderForPostVertexCache(h.eastHemisphereGeometry),d.GeometryPipeline.reorderForPreVertexCache(h.eastHemisphereGeometry))}var l=d.GeometryPipeline.combineInstances(n);for(m=l.length,x=0;x<m;++x){var g,y,b,v=(r=l[x]).attributes;if(p)for(g in v)v.hasOwnProperty(g)&&v[g].componentDatatype===o.ComponentDatatype.DOUBLE&&d.GeometryPipeline.encodeAttribute(r,g,g+"3DHigh",g+"3DLow");else for(g in v)v.hasOwnProperty(g)&&v[g].componentDatatype===o.ComponentDatatype.DOUBLE&&(y=g+"3D",b=g+"2D",d.GeometryPipeline.projectTo2D(r,g,y,b,a),t.defined(r.boundingSphere)&&"position"===g&&(r.boundingSphereCV=i.BoundingSphere.fromVertices(r.attributes.position2D.values)),d.GeometryPipeline.encodeAttribute(r,y,y+"High",y+"Low"),d.GeometryPipeline.encodeAttribute(r,b,b+"High",b+"Low"));c&&d.GeometryPipeline.compressVertices(r)}if(!s){for(var G=[],x=(m=l.length,0);x<m;++x)r=l[x],G=G.concat(d.GeometryPipeline.fitToUnsignedShortIndices(r));l=G}return l}(e)).length&&(n=d.GeometryPipeline.createAttributeLocations(r[0]),e.createPickOffsets&&(m(s=c,"geometry",p=r,u=[]),m(s,"westHemisphereGeometry",p,u),m(s,"eastHemisphereGeometry",p,u),u=u)),t.defined(c[0].attributes)&&t.defined(c[0].attributes.offset)&&(a=new Array(h),l=!0));for(var g=new Array(h),y=new Array(h),b=0;b<h;++b){var v=c[b],G=v.geometry;t.defined(G)&&(g[b]=G.boundingSphere,y[b]=G.boundingSphereCV,l&&(a[b]=v.geometry.offsetAttribute)),G=v.eastHemisphereGeometry,v=v.westHemisphereGeometry,t.defined(G)&&t.defined(v)&&(t.defined(G.boundingSphere)&&t.defined(v.boundingSphere)&&(g[b]=i.BoundingSphere.union(G.boundingSphere,v.boundingSphere)),t.defined(G.boundingSphereCV)&&t.defined(v.boundingSphereCV)&&(y[b]=i.BoundingSphere.union(G.boundingSphereCV,v.boundingSphereCV)))}return{geometries:r,modelMatrix:e.modelMatrix,attributeLocations:n,pickOffsets:u,offsetInstanceExtend:a,boundingSpheres:g,boundingSpheresCV:y}},h.packCreateGeometryResults=function(e,r){var n=new Float64Array(function(e){for(var r=1,n=e.length,o=0;o<n;o++){var a=e[o];if(++r,t.defined(a)){var s,d=a.attributes;for(s in r+=7+2*i.BoundingSphere.packedLength+(t.defined(a.indices)?a.indices.length:0),d)d.hasOwnProperty(s)&&t.defined(d[s])&&(r+=5+d[s].values.length)}}return r}(e)),o=[],a={},s=e.length,d=0;n[d++]=s;for(var p=0;p<s;p++){var u=e[p],c=t.defined(u);if(n[d++]=c?1:0,c){n[d++]=u.primitiveType,n[d++]=u.geometryType,n[d++]=t.defaultValue(u.offsetAttribute,-1),c=t.defined(u.boundingSphere)?1:0,(n[d++]=c)&&i.BoundingSphere.pack(u.boundingSphere,n,d),d+=i.BoundingSphere.packedLength,c=t.defined(u.boundingSphereCV)?1:0,(n[d++]=c)&&i.BoundingSphere.pack(u.boundingSphereCV,n,d),d+=i.BoundingSphere.packedLength;var f,m=u.attributes,h=[];for(f in m)m.hasOwnProperty(f)&&t.defined(m[f])&&(h.push(f),t.defined(a[f])||(a[f]=o.length,o.push(f)));n[d++]=h.length;for(var l=0;l<h.length;l++){var g=h[l],y=m[g];n[d++]=a[g],n[d++]=y.componentDatatype,n[d++]=y.componentsPerAttribute,n[d++]=y.normalize?1:0,n[d++]=y.values.length,n.set(y.values,d),d+=y.values.length}c=t.defined(u.indices)?u.indices.length:0,0<(n[d++]=c)&&(n.set(u.indices,d),d+=c)}}return r.push(n.buffer),{stringTable:o,packedData:n}},h.unpackCreateGeometryResults=function(e){for(var t=e.stringTable,r=e.packedData,n=new Array(r[0]),d=0,u=1;u<r.length;)if(1===r[u++]){var c,f,m=r[u++],h=r[u++],l=r[u++];-1===l&&(l=void 0),1===r[u++]&&(c=i.BoundingSphere.unpack(r,u)),u+=i.BoundingSphere.packedLength,1===r[u++]&&(f=i.BoundingSphere.unpack(r,u)),u+=i.BoundingSphere.packedLength;var g=new s.GeometryAttributes,y=r[u++];for(A=0;A<y;A++){for(var b=t[r[u++]],v=r[u++],G=r[u++],x=0!==r[u++],S=r[u++],P=o.ComponentDatatype.createTypedArray(v,S),k=0;k<S;k++)P[k]=r[u++];g[b]=new a.GeometryAttribute({componentDatatype:v,componentsPerAttribute:G,normalize:x,values:P})}if(0<(S=r[u++]))for(var C=P.length/G,w=p.IndexDatatype.createTypedArray(C,S),A=0;A<S;A++)w[A]=r[u++];n[d++]=new a.Geometry({primitiveType:m,geometryType:h,boundingSphere:c,boundingSphereCV:f,indices:w,attributes:g,offsetAttribute:l})}else n[d++]=void 0;return n},h.packCombineGeometryParameters=function(e,r){for(var n=e.createGeometryResults,o=n.length,a=0;a<o;a++)r.push(n[a].packedData.buffer);return{createGeometryResults:e.createGeometryResults,packedInstances:function(e,r){var n=e.length,o=new Float64Array(1+19*n),a=0;o[a++]=n;for(var s=0;s<n;s++){var d=e[s];i.Matrix4.pack(d.modelMatrix,o,a),a+=i.Matrix4.packedLength,t.defined(d.attributes)&&t.defined(d.attributes.offset)&&(d=d.attributes.offset.value,o[a]=d[0],o[a+1]=d[1],o[a+2]=d[2]),a+=3}return r.push(o.buffer),o}(e.instances,r),ellipsoid:e.ellipsoid,isGeographic:e.projection instanceof i.GeographicProjection,elementIndexUintSupported:e.elementIndexUintSupported,scene3DOnly:e.scene3DOnly,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:e.modelMatrix,createPickOffsets:e.createPickOffsets}},h.unpackCombineGeometryParameters=function(e){for(var r=function(e){for(var r=e,n=new Array(r[0]),o=0,a=1;a<r.length;){var s,d=i.Matrix4.unpack(r,a);a+=i.Matrix4.packedLength,t.defined(r[a])&&(s={offset:new c(r[a],r[a+1],r[a+2])}),a+=3,n[o++]={modelMatrix:d,attributes:s}}return n}(e.packedInstances),o=e.createGeometryResults,a=o.length,s=0,d=0;d<a;d++)for(var p=h.unpackCreateGeometryResults(o[d]),f=p.length,m=0;m<f;m++){var l=p[m];r[s].geometry=l,++s}var g=n.Ellipsoid.clone(e.ellipsoid);return{instances:r,ellipsoid:g,projection:new(e.isGeographic?i.GeographicProjection:u.WebMercatorProjection)(g),elementIndexUintSupported:e.elementIndexUintSupported,scene3DOnly:e.scene3DOnly,vertexCacheOptimize:e.vertexCacheOptimize,compressVertices:e.compressVertices,modelMatrix:i.Matrix4.clone(e.modelMatrix),createPickOffsets:e.createPickOffsets}},h.packCombineGeometryResults=function(e,r){t.defined(e.geometries)&&function(e,r){for(var n=e.length,i=0;i<n;++i)!function(e,r){var n,i,o=e.attributes;for(n in o)o.hasOwnProperty(n)&&(i=o[n],t.defined(i)&&t.defined(i.values)&&r.push(i.values.buffer));t.defined(e.indices)&&r.push(e.indices.buffer)}(e[i],r)}(e.geometries,r);var n=l(e.boundingSpheres),i=l(e.boundingSpheresCV);return r.push(n.buffer,i.buffer),{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:n,boundingSpheresCV:i}},h.unpackCombineGeometryResults=function(e){return{geometries:e.geometries,attributeLocations:e.attributeLocations,modelMatrix:e.modelMatrix,pickOffsets:e.pickOffsets,offsetInstanceExtend:e.offsetInstanceExtend,boundingSpheres:g(e.boundingSpheres),boundingSpheresCV:g(e.boundingSpheresCV)}},e.PrimitivePipeline=h}));