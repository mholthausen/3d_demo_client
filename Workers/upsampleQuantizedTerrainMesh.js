define(["./AttributeCompression-8ecc041c","./Transforms-e9dbfb40","./Cartesian2-49b1de22","./when-54c2dc71","./TerrainEncoding-2b05357a","./IndexDatatype-46306178","./Check-6c0211bc","./Math-44e92d6b","./OrientedBoundingBox-3669ebd4","./createTaskProcessorWorker","./RuntimeError-2109023a","./ComponentDatatype-6d99a1ee","./WebGLConstants-76bb35d1","./EllipsoidTangentPlane-c4704d0f","./IntersectionTests-6ead8677","./Plane-8f7e53d1"],(function(e,t,i,n,s,r,h,u,o,p,a,d,f,l,c,g){"use strict";var m=function(e,t,i,s,r,h){var u,o,p,a,d,f,l,c,g;return n.defined(h)?h.length=0:h=[],p=t?(u=i<e,o=s<e,r<e):(u=e<i,o=e<s,e<r),1===(t=u+o+p)?u?(a=(e-i)/(s-i),d=(e-i)/(r-i),h.push(1),h.push(2),1!==d&&(h.push(-1),h.push(0),h.push(2),h.push(d)),1!==a&&(h.push(-1),h.push(0),h.push(1),h.push(a))):o?(f=(e-s)/(r-s),l=(e-s)/(i-s),h.push(2),h.push(0),1!==l&&(h.push(-1),h.push(1),h.push(0),h.push(l)),1!==f&&(h.push(-1),h.push(1),h.push(2),h.push(f))):p&&(c=(e-r)/(i-r),g=(e-r)/(s-r),h.push(0),h.push(1),1!==g&&(h.push(-1),h.push(2),h.push(1),h.push(g)),1!==c&&(h.push(-1),h.push(2),h.push(0),h.push(c))):2===t?u||i===e?o||s===e?p||r===e||(d=(e-i)/(r-i),f=(e-s)/(r-s),h.push(2),h.push(-1),h.push(0),h.push(2),h.push(d),h.push(-1),h.push(1),h.push(2),h.push(f)):(g=(e-r)/(s-r),a=(e-i)/(s-i),h.push(1),h.push(-1),h.push(2),h.push(1),h.push(g),h.push(-1),h.push(0),h.push(1),h.push(a)):(l=(e-s)/(i-s),c=(e-r)/(i-r),h.push(0),h.push(-1),h.push(1),h.push(0),h.push(l),h.push(-1),h.push(2),h.push(0),h.push(c)):3!==t&&(h.push(0),h.push(1),h.push(2)),h},x=32767,w=16383,C=[],v=[],B=[],y=new i.Cartographic,I=new i.Cartesian3,b=[],z=[],M=[],N=[],V=[],A=new i.Cartesian3,E=new t.BoundingSphere,R=new o.OrientedBoundingBox,H=new i.Cartesian2,T=new i.Cartesian3;function O(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}O.prototype.clone=function(e){return(e=n.defined(e)?e:new O).uBuffer=this.uBuffer,e.vBuffer=this.vBuffer,e.heightBuffer=this.heightBuffer,e.normalBuffer=this.normalBuffer,e.index=this.index,e.first=this.first,e.second=this.second,e.ratio=this.ratio,e},O.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},O.prototype.initializeFromClipResult=function(e,t,i){var n=t+1;return-1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},O.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},O.prototype.isIndexed=function(){return n.defined(this.index)},O.prototype.getH=function(){return n.defined(this.index)?this.heightBuffer[this.index]:u.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},O.prototype.getU=function(){return n.defined(this.index)?this.uBuffer[this.index]:u.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},O.prototype.getV=function(){return n.defined(this.index)?this.vBuffer[this.index]:u.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var U=new i.Cartesian2,F=-1,P=[new i.Cartesian3,new i.Cartesian3],S=[new i.Cartesian3,new i.Cartesian3];function k(t,n){var s=P[++F],r=S[F];return s=e.AttributeCompression.octDecode(t.first.getNormalX(),t.first.getNormalY(),s),r=e.AttributeCompression.octDecode(t.second.getNormalX(),t.second.getNormalY(),r),I=i.Cartesian3.lerp(s,r,t.ratio,I),i.Cartesian3.normalize(I,I),e.AttributeCompression.octEncode(I,n),--F,n}O.prototype.getNormalX=function(){return n.defined(this.index)?this.normalBuffer[2*this.index]:(U=k(this,U)).x},O.prototype.getNormalY=function(){return n.defined(this.index)?this.normalBuffer[2*this.index+1]:(U=k(this,U)).y};var D=[];function W(e,t,i,s,r,h,u,o,p){if(0!==u.length){for(var a=0,d=0;d<u.length;)d=D[a++].initializeFromClipResult(u,d,o);for(var f=0;f<a;++f){var l,c,g=D[f];g.isIndexed()?(g.newIndex=h[g.index],g.uBuffer=e,g.vBuffer=t,g.heightBuffer=i,p&&(g.normalBuffer=s)):(l=g.getKey(),n.defined(h[l])?g.newIndex=h[l]:(c=e.length,e.push(g.getU()),t.push(g.getV()),i.push(g.getH()),p&&(s.push(g.getNormalX()),s.push(g.getNormalY())),g.newIndex=c,h[l]=c))}3===a?(r.push(D[0].newIndex),r.push(D[1].newIndex),r.push(D[2].newIndex)):4===a&&(r.push(D[0].newIndex),r.push(D[1].newIndex),r.push(D[2].newIndex),r.push(D[0].newIndex),r.push(D[2].newIndex),r.push(D[3].newIndex))}}return D.push(new O),D.push(new O),D.push(new O),D.push(new O),p((function(e,n){var h=e.isEastChild,p=e.isNorthChild,a=h?w:0,d=h?x:w,f=p?w:0,l=p?x:w,c=b,g=z,U=M,F=V;c.length=0,g.length=0,U.length=0,F.length=0;var P=N;P.length=0;for(var S={},k=e.vertices,D=(D=e.indices).subarray(0,e.indexCountWithoutSkirts),X=s.TerrainEncoding.clone(e.encoding),K=X.hasVertexNormals,Y=e.exaggeration,L=0,_=e.vertexCountWithoutSkirts,G=e.minimumHeight,J=e.maximumHeight,Z=new Array(_),j=new Array(_),q=new Array(_),Q=K?new Array(2*_):void 0,$=0,ee=0;$<_;++$,ee+=2){var te=X.decodeTextureCoordinates(k,$,H),ie=X.decodeHeight(k,$)/Y,ne=u.CesiumMath.clamp(te.x*x|0,0,x),se=u.CesiumMath.clamp(te.y*x|0,0,x);q[$]=u.CesiumMath.clamp((ie-G)/(J-G)*x|0,0,x),x-(ne=ne<20?0:ne)<20&&(ne=x),x-(se=se<20?0:se)<20&&(se=x),Z[$]=ne,j[$]=se,K&&(te=X.getOctEncodedNormal(k,$,T),Q[ee]=te.x,Q[ee+1]=te.y),(h&&w<=ne||!h&&ne<=w)&&(p&&w<=se||!p&&se<=w)&&(S[$]=L,c.push(ne),g.push(se),U.push(q[$]),K&&(F.push(Q[ee]),F.push(Q[ee+1])),++L)}var re=[];re.push(new O),re.push(new O),re.push(new O);var he=[];for(he.push(new O),he.push(new O),he.push(new O),$=0;$<D.length;$+=3){var ue=D[$],oe=D[$+1],pe=D[$+2],ae=Z[ue],de=Z[oe],fe=Z[pe];re[0].initializeIndexed(Z,j,q,Q,ue),re[1].initializeIndexed(Z,j,q,Q,oe),re[2].initializeIndexed(Z,j,q,Q,pe),(de=m(w,h,ae,de,fe,C)).length<=0||(fe=he[0].initializeFromClipResult(de,0,re))>=de.length||(fe=he[1].initializeFromClipResult(de,fe,re))>=de.length||(fe=he[2].initializeFromClipResult(de,fe,re),W(c,g,U,F,P,S,m(w,p,he[0].getV(),he[1].getV(),he[2].getV(),v),he,K),fe<de.length&&(he[2].clone(he[1]),he[2].initializeFromClipResult(de,fe,re),W(c,g,U,F,P,S,m(w,p,he[0].getV(),he[1].getV(),he[2].getV(),v),he,K)))}var le=h?-x:0,ce=p?-x:0,ge=[],me=[],xe=[],we=[],Ce=Number.MAX_VALUE,ve=-Ce,Be=B;Be.length=0;var ye=i.Ellipsoid.clone(e.ellipsoid),Ie=(Te=i.Rectangle.clone(e.childRectangle)).north,be=Te.south,ze=Te.east,Me=Te.west;for(ze<Me&&(ze+=u.CesiumMath.TWO_PI),$=0;$<c.length;++$)ne=(ne=Math.round(c[$]))<=a?(ge.push($),0):d<=ne?(xe.push($),x):2*ne+le,c[$]=ne,se=(se=Math.round(g[$]))<=f?(me.push($),0):l<=se?(we.push($),x):2*se+ce,g[$]=se,(ie=u.CesiumMath.lerp(G,J,U[$]/x))<Ce&&(Ce=ie),ve<ie&&(ve=ie),U[$]=ie,y.longitude=u.CesiumMath.lerp(Me,ze,ne/x),y.latitude=u.CesiumMath.lerp(be,Ie,se/x),y.height=ie,ye.cartographicToCartesian(y,I),Be.push(I.x),Be.push(I.y),Be.push(I.z);var Ne=t.BoundingSphere.fromVertices(Be,i.Cartesian3.ZERO,3,E),Ve=o.OrientedBoundingBox.fromRectangle(Te,Ce,ve,ye,R),Ae=(e=new s.EllipsoidalOccluder(ye).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(Ne.center,Be,3,Ne.center,Ce,A),ve-Ce),Ee=new Uint16Array(c.length+g.length+U.length);for($=0;$<c.length;++$)Ee[$]=c[$];var Re=c.length;for($=0;$<g.length;++$)Ee[Re+$]=g[$];for(Re+=g.length,$=0;$<U.length;++$)Ee[Re+$]=x*(U[$]-Ce)/Ae;var He,Te=r.IndexDatatype.createTypedArray(c.length,P);return K?(He=new Uint8Array(F),n.push(Ee.buffer,Te.buffer,He.buffer),He=He.buffer):n.push(Ee.buffer,Te.buffer),{vertices:Ee.buffer,encodedNormals:He,indices:Te.buffer,minimumHeight:Ce,maximumHeight:ve,westIndices:ge,southIndices:me,eastIndices:xe,northIndices:we,boundingSphere:Ne,orientedBoundingBox:Ve,horizonOcclusionPoint:e}}))}));