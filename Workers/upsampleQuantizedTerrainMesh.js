define(["./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-6f81ad4c","./RuntimeError-2109023a","./WebGLConstants-76bb35d1","./ComponentDatatype-6d99a1ee","./AttributeCompression-9fc99391","./IndexDatatype-53503fee","./IntersectionTests-7f3bcd5c","./Plane-b6058d9b","./createTaskProcessorWorker","./EllipsoidTangentPlane-c3f203b0","./OrientedBoundingBox-b5830afd","./TerrainEncoding-31ac0bf2"],(function(e,t,i,n,s,r,h,u,o,p,a,d,f,l,c,g){"use strict";var m=function(t,i,n,s,r,h){var u,o,p,a,d,f,l,c,g;return e.defined(h)?h.length=0:h=[],p=i?(u=n<t,o=s<t,r<t):(u=t<n,o=t<s,t<r),1===(i=u+o+p)?u?(a=(t-n)/(s-n),d=(t-n)/(r-n),h.push(1),h.push(2),1!==d&&(h.push(-1),h.push(0),h.push(2),h.push(d)),1!==a&&(h.push(-1),h.push(0),h.push(1),h.push(a))):o?(f=(t-s)/(r-s),l=(t-s)/(n-s),h.push(2),h.push(0),1!==l&&(h.push(-1),h.push(1),h.push(0),h.push(l)),1!==f&&(h.push(-1),h.push(1),h.push(2),h.push(f))):p&&(c=(t-r)/(n-r),g=(t-r)/(s-r),h.push(0),h.push(1),1!==g&&(h.push(-1),h.push(2),h.push(1),h.push(g)),1!==c&&(h.push(-1),h.push(2),h.push(0),h.push(c))):2===i?u||n===t?o||s===t?p||r===t||(d=(t-n)/(r-n),f=(t-s)/(r-s),h.push(2),h.push(-1),h.push(0),h.push(2),h.push(d),h.push(-1),h.push(1),h.push(2),h.push(f)):(g=(t-r)/(s-r),a=(t-n)/(s-n),h.push(1),h.push(-1),h.push(2),h.push(1),h.push(g),h.push(-1),h.push(0),h.push(1),h.push(a)):(l=(t-s)/(n-s),c=(t-r)/(n-r),h.push(0),h.push(-1),h.push(1),h.push(0),h.push(l),h.push(-1),h.push(2),h.push(0),h.push(c)):3!==i&&(h.push(0),h.push(1),h.push(2)),h},x=32767,w=16383,C=[],v=[],B=[],y=new n.Cartographic,b=new n.Cartesian3,I=[],z=[],M=[],N=[],V=[],A=new n.Cartesian3,E=new s.BoundingSphere,R=new c.OrientedBoundingBox,H=new n.Cartesian2,T=new n.Cartesian3;function O(){this.vertexBuffer=void 0,this.index=void 0,this.first=void 0,this.second=void 0,this.ratio=void 0}O.prototype.clone=function(t){return e.defined(t)||(t=new O),t.uBuffer=this.uBuffer,t.vBuffer=this.vBuffer,t.heightBuffer=this.heightBuffer,t.normalBuffer=this.normalBuffer,t.index=this.index,t.first=this.first,t.second=this.second,t.ratio=this.ratio,t},O.prototype.initializeIndexed=function(e,t,i,n,s){this.uBuffer=e,this.vBuffer=t,this.heightBuffer=i,this.normalBuffer=n,this.index=s,this.first=void 0,this.second=void 0,this.ratio=void 0},O.prototype.initializeFromClipResult=function(e,t,i){var n=t+1;return-1!==e[t]?i[e[t]].clone(this):(this.vertexBuffer=void 0,this.index=void 0,this.first=i[e[n]],++n,this.second=i[e[n]],++n,this.ratio=e[n],++n),n},O.prototype.getKey=function(){return this.isIndexed()?this.index:JSON.stringify({first:this.first.getKey(),second:this.second.getKey(),ratio:this.ratio})},O.prototype.isIndexed=function(){return e.defined(this.index)},O.prototype.getH=function(){return e.defined(this.index)?this.heightBuffer[this.index]:i.CesiumMath.lerp(this.first.getH(),this.second.getH(),this.ratio)},O.prototype.getU=function(){return e.defined(this.index)?this.uBuffer[this.index]:i.CesiumMath.lerp(this.first.getU(),this.second.getU(),this.ratio)},O.prototype.getV=function(){return e.defined(this.index)?this.vBuffer[this.index]:i.CesiumMath.lerp(this.first.getV(),this.second.getV(),this.ratio)};var U=new n.Cartesian2,F=-1,P=[new n.Cartesian3,new n.Cartesian3],S=[new n.Cartesian3,new n.Cartesian3];function k(e,t){var i=P[++F],s=S[F];return i=o.AttributeCompression.octDecode(e.first.getNormalX(),e.first.getNormalY(),i),s=o.AttributeCompression.octDecode(e.second.getNormalX(),e.second.getNormalY(),s),b=n.Cartesian3.lerp(i,s,e.ratio,b),n.Cartesian3.normalize(b,b),o.AttributeCompression.octEncode(b,t),--F,t}O.prototype.getNormalX=function(){return e.defined(this.index)?this.normalBuffer[2*this.index]:(U=k(this,U)).x},O.prototype.getNormalY=function(){return e.defined(this.index)?this.normalBuffer[2*this.index+1]:(U=k(this,U)).y};var D=[];function W(t,i,n,s,r,h,u,o,p){if(0!==u.length){for(var a=0,d=0;d<u.length;)d=D[a++].initializeFromClipResult(u,d,o);for(var f=0;f<a;++f){var l,c,g=D[f];g.isIndexed()?(g.newIndex=h[g.index],g.uBuffer=t,g.vBuffer=i,g.heightBuffer=n,p&&(g.normalBuffer=s)):(l=g.getKey(),e.defined(h[l])?g.newIndex=h[l]:(c=t.length,t.push(g.getU()),i.push(g.getV()),n.push(g.getH()),p&&(s.push(g.getNormalX()),s.push(g.getNormalY())),g.newIndex=c,h[l]=c))}3===a?(r.push(D[0].newIndex),r.push(D[1].newIndex),r.push(D[2].newIndex)):4===a&&(r.push(D[0].newIndex),r.push(D[1].newIndex),r.push(D[2].newIndex),r.push(D[0].newIndex),r.push(D[2].newIndex),r.push(D[3].newIndex))}}return D.push(new O),D.push(new O),D.push(new O),D.push(new O),f((function(e,t){var r=e.isEastChild,h=e.isNorthChild,u=r?w:0,o=r?x:w,a=h?w:0,d=h?x:w,f=I,l=z,U=M,F=V;f.length=0,l.length=0,U.length=0,F.length=0;var P=N;P.length=0;for(var S={},k=e.vertices,D=(D=e.indices).subarray(0,e.indexCountWithoutSkirts),X=g.TerrainEncoding.clone(e.encoding),K=X.hasVertexNormals,Y=e.exaggeration,L=0,_=e.vertexCountWithoutSkirts,G=e.minimumHeight,J=e.maximumHeight,Z=new Array(_),j=new Array(_),q=new Array(_),Q=K?new Array(2*_):void 0,$=0,ee=0;$<_;++$,ee+=2){var te=X.decodeTextureCoordinates(k,$,H),ie=X.decodeHeight(k,$)/Y,ne=i.CesiumMath.clamp(te.x*x|0,0,x),se=i.CesiumMath.clamp(te.y*x|0,0,x);q[$]=i.CesiumMath.clamp((ie-G)/(J-G)*x|0,0,x),ne<20&&(ne=0),se<20&&(se=0),x-ne<20&&(ne=x),x-se<20&&(se=x),Z[$]=ne,j[$]=se,K&&(te=X.getOctEncodedNormal(k,$,T),Q[ee]=te.x,Q[ee+1]=te.y),(r&&w<=ne||!r&&ne<=w)&&(h&&w<=se||!h&&se<=w)&&(S[$]=L,f.push(ne),l.push(se),U.push(q[$]),K&&(F.push(Q[ee]),F.push(Q[ee+1])),++L)}var re=[];re.push(new O),re.push(new O),re.push(new O);var he=[];for(he.push(new O),he.push(new O),he.push(new O),$=0;$<D.length;$+=3){var ue=D[$],oe=D[$+1],pe=D[$+2],ae=Z[ue],de=Z[oe],fe=Z[pe];re[0].initializeIndexed(Z,j,q,Q,ue),re[1].initializeIndexed(Z,j,q,Q,oe),re[2].initializeIndexed(Z,j,q,Q,pe),(de=m(w,r,ae,de,fe,C)).length<=0||(fe=he[0].initializeFromClipResult(de,0,re))>=de.length||(fe=he[1].initializeFromClipResult(de,fe,re))>=de.length||(fe=he[2].initializeFromClipResult(de,fe,re),W(f,l,U,F,P,S,m(w,h,he[0].getV(),he[1].getV(),he[2].getV(),v),he,K),fe<de.length&&(he[2].clone(he[1]),he[2].initializeFromClipResult(de,fe,re),W(f,l,U,F,P,S,m(w,h,he[0].getV(),he[1].getV(),he[2].getV(),v),he,K)))}var le=r?-x:0,ce=h?-x:0,ge=[],me=[],xe=[],we=[],Ce=Number.MAX_VALUE,ve=-Ce,Be=B;Be.length=0;var ye=n.Ellipsoid.clone(e.ellipsoid),be=(Te=n.Rectangle.clone(e.childRectangle)).north,Ie=Te.south,ze=Te.east,Me=Te.west;for(ze<Me&&(ze+=i.CesiumMath.TWO_PI),$=0;$<f.length;++$)ne=(ne=Math.round(f[$]))<=u?(ge.push($),0):o<=ne?(xe.push($),x):2*ne+le,f[$]=ne,se=(se=Math.round(l[$]))<=a?(me.push($),0):d<=se?(we.push($),x):2*se+ce,l[$]=se,(ie=i.CesiumMath.lerp(G,J,U[$]/x))<Ce&&(Ce=ie),ve<ie&&(ve=ie),U[$]=ie,y.longitude=i.CesiumMath.lerp(Me,ze,ne/x),y.latitude=i.CesiumMath.lerp(Ie,be,se/x),y.height=ie,ye.cartographicToCartesian(y,b),Be.push(b.x),Be.push(b.y),Be.push(b.z);var Ne=s.BoundingSphere.fromVertices(Be,n.Cartesian3.ZERO,3,E),Ve=c.OrientedBoundingBox.fromRectangle(Te,Ce,ve,ye,R),Ae=(e=new g.EllipsoidalOccluder(ye).computeHorizonCullingPointFromVerticesPossiblyUnderEllipsoid(Ne.center,Be,3,Ne.center,Ce,A),ve-Ce),Ee=new Uint16Array(f.length+l.length+U.length);for($=0;$<f.length;++$)Ee[$]=f[$];var Re=f.length;for($=0;$<l.length;++$)Ee[Re+$]=l[$];for(Re+=l.length,$=0;$<U.length;++$)Ee[Re+$]=x*(U[$]-Ce)/Ae;var He,Te=p.IndexDatatype.createTypedArray(f.length,P);return K?(He=new Uint8Array(F),t.push(Ee.buffer,Te.buffer,He.buffer),He=He.buffer):t.push(Ee.buffer,Te.buffer),{vertices:Ee.buffer,encodedNormals:He,indices:Te.buffer,minimumHeight:Ce,maximumHeight:ve,westIndices:ge,southIndices:me,eastIndices:xe,northIndices:we,boundingSphere:Ne,orientedBoundingBox:Ve,horizonOcclusionPoint:e}}))}));