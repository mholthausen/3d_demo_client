define(["./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-6f81ad4c","./RuntimeError-2109023a","./WebGLConstants-76bb35d1","./ComponentDatatype-6d99a1ee","./AttributeCompression-9fc99391","./IndexDatatype-53503fee","./IntersectionTests-7f3bcd5c","./Plane-b6058d9b","./WebMercatorProjection-df58d479","./createTaskProcessorWorker","./EllipsoidTangentPlane-c3f203b0","./OrientedBoundingBox-b5830afd","./TerrainEncoding-31ac0bf2"],(function(e,t,r,n,i,o,a,s,d,c,u,h,l,I,m,g,T){"use strict";function p(){t.DeveloperError.throwInstantiationError()}Object.defineProperties(p.prototype,{errorEvent:{get:t.DeveloperError.throwInstantiationError},credit:{get:t.DeveloperError.throwInstantiationError},tilingScheme:{get:t.DeveloperError.throwInstantiationError},ready:{get:t.DeveloperError.throwInstantiationError},readyPromise:{get:t.DeveloperError.throwInstantiationError},hasWaterMask:{get:t.DeveloperError.throwInstantiationError},hasVertexNormals:{get:t.DeveloperError.throwInstantiationError},availability:{get:t.DeveloperError.throwInstantiationError}});var E=[];p.getRegularGridIndices=function(t,n){var i=E[t];e.defined(i)||(E[t]=i=[]);var o=i[n];return e.defined(o)||N(t,n,o=t*n<r.CesiumMath.SIXTY_FOUR_KILOBYTES?i[n]=new Uint16Array((t-1)*(n-1)*6):i[n]=new Uint32Array((t-1)*(n-1)*6),0),o};var f=[];p.getRegularGridIndicesAndEdgeIndices=function(t,r){var n=f[t];e.defined(n)||(f[t]=n=[]);var i,o,a,s,d=n[r];return e.defined(d)||(i=p.getRegularGridIndices(t,r),o=(s=v(t,r)).westIndicesSouthToNorth,a=s.southIndicesEastToWest,t=s.eastIndicesNorthToSouth,s=s.northIndicesWestToEast,d=n[r]={indices:i,westIndicesSouthToNorth:o,southIndicesEastToWest:a,eastIndicesNorthToSouth:t,northIndicesWestToEast:s}),d};var y=[];function v(e,t){for(var r=new Array(t),n=new Array(e),i=new Array(t),o=new Array(e),a=0;a<e;++a)n[o[a]=a]=e*t-1-a;for(a=0;a<t;++a)i[a]=(a+1)*e-1,r[a]=(t-a-1)*e;return{westIndicesSouthToNorth:r,southIndicesEastToWest:n,eastIndicesNorthToSouth:i,northIndicesWestToEast:o}}function N(e,t,r,n){for(var i=0,o=0;o<t-1;++o){for(var a=0;a<e-1;++a){var s=i+e,d=s+1,c=i+1;r[n++]=i,r[n++]=s,r[n++]=c,r[n++]=c,r[n++]=s,r[n++]=d,++i}++i}}function w(e,t,r,n){for(var i=e[0],o=e.length,a=1;a<o;++a){var s=e[a];r[n++]=i,r[n++]=s,r[n++]=t,r[n++]=t,r[n++]=s,r[n++]=t+1,i=s,++t}return n}p.getRegularGridAndSkirtIndicesAndEdgeIndices=function(t,r){var n=y[t];e.defined(n)||(y[t]=n=[]);var i,o,a,s,d,u,h,l,I=n[r];return e.defined(I)||(a=(i=t*r)+(u=2*t+2*r),l=(o=(t-1)*(r-1)*6)+6*Math.max(0,u-4),s=(h=v(t,r)).westIndicesSouthToNorth,d=h.southIndicesEastToWest,u=h.eastIndicesNorthToSouth,h=h.northIndicesWestToEast,N(t,r,l=c.IndexDatatype.createTypedArray(a,l),0),p.addSkirtIndices(s,d,u,h,i,l,o),I=n[r]={indices:l,westIndicesSouthToNorth:s,southIndicesEastToWest:d,eastIndicesNorthToSouth:u,northIndicesWestToEast:h,indexCountWithoutSkirts:o}),I},p.addSkirtIndices=function(e,t,r,n,i,o,a){a=w(e,i,o,a),a=w(t,i+=e.length,o,a),a=w(r,i+=t.length,o,a),w(n,i+=r.length,o,a)},p.heightmapTerrainQuality=.25,p.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(e,t,r){return 2*e.maximumRadius*Math.PI*p.heightmapTerrainQuality/(t*r)},p.prototype.requestTileGeometry=t.DeveloperError.throwInstantiationError,p.prototype.getLevelMaximumGeometricError=t.DeveloperError.throwInstantiationError,p.prototype.getTileDataAvailable=t.DeveloperError.throwInstantiationError,p.prototype.loadTileDataAvailability=t.DeveloperError.throwInstantiationError;var x=32767,M=new n.Cartesian3,b=new n.Cartesian3,C=new n.Cartesian3,S=new n.Cartographic,A=new n.Cartesian2,P=new n.Cartesian3,W=new i.Matrix4,D=new i.Matrix4;function B(e,t,o,a,s,d,c,u,h){var l=Number.POSITIVE_INFINITY,I=s.north,m=s.south,g=s.east,T=s.west;g<T&&(g+=r.CesiumMath.TWO_PI);for(var p=e.length,E=0;E<p;++E){var f=o[y=e[E]],y=a[y];S.longitude=r.CesiumMath.lerp(T,g,y.x),S.latitude=r.CesiumMath.lerp(m,I,y.y),S.height=f-t,f=d.cartographicToCartesian(S,M),i.Matrix4.multiplyByPoint(c,f,f),n.Cartesian3.minimumByComponent(f,u,u),n.Cartesian3.maximumByComponent(f,h,h),l=Math.min(l,S.height)}return l}function F(t,o,a,s,c,u,h,I,m,g,T,p,E,f,y){var v=e.defined(h),N=m.north,w=m.south,x=m.east,b=m.west;x<b&&(x+=r.CesiumMath.TWO_PI);for(var C=a.length,B=0;B<C;++B){var F=a[B],k=c[F],V=u[F];S.longitude=r.CesiumMath.lerp(b,x,V.x)+f,S.latitude=r.CesiumMath.lerp(w,N,V.y)+y,S.height=k-g;var _,H,O=I.cartographicToCartesian(S,M);v&&(_=2*F,A.x=h[_],A.y=h[1+_],1!==T&&(k=d.AttributeCompression.octDecode(A.x,A.y,P),F=i.Transforms.eastNorthUpToFixedFrame(M,I,D),_=i.Matrix4.inverseTransformation(F,W),i.Matrix4.multiplyByPointAsVector(_,k,k),k.z*=T,n.Cartesian3.normalize(k,k),i.Matrix4.multiplyByPointAsVector(F,k,k),n.Cartesian3.normalize(k,k),d.AttributeCompression.octEncode(k,A))),s.hasWebMercatorT&&(H=(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(S.latitude)-p)*E),o=s.encode(t,o,O,V,S.height,A,H)}}function k(t,r){var n;return"function"==typeof t.slice&&"function"!=typeof(n=t.slice()).sort&&(n=void 0),e.defined(n)||(n=Array.prototype.slice.call(t)),n.sort(r),n}return I((function(t,o){var a,s,u=(be=t.quantizedVertices).length/3,h=t.octEncodedNormals,I=t.westIndices.length+t.eastIndices.length+t.southIndices.length+t.northIndices.length,E=t.includeWebMercatorT,f=n.Rectangle.clone(t.rectangle),y=f.west,v=f.south,N=f.east,w=f.north,V=n.Ellipsoid.clone(t.ellipsoid),_=t.exaggeration,H=t.minimumHeight*_,O=t.maximumHeight*_,G=t.relativeToCenter,Y=i.Transforms.eastNorthUpToFixedFrame(G,V),z=i.Matrix4.inverseTransformation(Y,new i.Matrix4);E&&(a=l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(v),s=1/(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(w)-a));var R=be.subarray(0,u),L=be.subarray(u,2*u),U=be.subarray(2*u,3*u),j=e.defined(h),q=new Array(u),Q=new Array(u),K=new Array(u),X=E?new Array(u):[],Z=b;Z.x=Number.POSITIVE_INFINITY,Z.y=Number.POSITIVE_INFINITY,Z.z=Number.POSITIVE_INFINITY;var J=C;J.x=Number.NEGATIVE_INFINITY,J.y=Number.NEGATIVE_INFINITY,J.z=Number.NEGATIVE_INFINITY;for(var $=Number.POSITIVE_INFINITY,ee=Number.NEGATIVE_INFINITY,te=Number.POSITIVE_INFINITY,re=Number.NEGATIVE_INFINITY,ne=0;ne<u;++ne){var ie=R[ne],oe=L[ne],ae=ie/x,se=oe/x;ie=r.CesiumMath.lerp(H,O,U[ne]/x),S.longitude=r.CesiumMath.lerp(y,N,ae),S.latitude=r.CesiumMath.lerp(v,w,se),S.height=ie,$=Math.min(S.longitude,$),ee=Math.max(S.longitude,ee),te=Math.min(S.latitude,te),re=Math.max(S.latitude,re),oe=V.cartographicToCartesian(S),q[ne]=new n.Cartesian2(ae,se),Q[ne]=ie,K[ne]=oe,E&&(X[ne]=(l.WebMercatorProjection.geodeticLatitudeToMercatorAngle(S.latitude)-a)*s),i.Matrix4.multiplyByPoint(z,oe,M),n.Cartesian3.minimumByComponent(M,Z,Z),n.Cartesian3.maximumByComponent(M,J,J)}var de,ce,ue,he=k(t.westIndices,(function(e,t){return q[e].y-q[t].y})),le=k(t.eastIndices,(function(e,t){return q[t].y-q[e].y})),Ie=k(t.southIndices,(function(e,t){return q[t].x-q[e].x})),me=k(t.northIndices,(function(e,t){return q[e].x-q[t].x}));1!==_&&(ce=i.BoundingSphere.fromPoints(K),de=g.OrientedBoundingBox.fromRectangle(f,H,O,V)),(1!==_||H<0)&&(ue=new T.EllipsoidalOccluder(V).computeHorizonCullingPointPossiblyUnderEllipsoid(G,K,H));var ge=H;ge=Math.min(ge,B(t.westIndices,t.westSkirtHeight,Q,q,f,V,z,Z,J)),ge=Math.min(ge,B(t.southIndices,t.southSkirtHeight,Q,q,f,V,z,Z,J)),ge=Math.min(ge,B(t.eastIndices,t.eastSkirtHeight,Q,q,f,V,z,Z,J)),ge=Math.min(ge,B(t.northIndices,t.northSkirtHeight,Q,q,f,V,z,Z,J));for(var Te,pe,Ee,fe=new m.AxisAlignedBoundingBox(Z,J,G),ye=new T.TerrainEncoding(fe,ge,O,Y,j,E),ve=ye.getStride(),Ne=new Float32Array(u*ve+I*ve),we=0,xe=0;xe<u;++xe)j&&(Ee=2*xe,A.x=h[Ee],A.y=h[1+Ee],1!==_&&(Te=d.AttributeCompression.octDecode(A.x,A.y,P),pe=i.Transforms.eastNorthUpToFixedFrame(K[xe],V,D),Ee=i.Matrix4.inverseTransformation(pe,W),i.Matrix4.multiplyByPointAsVector(Ee,Te,Te),Te.z*=_,n.Cartesian3.normalize(Te,Te),i.Matrix4.multiplyByPointAsVector(pe,Te,Te),n.Cartesian3.normalize(Te,Te),d.AttributeCompression.octEncode(Te,A))),we=ye.encode(Ne,we,K[xe],q[xe],Q[xe],A,X[xe]);var Me=Math.max(0,2*(I-4)),be=t.indices.length+3*Me;return(fe=c.IndexDatatype.createTypedArray(u+I,be)).set(t.indices,0),Me=-(ge=1e-4*(ee-$)),I=ge,ge=-(be=Y=1e-4*(re-te)),F(Ne,Y=u*ve,he,ye,Q,q,h,V,f,t.westSkirtHeight,_,a,s,Me,0),F(Ne,Y+=t.westIndices.length*ve,Ie,ye,Q,q,h,V,f,t.southSkirtHeight,_,a,s,0,ge),F(Ne,Y+=t.southIndices.length*ve,le,ye,Q,q,h,V,f,t.eastSkirtHeight,_,a,s,I,0),F(Ne,Y+=t.eastIndices.length*ve,me,ye,Q,q,h,V,f,t.northSkirtHeight,_,a,s,0,be),p.addSkirtIndices(he,Ie,le,me,u,fe,t.indices.length),o.push(Ne.buffer,fe.buffer),{vertices:Ne.buffer,indices:fe.buffer,westIndicesSouthToNorth:he,southIndicesEastToWest:Ie,eastIndicesNorthToSouth:le,northIndicesWestToEast:me,vertexStride:ve,center:G,minimumHeight:H,maximumHeight:O,boundingSphere:ce,orientedBoundingBox:de,occludeePointInScaledSpace:ue,encoding:ye,indexCountWithoutSkirts:t.indices.length}}))}));