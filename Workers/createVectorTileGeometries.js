define(["./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-6f81ad4c","./RuntimeError-2109023a","./WebGLConstants-76bb35d1","./ComponentDatatype-6d99a1ee","./GeometryAttribute-700c1da0","./GeometryAttributes-4fcfcf40","./IndexDatatype-53503fee","./createTaskProcessorWorker","./GeometryOffsetAttribute-7350d9af","./VertexFormat-7572c785","./BoxGeometry-49272f06","./CylinderGeometryLibrary-b0214ab1","./CylinderGeometry-d562e451","./EllipsoidGeometry-1cbc4f6d","./Color-6328388f"],(function(e,t,n,r,a,i,o,d,s,c,f,l,u,h,p,b,y,x,g){"use strict";function C(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}var m=new r.Cartesian3,v=a.Matrix4.packedLength+r.Cartesian3.packedLength,I=a.Matrix4.packedLength+2,k=a.Matrix4.packedLength+r.Cartesian3.packedLength,M=r.Cartesian3.packedLength+1,B={modelMatrix:new a.Matrix4,boundingVolume:new a.BoundingSphere};function w(e,t){var n=t*v;return t=r.Cartesian3.unpack(e,n,m),n+=r.Cartesian3.packedLength,n=a.Matrix4.unpack(e,n,B.modelMatrix),a.Matrix4.multiplyByScale(n,t,n),n=B.boundingVolume,r.Cartesian3.clone(r.Cartesian3.ZERO,n.center),n.radius=Math.sqrt(3),B}function A(e,t){var n=t*I,i=e[n++];return t=e[n++],t=r.Cartesian3.fromElements(i,i,t,m),n=a.Matrix4.unpack(e,n,B.modelMatrix),a.Matrix4.multiplyByScale(n,t,n),n=B.boundingVolume,r.Cartesian3.clone(r.Cartesian3.ZERO,n.center),n.radius=Math.sqrt(2),B}function O(e,t){var n=t*k;return t=r.Cartesian3.unpack(e,n,m),n+=r.Cartesian3.packedLength,n=a.Matrix4.unpack(e,n,B.modelMatrix),a.Matrix4.multiplyByScale(n,t,n),n=B.boundingVolume,r.Cartesian3.clone(r.Cartesian3.ZERO,n.center),n.radius=1,B}function L(e,t){var n=t*M;return t=e[n++],n=r.Cartesian3.unpack(e,n,m),n=a.Matrix4.fromTranslation(n,B.modelMatrix),a.Matrix4.multiplyByUniformScale(n,t,n),n=B.boundingVolume,r.Cartesian3.clone(r.Cartesian3.ZERO,n.center),n.radius=1,B}var E=new r.Cartesian3;function U(t,n,i,o,d){if(e.defined(n)){for(var s=i.length,c=o.attributes.position.values,f=o.indices,l=t.positions,u=t.vertexBatchIds,h=t.indices,p=t.batchIds,b=t.batchTableColors,y=t.batchedIndices,x=t.indexOffsets,m=t.indexCounts,v=t.boundingVolumes,I=t.modelMatrix,k=t.center,M=t.positionOffset,B=t.batchIdIndex,w=t.indexOffset,A=t.batchedIndicesOffset,O=0;O<s;++O){var L=d(n,O),U=L.modelMatrix;a.Matrix4.multiply(I,U,U);for(var G=i[O],S=c.length,T=0;T<S;T+=3){var V=r.Cartesian3.unpack(c,T,E);a.Matrix4.multiplyByPoint(U,V,V),r.Cartesian3.subtract(V,k,V),r.Cartesian3.pack(V,l,3*M+T),u[B++]=G}for(var F=f.length,R=0;R<F;++R)h[w+R]=f[R]+M;var Z=O+A;y[Z]=new C({offset:w,count:F,color:g.Color.fromRgba(b[G]),batchIds:[G]}),p[Z]=G,x[Z]=w,m[Z]=F,v[Z]=a.BoundingSphere.transform(L.boundingVolume,U),M+=S/3,w+=F}t.positionOffset=M,t.batchIdIndex=B,t.indexOffset=w,t.batchedIndicesOffset+=s}}var G=new r.Cartesian3,S=new a.Matrix4;return l((function(t,n){var i=e.defined(t.boxes)?new Float32Array(t.boxes):void 0,o=e.defined(t.boxBatchIds)?new Uint16Array(t.boxBatchIds):void 0,d=e.defined(t.cylinders)?new Float32Array(t.cylinders):void 0,s=e.defined(t.cylinderBatchIds)?new Uint16Array(t.cylinderBatchIds):void 0,c=e.defined(t.ellipsoids)?new Float32Array(t.ellipsoids):void 0,l=e.defined(t.ellipsoidBatchIds)?new Uint16Array(t.ellipsoidBatchIds):void 0,u=e.defined(t.spheres)?new Float32Array(t.spheres):void 0,h=e.defined(t.sphereBatchIds)?new Uint16Array(t.sphereBatchIds):void 0,b=e.defined(i)?o.length:0,C=e.defined(d)?s.length:0,m=e.defined(c)?l.length:0,v=e.defined(u)?h.length:0,I=p.BoxGeometry.getUnitBox(),k=y.CylinderGeometry.getUnitCylinder(),M=x.EllipsoidGeometry.getUnitEllipsoid(),B=I.attributes.position.values,E=k.attributes.position.values,T=M.attributes.position.values,V=B.length*b;V+=E.length*C,V+=T.length*(m+v);var F=I.indices,R=k.indices;return B=M.indices,E=F.length*b,E+=R.length*C,E+=B.length*(m+v),T=new Float32Array(V),F=new Uint16Array(V/3),R=f.IndexDatatype.createTypedArray(V/3,E),B=b+C+m+v,V=new Uint16Array(B),E=new Array(B),b=new Uint32Array(B),C=new Uint32Array(B),m=new Array(B),v=t.packedBuffer,B=new Float64Array(v),v=0,r.Cartesian3.unpack(B,0,G),v+=r.Cartesian3.packedLength,a.Matrix4.unpack(B,v,S),U(t={batchTableColors:new Uint32Array(t.batchTableColors),positions:T,vertexBatchIds:F,indices:R,batchIds:V,batchedIndices:E,indexOffsets:b,indexCounts:C,boundingVolumes:m,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:S,center:G},i,o,I,w),U(t,d,s,k,A),U(t,c,l,M,O),U(t,u,h,M,L),m=function(e,t,n){var r=n.length,i=2+r*a.BoundingSphere.packedLength+1+function(e){for(var t=e.length,n=0,r=0;r<t;++r)n+=g.Color.packedLength+3+e[r].batchIds.length;return n}(t),o=new Float64Array(i),d=0;o[d++]=e,o[d++]=r;for(var s=0;s<r;++s)a.BoundingSphere.pack(n[s],o,d),d+=a.BoundingSphere.packedLength;var c=t.length;o[d++]=c;for(var f=0;f<c;++f){var l=t[f];g.Color.pack(l.color,o,d),d+=g.Color.packedLength,o[d++]=l.offset,o[d++]=l.count;var u=l.batchIds,h=u.length;o[d++]=h;for(var p=0;p<h;++p)o[d++]=u[p]}return o}(R.BYTES_PER_ELEMENT,E,m),n.push(T.buffer,F.buffer,R.buffer),n.push(V.buffer,b.buffer,C.buffer),n.push(m.buffer),{positions:T.buffer,vertexBatchIds:F.buffer,indices:R.buffer,indexOffsets:b.buffer,indexCounts:C.buffer,batchIds:V.buffer,packedBuffer:m.buffer}}))}));