define(["./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-6f81ad4c","./RuntimeError-2109023a","./WebGLConstants-76bb35d1","./ComponentDatatype-6d99a1ee","./AttributeCompression-9fc99391","./IntersectionTests-7f3bcd5c","./Plane-b6058d9b","./WebMercatorProjection-df58d479","./createTaskProcessorWorker","./EllipsoidTangentPlane-c3f203b0","./OrientedBoundingBox-b5830afd","./TerrainEncoding-31ac0bf2"],(function(t,e,i,n,r,a,o,s,u,h,c,d,g,l,m,p){"use strict";var I=Uint16Array.BYTES_PER_ELEMENT,E=Int32Array.BYTES_PER_ELEMENT,f=Uint32Array.BYTES_PER_ELEMENT,T=Float32Array.BYTES_PER_ELEMENT,C=Float64Array.BYTES_PER_ELEMENT;function M(e,n,r){r=t.defaultValue(r,i.CesiumMath);for(var a=e.length,o=0;o<a;++o)if(r.equalsEpsilon(e[o],n,i.CesiumMath.EPSILON12))return o;return-1}var v=new n.Cartographic,N=new n.Cartesian3,x=new n.Cartesian3,b=new n.Cartesian3,S=new r.Matrix4;function w(e,a,o,s,u,h,c,d,g,l){for(var m=c.length,p=0;p<m;++p){var I=c[p],E=I.cartographic,f=I.index,T=e.length,C=E.longitude,M=E.latitude;M=i.CesiumMath.clamp(M,-i.CesiumMath.PI_OVER_TWO,i.CesiumMath.PI_OVER_TWO),E=E.height-h.skirtHeight,h.hMin=Math.min(h.hMin,E),n.Cartographic.fromRadians(C,M,E,v),g&&(v.longitude+=d),g?p===m-1?v.latitude+=l:0===p&&(v.latitude-=l):v.latitude+=d,M=h.ellipsoid.cartographicToCartesian(v),e.push(M),a.push(E),o.push(n.Cartesian2.clone(o[f])),0<s.length&&s.push(s[f]),r.Matrix4.multiplyByPoint(h.toENU,M,N),E=h.minimum,M=h.maximum,n.Cartesian3.minimumByComponent(N,E,E),n.Cartesian3.maximumByComponent(N,M,M),M=h.lastBorderPoint,t.defined(M)&&(M=M.index,u.push(M,T-1,T,T,f,M)),h.lastBorderPoint=I}}return g((function(e,o){e.ellipsoid=n.Ellipsoid.clone(e.ellipsoid),e.rectangle=n.Rectangle.clone(e.rectangle);var s=function(e,o,s,u,h,c,g,P,B,y){var A,R,_,W,F;yt=t.defined(u)?(A=u.west,R=u.south,_=u.east,W=u.north,F=u.width,u.height):(A=i.CesiumMath.toRadians(h.west),R=i.CesiumMath.toRadians(h.south),_=i.CesiumMath.toRadians(h.east),W=i.CesiumMath.toRadians(h.north),F=i.CesiumMath.toRadians(u.width),i.CesiumMath.toRadians(u.height));var O,Y,k=[R,W],U=[A,_],V=r.Transforms.eastNorthUpToFixedFrame(o,s),H=r.Matrix4.inverseTransformation(V,S);P&&(O=d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(R),Y=1/(d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(W)-O));var L=new DataView(e),D=Number.POSITIVE_INFINITY,G=Number.NEGATIVE_INFINITY,j=x;j.x=Number.POSITIVE_INFINITY,j.y=Number.POSITIVE_INFINITY,j.z=Number.POSITIVE_INFINITY;var z=b;z.x=Number.NEGATIVE_INFINITY,z.y=Number.NEGATIVE_INFINITY,z.z=Number.NEGATIVE_INFINITY;var q,J,K=0,Q=0,X=0;for(J=0;J<4;++J){var Z=K;q=L.getUint32(Z,!0),Z+=f;var $=i.CesiumMath.toRadians(180*L.getFloat64(Z,!0));Z+=C,-1===M(U,$)&&U.push($),$=i.CesiumMath.toRadians(180*L.getFloat64(Z,!0)),Z+=C,-1===M(k,$)&&k.push($),Z+=2*C,$=L.getInt32(Z,!0),Z+=E,Q+=$,X+=3*($=L.getInt32(Z,!0)),K+=q+f}var tt=[],et=[],it=new Array(Q),nt=new Array(Q),rt=new Array(Q),at=P?new Array(Q):[],ot=new Array(X),st=[],ut=[],ht=[],ct=[],dt=0,gt=0;for(J=K=0;J<4;++J){q=L.getUint32(K,!0);var lt=K+=f,mt=i.CesiumMath.toRadians(180*L.getFloat64(K,!0));K+=C;var pt=i.CesiumMath.toRadians(180*L.getFloat64(K,!0));K+=C;var It=i.CesiumMath.toRadians(180*L.getFloat64(K,!0)),Et=.5*It;K+=C;var ft=i.CesiumMath.toRadians(180*L.getFloat64(K,!0)),Tt=.5*ft;K+=C;var Ct=L.getInt32(K,!0);K+=E;var Mt=L.getInt32(K,!0);K+=E,K+=E;for(var vt=new Array(Ct),Nt=0;Nt<Ct;++Nt){var xt=mt+L.getUint8(K++)*It;v.longitude=xt;var bt=pt+L.getUint8(K++)*ft;v.latitude=bt;var St=L.getFloat32(K,!0);if(K+=T,0!==St&&St<y&&(St*=-Math.pow(2,B)),St*=6371010*c,v.height=St,-1!==M(U,xt)||-1!==M(k,bt)){var wt=M(tt,v,n.Cartographic);if(-1!==wt){vt[Nt]=et[wt];continue}tt.push(n.Cartographic.clone(v)),et.push(dt)}vt[Nt]=dt,Math.abs(xt-A)<Et?st.push({index:dt,cartographic:n.Cartographic.clone(v)}):Math.abs(xt-_)<Et?ht.push({index:dt,cartographic:n.Cartographic.clone(v)}):Math.abs(bt-R)<Tt?ut.push({index:dt,cartographic:n.Cartographic.clone(v)}):Math.abs(bt-W)<Tt&&ct.push({index:dt,cartographic:n.Cartographic.clone(v)}),D=Math.min(St,D),G=Math.max(St,G),rt[dt]=St,St=s.cartographicToCartesian(v),it[dt]=St,P&&(at[dt]=(d.WebMercatorProjection.geodeticLatitudeToMercatorAngle(bt)-O)*Y),r.Matrix4.multiplyByPoint(H,St,N),n.Cartesian3.minimumByComponent(N,j,j),n.Cartesian3.maximumByComponent(N,z,z),xt=(xt-A)/(_-A),xt=i.CesiumMath.clamp(xt,0,1),bt=(bt-R)/(W-R),bt=i.CesiumMath.clamp(bt,0,1),nt[dt]=new n.Cartesian2(xt,bt),++dt}for(var Pt=3*Mt,Bt=0;Bt<Pt;++Bt,++gt)ot[gt]=vt[L.getUint16(K,!0)],K+=I;if(q!==K-lt)throw new a.RuntimeError("Invalid terrain tile.")}it.length=dt,nt.length=dt,rt.length=dt,P&&(at.length=dt);var yt,At=dt;h=gt,e={hMin:D,lastBorderPoint:void 0,skirtHeight:g,toENU:H,ellipsoid:s,minimum:j,maximum:z},st.sort((function(t,e){return e.cartographic.latitude-t.cartographic.latitude})),ut.sort((function(t,e){return t.cartographic.longitude-e.cartographic.longitude})),ht.sort((function(t,e){return t.cartographic.latitude-e.cartographic.latitude})),ct.sort((function(t,e){return e.cartographic.longitude-t.cartographic.longitude})),w(it,rt,nt,at,ot,e,st,-(g=1e-5)*F,!0,-g*yt),w(it,rt,nt,at,ot,e,ut,-g*yt,!1),w(it,rt,nt,at,ot,e,ht,g*F,!0,g*yt),w(it,rt,nt,at,ot,e,ct,g*yt,!1),0<st.length&&0<ct.length&&(_t=st[0].index,Wt=ct[ct.length-1].index,yt=it.length-1,ot.push(Wt,yt,At,At,_t,Wt)),Q=it.length;var Rt,_t=r.BoundingSphere.fromPoints(it);t.defined(u)&&(Rt=m.OrientedBoundingBox.fromRectangle(u,D,G,s));for(var Wt=new p.EllipsoidalOccluder(s).computeHorizonCullingPointPossiblyUnderEllipsoid(o,it,D),Ft=(u=new l.AxisAlignedBoundingBox(j,z,o),new p.TerrainEncoding(u,e.hMin,G,V,!1,P)),Ot=new Float32Array(Q*Ft.getStride()),Yt=0,kt=0;kt<Q;++kt)Yt=Ft.encode(Ot,Yt,it[kt],nt[kt],rt[kt],void 0,at[kt]);return o=st.map((function(t){return t.index})).reverse(),u=ut.map((function(t){return t.index})).reverse(),e=ht.map((function(t){return t.index})).reverse(),V=ct.map((function(t){return t.index})).reverse(),u.unshift(e[e.length-1]),u.push(o[0]),V.unshift(o[o.length-1]),V.push(e[0]),{vertices:Ot,indices:new Uint16Array(ot),maximumHeight:G,minimumHeight:D,encoding:Ft,boundingSphere3D:_t,orientedBoundingBox:Rt,occludeePointInScaledSpace:Wt,vertexCountWithoutSkirts:At,indexCountWithoutSkirts:h,westIndicesSouthToNorth:o,southIndicesEastToWest:u,eastIndicesNorthToSouth:e,northIndicesWestToEast:V}}(e.buffer,e.relativeToCenter,e.ellipsoid,e.rectangle,e.nativeRectangle,e.exaggeration,e.skirtHeight,e.includeWebMercatorT,e.negativeAltitudeExponentBias,e.negativeElevationThreshold),u=s.vertices;return o.push(u.buffer),e=s.indices,o.push(e.buffer),{vertices:u.buffer,indices:e.buffer,numberOfAttributes:s.encoding.getStride(),minimumHeight:s.minimumHeight,maximumHeight:s.maximumHeight,boundingSphere3D:s.boundingSphere3D,orientedBoundingBox:s.orientedBoundingBox,occludeePointInScaledSpace:s.occludeePointInScaledSpace,encoding:s.encoding,vertexCountWithoutSkirts:s.vertexCountWithoutSkirts,indexCountWithoutSkirts:s.indexCountWithoutSkirts,westIndicesSouthToNorth:s.westIndicesSouthToNorth,southIndicesEastToWest:s.southIndicesEastToWest,eastIndicesNorthToSouth:s.eastIndicesNorthToSouth,northIndicesWestToEast:s.northIndicesWestToEast}}))}));