define(["./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-6f81ad4c","./RuntimeError-2109023a","./WebGLConstants-76bb35d1","./AttributeCompression-9fc99391","./IndexDatatype-53503fee","./IntersectionTests-7f3bcd5c","./Plane-b6058d9b","./createTaskProcessorWorker","./EllipsoidTangentPlane-c3f203b0","./OrientedBoundingBox-b5830afd","./Color-6328388f"],(function(e,a,n,r,t,i,o,s,f,d,c,u,h,l,g){"use strict";var p=new r.Cartesian3,b=new r.Ellipsoid,C=new r.Rectangle,y={min:void 0,max:void 0,indexBytesPerElement:void 0},I=new r.Cartesian3,m=new r.Cartesian3,w=new r.Cartesian3,x=new r.Cartesian3,v=new r.Cartesian3,A=new r.Cartographic,E=new r.Rectangle;return u((function(a,t){var i;c=a.packedBuffer,i=new Float64Array(c),c=0,y.indexBytesPerElement=i[c++],y.min=i[c++],y.max=i[c++],r.Cartesian3.unpack(i,3,p),c+=r.Cartesian3.packedLength,r.Ellipsoid.unpack(i,c,b),c+=r.Ellipsoid.packedLength,r.Rectangle.unpack(i,c,C);var o,d=new(2===y.indexBytesPerElement?Uint16Array:Uint32Array)(a.indices),c=new Uint16Array(a.positions),u=new Uint32Array(a.counts),h=new Uint32Array(a.indexCounts),N=new Uint32Array(a.batchIds),T=new Uint32Array(a.batchTableColors),k=new Array(u.length),B=p,L=b,O=C,U=y.min,P=y.max,F=a.minimumHeights,S=a.maximumHeights;e.defined(F)&&e.defined(S)&&(F=new Float32Array(F),S=new Float32Array(S));var R=c.length/2,D=c.subarray(0,R),M=c.subarray(R,2*R);s.AttributeCompression.zigZagDeltaDecode(D,M);for(var _=new Float64Array(3*R),G=0;G<R;++G){var Y=D[G],V=M[G];Y=n.CesiumMath.lerp(O.west,O.east,Y/32767),V=n.CesiumMath.lerp(O.south,O.north,V/32767),V=r.Cartographic.fromRadians(Y,V,0,A),V=L.cartographicToCartesian(V,I),r.Cartesian3.pack(V,_,3*G)}var H=u.length,W=new Array(H),z=new Array(H),Z=0,j=0;for(G=0;G<H;++G)W[G]=Z,z[G]=j,Z+=u[G],j+=h[G];var q,J=new Float32Array(3*R*2),K=new Uint16Array(2*R),Q=new Uint32Array(z.length),X=new Uint32Array(h.length),$=[],ee={};for(G=0;G<H;++G)o=T[G],e.defined(ee[o])?(ee[o].positionLength+=u[G],ee[o].indexLength+=h[G],ee[o].batchIds.push(G)):ee[o]={positionLength:u[G],indexLength:h[G],offset:0,indexOffset:0,batchIds:[G]};var ae,ne=0,re=0;for(o in ee)ee.hasOwnProperty(o)&&((q=ee[o]).offset=ne,q.indexOffset=re,ne+=2*q.positionLength,re+=ae=2*q.indexLength+6*q.positionLength,q.indexLength=ae);var te=[];for(o in ee)ee.hasOwnProperty(o)&&(q=ee[o],te.push({color:g.Color.fromRgba(parseInt(o)),offset:q.indexOffset,count:q.indexLength,batchIds:q.batchIds}));for(G=0;G<H;++G){var ie=(q=ee[o=T[G]]).offset,oe=3*ie,se=ie,fe=W[G],de=u[G],ce=N[G],ue=U,he=P;e.defined(F)&&e.defined(S)&&(ue=F[G],he=S[G]);for(var le=Number.POSITIVE_INFINITY,ge=Number.NEGATIVE_INFINITY,pe=Number.POSITIVE_INFINITY,be=Number.NEGATIVE_INFINITY,Ce=0;Ce<de;++Ce){var ye=r.Cartesian3.unpack(_,3*fe+3*Ce,I);L.scaleToGeodeticSurface(ye,ye);var Ie=(we=L.cartesianToCartographic(ye,A)).latitude,me=we.longitude,we=(le=Math.min(Ie,le),ge=Math.max(Ie,ge),pe=Math.min(me,pe),be=Math.max(me,be),L.geodeticSurfaceNormal(ye,m));Ie=r.Cartesian3.multiplyByScalar(we,ue,w),me=r.Cartesian3.add(ye,Ie,x),Ie=r.Cartesian3.multiplyByScalar(we,he,Ie),Ie=r.Cartesian3.add(ye,Ie,v),r.Cartesian3.subtract(Ie,B,Ie),r.Cartesian3.subtract(me,B,me),r.Cartesian3.pack(Ie,J,oe),r.Cartesian3.pack(me,J,oe+3),K[se]=ce,K[se+1]=ce,oe+=6,se+=2}(O=E).west=pe,O.east=be,O.south=le,O.north=ge,k[G]=l.OrientedBoundingBox.fromRectangle(O,U,P,L);var xe=q.indexOffset,ve=z[G],Ae=h[G];for(Q[G]=xe,Ce=0;Ce<Ae;Ce+=3){var Ee=d[ve+Ce]-fe,Ne=d[ve+Ce+1]-fe,Te=d[ve+Ce+2]-fe;$[xe++]=2*Ee+ie,$[xe++]=2*Ne+ie,$[xe++]=2*Te+ie,$[xe++]=2*Te+1+ie,$[xe++]=2*Ne+1+ie,$[xe++]=2*Ee+1+ie}for(Ce=0;Ce<de;++Ce){var ke=Ce,Be=(Ce+1)%de;$[xe++]=2*ke+1+ie,$[xe++]=2*Be+ie,$[xe++]=2*ke+ie,$[xe++]=2*ke+1+ie,$[xe++]=2*Be+1+ie,$[xe++]=2*Be+ie}q.offset+=2*de,q.indexOffset=xe,X[G]=xe-Q[G]}$=f.IndexDatatype.createTypedArray(J.length/3,$);for(var Le=te.length,Oe=0;Oe<Le;++Oe){for(var Ue=te[Oe].batchIds,Pe=0,Fe=Ue.length,Se=0;Se<Fe;++Se)Pe+=X[Ue[Se]];te[Oe].count=Pe}return c=function(e,a,n){var r=a.length,t=2+r*l.OrientedBoundingBox.packedLength+1+function(e){for(var a=e.length,n=0,r=0;r<a;++r)n+=g.Color.packedLength+3+e[r].batchIds.length;return n}(n),i=new Float64Array(t),o=0;i[o++]=e,i[o++]=r;for(var s=0;s<r;++s)l.OrientedBoundingBox.pack(a[s],i,o),o+=l.OrientedBoundingBox.packedLength;var f=n.length;i[o++]=f;for(var d=0;d<f;++d){var c=n[d];g.Color.pack(c.color,i,o),o+=g.Color.packedLength,i[o++]=c.offset,i[o++]=c.count;var u=c.batchIds,h=u.length;i[o++]=h;for(var p=0;p<h;++p)i[o++]=u[p]}return i}(2===$.BYTES_PER_ELEMENT?f.IndexDatatype.UNSIGNED_SHORT:f.IndexDatatype.UNSIGNED_INT,k,te),t.push(J.buffer,$.buffer,Q.buffer,X.buffer,K.buffer,c.buffer),{positions:J.buffer,indices:$.buffer,indexOffsets:Q.buffer,indexCounts:X.buffer,batchIds:K.buffer,packedBuffer:c.buffer}}))}));