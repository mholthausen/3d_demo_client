define(["./AttributeCompression-8ecc041c","./Cartesian2-49b1de22","./Color-91231c89","./when-54c2dc71","./IndexDatatype-46306178","./Math-44e92d6b","./OrientedBoundingBox-3669ebd4","./createTaskProcessorWorker","./Check-6c0211bc","./Transforms-e9dbfb40","./RuntimeError-2109023a","./WebGLConstants-76bb35d1","./EllipsoidTangentPlane-c4704d0f","./IntersectionTests-6ead8677","./Plane-8f7e53d1"],(function(e,a,n,r,t,i,o,s,d,f,c,u,h,l,g){"use strict";var p=new a.Cartesian3,b=new a.Ellipsoid,C=new a.Rectangle,y={min:void 0,max:void 0,indexBytesPerElement:void 0},I=new a.Cartesian3,m=new a.Cartesian3,w=new a.Cartesian3,x=new a.Cartesian3,v=new a.Cartesian3,A=new a.Cartographic,E=new a.Rectangle;return s((function(s,d){var f;h=s.packedBuffer,f=new Float64Array(h),h=0,y.indexBytesPerElement=f[h++],y.min=f[h++],y.max=f[h++],a.Cartesian3.unpack(f,3,p),h+=a.Cartesian3.packedLength,a.Ellipsoid.unpack(f,h,b),h+=a.Ellipsoid.packedLength,a.Rectangle.unpack(f,h,C);var c,u=new(2===y.indexBytesPerElement?Uint16Array:Uint32Array)(s.indices),h=new Uint16Array(s.positions),l=new Uint32Array(s.counts),g=new Uint32Array(s.indexCounts),N=new Uint32Array(s.batchIds),T=new Uint32Array(s.batchTableColors),k=new Array(l.length),B=p,L=b,O=C,U=y.min,P=y.max,F=s.minimumHeights,S=s.maximumHeights;r.defined(F)&&r.defined(S)&&(F=new Float32Array(F),S=new Float32Array(S));var R=h.length/2,D=h.subarray(0,R),M=h.subarray(R,2*R);e.AttributeCompression.zigZagDeltaDecode(D,M);for(var _=new Float64Array(3*R),G=0;G<R;++G){var Y=D[G],V=M[G];Y=i.CesiumMath.lerp(O.west,O.east,Y/32767),V=i.CesiumMath.lerp(O.south,O.north,V/32767),V=a.Cartographic.fromRadians(Y,V,0,A),V=L.cartographicToCartesian(V,I),a.Cartesian3.pack(V,_,3*G)}var H=l.length,W=new Array(H),z=new Array(H),Z=0,j=0;for(G=0;G<H;++G)W[G]=Z,z[G]=j,Z+=l[G],j+=g[G];var q,J=new Float32Array(3*R*2),K=new Uint16Array(2*R),Q=new Uint32Array(z.length),X=new Uint32Array(g.length),$=[],ee={};for(G=0;G<H;++G)c=T[G],r.defined(ee[c])?(ee[c].positionLength+=l[G],ee[c].indexLength+=g[G],ee[c].batchIds.push(G)):ee[c]={positionLength:l[G],indexLength:g[G],offset:0,indexOffset:0,batchIds:[G]};var ae,ne=0,re=0;for(c in ee)ee.hasOwnProperty(c)&&((q=ee[c]).offset=ne,q.indexOffset=re,ne+=2*q.positionLength,re+=ae=2*q.indexLength+6*q.positionLength,q.indexLength=ae);var te=[];for(c in ee)ee.hasOwnProperty(c)&&(q=ee[c],te.push({color:n.Color.fromRgba(parseInt(c)),offset:q.indexOffset,count:q.indexLength,batchIds:q.batchIds}));for(G=0;G<H;++G){var ie=(q=ee[c=T[G]]).offset,oe=3*ie,se=ie,de=W[G],fe=l[G],ce=N[G],ue=U,he=P;r.defined(F)&&r.defined(S)&&(ue=F[G],he=S[G]);for(var le=Number.POSITIVE_INFINITY,ge=Number.NEGATIVE_INFINITY,pe=Number.POSITIVE_INFINITY,be=Number.NEGATIVE_INFINITY,Ce=0;Ce<fe;++Ce){var ye=a.Cartesian3.unpack(_,3*de+3*Ce,I);L.scaleToGeodeticSurface(ye,ye);var Ie=(we=L.cartesianToCartographic(ye,A)).latitude,me=we.longitude,we=(le=Math.min(Ie,le),ge=Math.max(Ie,ge),pe=Math.min(me,pe),be=Math.max(me,be),L.geodeticSurfaceNormal(ye,m));Ie=a.Cartesian3.multiplyByScalar(we,ue,w),me=a.Cartesian3.add(ye,Ie,x),Ie=a.Cartesian3.multiplyByScalar(we,he,Ie),Ie=a.Cartesian3.add(ye,Ie,v),a.Cartesian3.subtract(Ie,B,Ie),a.Cartesian3.subtract(me,B,me),a.Cartesian3.pack(Ie,J,oe),a.Cartesian3.pack(me,J,oe+3),K[se]=ce,K[se+1]=ce,oe+=6,se+=2}(O=E).west=pe,O.east=be,O.south=le,O.north=ge,k[G]=o.OrientedBoundingBox.fromRectangle(O,U,P,L);var xe=q.indexOffset,ve=z[G],Ae=g[G];for(Q[G]=xe,Ce=0;Ce<Ae;Ce+=3){var Ee=u[ve+Ce]-de,Ne=u[ve+Ce+1]-de,Te=u[ve+Ce+2]-de;$[xe++]=2*Ee+ie,$[xe++]=2*Ne+ie,$[xe++]=2*Te+ie,$[xe++]=2*Te+1+ie,$[xe++]=2*Ne+1+ie,$[xe++]=2*Ee+1+ie}for(Ce=0;Ce<fe;++Ce){var ke=Ce,Be=(Ce+1)%fe;$[xe++]=2*ke+1+ie,$[xe++]=2*Be+ie,$[xe++]=2*ke+ie,$[xe++]=2*ke+1+ie,$[xe++]=2*Be+1+ie,$[xe++]=2*Be+ie}q.offset+=2*fe,q.indexOffset=xe,X[G]=xe-Q[G]}$=t.IndexDatatype.createTypedArray(J.length/3,$);for(var Le=te.length,Oe=0;Oe<Le;++Oe){for(var Ue=te[Oe].batchIds,Pe=0,Fe=Ue.length,Se=0;Se<Fe;++Se)Pe+=X[Ue[Se]];te[Oe].count=Pe}return h=function(e,a,r){var t=a.length,i=2+t*o.OrientedBoundingBox.packedLength+1+function(e){for(var a=e.length,r=0,t=0;t<a;++t)r+=n.Color.packedLength+3+e[t].batchIds.length;return r}(r),s=new Float64Array(i),d=0;s[d++]=e,s[d++]=t;for(var f=0;f<t;++f)o.OrientedBoundingBox.pack(a[f],s,d),d+=o.OrientedBoundingBox.packedLength;var c=r.length;s[d++]=c;for(var u=0;u<c;++u){var h=r[u];n.Color.pack(h.color,s,d),d+=n.Color.packedLength,s[d++]=h.offset,s[d++]=h.count;var l=h.batchIds,g=l.length;s[d++]=g;for(var p=0;p<g;++p)s[d++]=l[p]}return s}(2===$.BYTES_PER_ELEMENT?t.IndexDatatype.UNSIGNED_SHORT:t.IndexDatatype.UNSIGNED_INT,k,te),d.push(J.buffer,$.buffer,Q.buffer,X.buffer,K.buffer,h.buffer),{positions:J.buffer,indices:$.buffer,indexOffsets:Q.buffer,indexCounts:X.buffer,batchIds:K.buffer,packedBuffer:h.buffer}}))}));