define(["exports","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-6f81ad4c","./EllipsoidTangentPlane-c3f203b0","./PolylinePipeline-7685bebd"],(function(a,e,r,n,t,i){"use strict";var s=Object.freeze({ROUNDED:0,MITERED:1,BEVELED:2}),o=[new r.Cartesian3,new r.Cartesian3],l=new r.Cartesian3,C=new r.Cartesian3,c=new r.Cartesian3,u=new r.Cartesian3,y=new r.Cartesian3,d=new r.Cartesian3,m=new r.Cartesian3,f=new r.Cartesian3,p=new r.Cartesian3,g=new r.Cartesian3,w=new r.Cartesian3,h={},v=new r.Cartographic;function x(a,e,n,t){var i=a[0],s=(a=a[1],a=r.Cartesian3.angleBetween(i,a),Math.ceil(a/t)),o=new Array(s);if(e===n){for(C=0;C<s;C++)o[C]=e;return o.push(n),o}for(var l=(n-e)/s,C=1;C<s;C++){var c=e+C*l;o[C]=c}return o[0]=e,o.push(n),o}var P=new r.Cartesian3,E=new r.Cartesian3,M=new r.Cartesian3(-1,0,0),T=new n.Matrix4,B=new n.Matrix4,b=new n.Matrix3,z=n.Matrix3.IDENTITY.clone(),S=new r.Cartesian3,A=new n.Cartesian4,D=new r.Cartesian3;function O(a,e,i,s,o,l,C,c){var u=S,y=A;T=n.Transforms.eastNorthUpToFixedFrame(a,o,T),u=n.Matrix4.multiplyByPointAsVector(T,M,u),u=u=r.Cartesian3.normalize(u,u),e=e,a=a,o=o,u=(o=new t.EllipsoidTangentPlane(a,o)).projectPointOntoPlane(r.Cartesian3.add(a,u,P),P),a=o.projectPointOntoPlane(r.Cartesian3.add(a,e,E),E),e=r.Cartesian2.angleBetween(u,a),e=0<=a.x*u.y-a.y*u.x?-e:e,b=n.Matrix3.fromRotationZ(e,b),D.z=l,T=n.Matrix4.multiplyTransformation(T,n.Matrix4.fromRotationTranslation(b,D,B),T);var d=z;d[0]=C;for(var m=0;m<c;m++)for(var f=0;f<i.length;f+=3)y=r.Cartesian3.fromArray(i,f,y),y=n.Matrix3.multiplyByVector(d,y,y),y=n.Matrix4.multiplyByPoint(T,y,y),s.push(y.x,y.y,y.z);return s}var N=new r.Cartesian3;function V(a,e,n,t,i,s,o){for(var l=0;l<a.length;l+=3)t=O(r.Cartesian3.fromArray(a,l,N),e,n,t,i,s[l/3],o,1);return t}function G(a,e){for(var r=a.length,n=new Array(3*r),t=0,i=e.x+e.width/2,s=e.y+e.height/2,o=0;o<r;o++)n[t++]=a[o].x-i,n[t++]=0,n[t++]=a[o].y-s;return n}var R=new n.Quaternion,I=new r.Cartesian3,L=new n.Matrix3;function j(a,t,i,o,l,C,c,u,y,d){var m,f=r.Cartesian3.angleBetween(r.Cartesian3.subtract(t,a,g),r.Cartesian3.subtract(i,a,w)),p=o===s.BEVELED?0:Math.ceil(f/e.CesiumMath.toRadians(5)),h=l?n.Matrix3.fromQuaternion(n.Quaternion.fromAxisAngle(r.Cartesian3.negate(a,g),f/(p+1),R),L):n.Matrix3.fromQuaternion(n.Quaternion.fromAxisAngle(a,f/(p+1),R),L);if(t=r.Cartesian3.clone(t,I),0<p)for(var v=d?2:1,x=0;x<p;x++)t=n.Matrix3.multiplyByVector(h,t,t),m=r.Cartesian3.subtract(t,a,g),m=r.Cartesian3.normalize(m,m),l||(m=r.Cartesian3.negate(m,m)),c=O(C.scaleToGeodeticSurface(t,w),m,u,c,C,y,1,v);else m=r.Cartesian3.subtract(t,a,g),m=r.Cartesian3.normalize(m,m),l||(m=r.Cartesian3.negate(m,m)),c=O(C.scaleToGeodeticSurface(t,w),m,u,c,C,y,1,1),i=r.Cartesian3.clone(i,I),m=r.Cartesian3.subtract(i,a,g),m=r.Cartesian3.normalize(m,m),l||(m=r.Cartesian3.negate(m,m)),c=O(C.scaleToGeodeticSurface(i,w),m,u,c,C,y,1,1);return c}h.removeDuplicatesFromShape=function(a){for(var e=a.length,n=[],t=e-1,i=0;i<e;t=i++){var s=a[t],o=a[i];r.Cartesian2.equals(s,o)||n.push(o)}return n},h.angleIsGreaterThanPi=function(a,e,n,i){return a=(i=new t.EllipsoidTangentPlane(n,i)).projectPointOntoPlane(r.Cartesian3.add(n,a,P),P),0<=(e=i.projectPointOntoPlane(r.Cartesian3.add(n,e,E),E)).x*a.y-e.y*a.x};var Q=new r.Cartesian3,F=new r.Cartesian3;h.computePositions=function(a,n,t,w,P){var E=w._ellipsoid,M=function(a,e){for(var r=new Array(a.length),n=0;n<a.length;n++){var t=a[n];v=e.cartesianToCartographic(t,v),r[n]=v.height,a[n]=e.scaleToGeodeticSurface(t,t)}return r}(a,E),T=w._granularity,B=w._cornerType,b=(P?function(a,e){var r=a.length,n=new Array(6*r),t=0,i=e.x+e.width/2,s=e.y+e.height/2,o=a[0];n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s;for(var l=1;l<r;l++){var C=(o=a[l]).x-i,c=o.y-s;n[t++]=C,n[t++]=0,n[t++]=c,n[t++]=C,n[t++]=0,n[t++]=c}return o=a[0],n[t++]=o.x-i,n[t++]=0,n[t++]=o.y-s,n}:G)(n,t),z=(n=P?G(n,t):void 0,t.height/2),S=t.width/2,A=a.length,D=[],N=(t=P?[]:void 0,l),R=C,I=c,L=u,U=y,_=d,q=m,Y=f,Z=p,k=a[0],H=a[1];L=E.geodeticSurfaceNormal(k,L),N=r.Cartesian3.subtract(H,k,N),N=r.Cartesian3.normalize(N,N),Y=r.Cartesian3.cross(L,N,Y),Y=r.Cartesian3.normalize(Y,Y);var J,K=M[0],W=M[1];P&&(t=O(k,Y,n,t,E,K+z,1,1)),Z=r.Cartesian3.clone(k,Z),k=H,R=r.Cartesian3.negate(N,R);for(var X=1;X<A-1;X++){var $=P?2:1;H=a[X+1],N=r.Cartesian3.subtract(H,k,N),N=r.Cartesian3.normalize(N,N),I=r.Cartesian3.add(N,R,I),I=r.Cartesian3.normalize(I,I),L=E.geodeticSurfaceNormal(k,L);var aa=r.Cartesian3.multiplyByScalar(L,r.Cartesian3.dot(N,L),Q);r.Cartesian3.subtract(N,aa,aa),r.Cartesian3.normalize(aa,aa);var ea=r.Cartesian3.multiplyByScalar(L,r.Cartesian3.dot(R,L),F);r.Cartesian3.subtract(R,ea,ea),r.Cartesian3.normalize(ea,ea),e.CesiumMath.equalsEpsilon(Math.abs(r.Cartesian3.dot(aa,ea)),1,e.CesiumMath.EPSILON7)?(D=O(Z,Y,b,D,E,K+z,1,1),Z=k):(I=r.Cartesian3.cross(I,L,I),I=r.Cartesian3.cross(L,I,I),I=r.Cartesian3.normalize(I,I),aa=1/Math.max(.25,r.Cartesian3.magnitude(r.Cartesian3.cross(I,R,g))),(ea=h.angleIsGreaterThanPi(N,R,k,E))?(U=r.Cartesian3.add(k,r.Cartesian3.multiplyByScalar(I,aa*S,I),U),_=r.Cartesian3.add(U,r.Cartesian3.multiplyByScalar(Y,S,_),_),o[0]=r.Cartesian3.clone(Z,o[0]),o[1]=r.Cartesian3.clone(_,o[1]),J=x(o,K+z,W+z,T),D=V(i.PolylinePipeline.generateArc({positions:o,granularity:T,ellipsoid:E}),Y,b,D,E,J,1),Y=r.Cartesian3.cross(L,N,Y),Y=r.Cartesian3.normalize(Y,Y),q=r.Cartesian3.add(U,r.Cartesian3.multiplyByScalar(Y,S,q),q),B===s.ROUNDED||B===s.BEVELED?j(U,_,q,B,ea,E,D,b,W+z,P):D=O(k,I=r.Cartesian3.negate(I,I),b,D,E,W+z,aa,$)):(U=r.Cartesian3.add(k,r.Cartesian3.multiplyByScalar(I,aa*S,I),U),_=r.Cartesian3.add(U,r.Cartesian3.multiplyByScalar(Y,-S,_),_),o[0]=r.Cartesian3.clone(Z,o[0]),o[1]=r.Cartesian3.clone(_,o[1]),J=x(o,K+z,W+z,T),D=V(i.PolylinePipeline.generateArc({positions:o,granularity:T,ellipsoid:E}),Y,b,D,E,J,1),Y=r.Cartesian3.cross(L,N,Y),Y=r.Cartesian3.normalize(Y,Y),q=r.Cartesian3.add(U,r.Cartesian3.multiplyByScalar(Y,-S,q),q),B===s.ROUNDED||B===s.BEVELED?j(U,_,q,B,ea,E,D,b,W+z,P):D=O(k,I,b,D,E,W+z,aa,$)),Z=r.Cartesian3.clone(q,Z),R=r.Cartesian3.negate(N,R)),K=W,W=M[X+1],k=H}return o[0]=r.Cartesian3.clone(Z,o[0]),o[1]=r.Cartesian3.clone(k,o[1]),J=x(o,K+z,W+z,T),D=V(i.PolylinePipeline.generateArc({positions:o,granularity:T,ellipsoid:E}),Y,b,D,E,J,1),P&&(t=O(k,Y,n,t,E,W+z,1,1)),A=D.length,n=P?A+t.length:A,(n=new Float64Array(n)).set(D),P&&n.set(t,A),n},a.CornerType=s,a.PolylineVolumeGeometryLibrary=h}));