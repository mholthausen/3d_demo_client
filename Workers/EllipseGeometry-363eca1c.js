define(["exports","./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-6f81ad4c","./ComponentDatatype-6d99a1ee","./GeometryAttribute-700c1da0","./GeometryAttributes-4fcfcf40","./GeometryPipeline-e6a15a43","./IndexDatatype-53503fee","./GeometryOffsetAttribute-7350d9af","./VertexFormat-7572c785","./EllipseGeometryLibrary-8006bb76","./GeometryInstance-bee96382"],(function(t,e,r,a,i,n,o,s,u,l,m,c,p,y,d){"use strict";var f=new i.Cartesian3,A=new i.Cartesian3,h=new i.Cartesian3,x=new i.Cartesian3,g=new i.Cartesian2,_=new n.Matrix3,b=new n.Matrix3,C=new n.Quaternion,v=new i.Cartesian3,w=new i.Cartesian3,M=new i.Cartesian3,E=new i.Cartographic,I=new i.Cartesian3,T=new i.Cartesian2,G=new i.Cartesian2;function N(t,r,a){var l=r.vertexFormat,m=r.center,p=r.semiMajorAxis,d=r.semiMinorAxis,x=r.ellipsoid,N=r.stRotation,P=a?t.length/3*2:t.length/3,F=r.shadowVolume,V=l.st?new Float32Array(2*P):void 0,D=l.normal?new Float32Array(3*P):void 0,O=l.tangent?new Float32Array(3*P):void 0,S=l.bitangent?new Float32Array(3*P):void 0,L=F?new Float32Array(3*P):void 0,R=0,j=v,k=w,z=M,B=new n.GeographicProjection(x),Y=B.project(x.cartesianToCartographic(m,E),I);m=x.scaleToGeodeticSurface(m,f),x.geodeticSurfaceNormal(m,m);var H=_,U=b;U=0!==N?(it=n.Quaternion.fromAxisAngle(m,N,C),H=n.Matrix3.fromQuaternion(it,H),it=n.Quaternion.fromAxisAngle(m,-N,C),n.Matrix3.fromQuaternion(it,U)):(H=n.Matrix3.clone(n.Matrix3.IDENTITY,H),n.Matrix3.clone(n.Matrix3.IDENTITY,U));for(var Q=i.Cartesian2.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,T),W=i.Cartesian2.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,G),J=t.length,q=a?J:0,Z=q/3*2,K=0;K<J;K+=3){var X,$=K+1,tt=K+2,et=i.Cartesian3.fromArray(t,K,f);l.st&&(X=n.Matrix3.multiplyByVector(H,et,A),X=B.project(x.cartesianToCartographic(X,E),h),i.Cartesian3.subtract(X,Y,X),g.x=(X.x+p)/(2*p),g.y=(X.y+d)/(2*d),Q.x=Math.min(g.x,Q.x),Q.y=Math.min(g.y,Q.y),W.x=Math.max(g.x,W.x),W.y=Math.max(g.y,W.y),a&&(V[R+Z]=g.x,V[R+1+Z]=g.y),V[R++]=g.x,V[R++]=g.y),(l.normal||l.tangent||l.bitangent||F)&&(j=x.geodeticSurfaceNormal(et,j),F&&(L[K+q]=-j.x,L[$+q]=-j.y,L[tt+q]=-j.z),(l.normal||l.tangent||l.bitangent)&&((l.tangent||l.bitangent)&&(k=i.Cartesian3.normalize(i.Cartesian3.cross(i.Cartesian3.UNIT_Z,j,k),k),n.Matrix3.multiplyByVector(U,k,k)),l.normal&&(D[K]=j.x,D[$]=j.y,D[tt]=j.z,a&&(D[K+q]=-j.x,D[$+q]=-j.y,D[tt+q]=-j.z)),l.tangent&&(O[K]=k.x,O[$]=k.y,O[tt]=k.z,a&&(O[K+q]=-k.x,O[$+q]=-k.y,O[tt+q]=-k.z)),l.bitangent&&(z=i.Cartesian3.normalize(i.Cartesian3.cross(j,k,z),z),S[K]=z.x,S[$]=z.y,S[tt]=z.z,a&&(S[K+q]=z.x,S[$+q]=z.y,S[tt+q]=z.z))))}if(l.st){J=V.length;for(var rt=0;rt<J;rt+=2)V[rt]=(V[rt]-Q.x)/(W.x-Q.x),V[rt+1]=(V[rt+1]-Q.y)/(W.y-Q.y)}var at,it=new u.GeometryAttributes;return l.position&&(at=y.EllipseGeometryLibrary.raisePositionsToHeight(t,r,a),it.position=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:at})),l.st&&(it.st=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:V})),l.normal&&(it.normal=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:D})),l.tangent&&(it.tangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:O})),l.bitangent&&(it.bitangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:S})),F&&(it.extrudeDirection=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:L})),a&&e.defined(r.offsetAttribute)&&(at=new Uint8Array(P),at=r.offsetAttribute===c.GeometryOffsetAttribute.TOP?c.arrayFill(at,1,0,P/2):(r=r.offsetAttribute===c.GeometryOffsetAttribute.NONE?0:1,c.arrayFill(at,r)),it.applyOffset=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:at})),it}function P(t){for(var e,r,a=new Array(t*(t+1)*12-6),i=0,n=0,o=1,s=0;s<3;s++)a[i++]=o++,a[i++]=n,a[i++]=o;for(s=2;s<t+1;++s){for(o=s*(s+1)-1,n=(s-1)*s-1,a[i++]=o++,a[i++]=n,a[i++]=o,e=2*s,r=0;r<e-1;++r)a[i++]=o,a[i++]=n++,a[i++]=n,a[i++]=o++,a[i++]=n,a[i++]=o;a[i++]=o++,a[i++]=n,a[i++]=o}for(e=2*t,++o,++n,s=0;s<e-1;++s)a[i++]=o,a[i++]=n++,a[i++]=n,a[i++]=o++,a[i++]=n,a[i++]=o;for(a[i++]=o,a[i++]=n++,a[i++]=n,a[i++]=o++,a[i++]=n++,a[i++]=n,++n,s=t-1;1<s;--s){for(a[i++]=n++,a[i++]=n,a[i++]=o,e=2*s,r=0;r<e-1;++r)a[i++]=o,a[i++]=n++,a[i++]=n,a[i++]=o++,a[i++]=n,a[i++]=o;a[i++]=n++,a[i++]=n++,a[i++]=o++}for(s=0;s<3;s++)a[i++]=n++,a[i++]=n,a[i++]=o;return a}var F=new i.Cartesian3,V=new n.BoundingSphere,D=new n.BoundingSphere;function O(t,e,r,n,o,s,u){for(var l=y.EllipseGeometryLibrary.computeEllipsePositions({center:t,semiMajorAxis:e,semiMinorAxis:r,rotation:n,granularity:o},!1,!0).outerPositions,m=l.length/3,c=new Array(m),p=0;p<m;++p)c[p]=i.Cartesian3.fromArray(l,3*p);return(u=i.Rectangle.fromCartesianArray(c,s,u)).width>a.CesiumMath.PI&&(u.north=0<u.north?a.CesiumMath.PI_OVER_TWO-a.CesiumMath.EPSILON7:u.north,u.south=u.south<0?a.CesiumMath.EPSILON7-a.CesiumMath.PI_OVER_TWO:u.south,u.east=a.CesiumMath.PI,u.west=-a.CesiumMath.PI),u}function S(t){var r=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).center,n=e.defaultValue(t.ellipsoid,i.Ellipsoid.WGS84),o=t.semiMajorAxis,s=t.semiMinorAxis,u=e.defaultValue(t.granularity,a.CesiumMath.RADIANS_PER_DEGREE),l=e.defaultValue(t.vertexFormat,p.VertexFormat.DEFAULT),m=e.defaultValue(t.height,0),c=e.defaultValue(t.extrudedHeight,m);this._center=i.Cartesian3.clone(r),this._semiMajorAxis=o,this._semiMinorAxis=s,this._ellipsoid=i.Ellipsoid.clone(n),this._rotation=e.defaultValue(t.rotation,0),this._stRotation=e.defaultValue(t.stRotation,0),this._height=Math.max(c,m),this._granularity=u,this._vertexFormat=p.VertexFormat.clone(l),this._extrudedHeight=Math.min(c,m),this._shadowVolume=e.defaultValue(t.shadowVolume,!1),this._workerName="createEllipseGeometry",this._offsetAttribute=t.offsetAttribute,this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0}S.packedLength=i.Cartesian3.packedLength+i.Ellipsoid.packedLength+p.VertexFormat.packedLength+9,S.pack=function(t,r,a){return a=e.defaultValue(a,0),i.Cartesian3.pack(t._center,r,a),a+=i.Cartesian3.packedLength,i.Ellipsoid.pack(t._ellipsoid,r,a),a+=i.Ellipsoid.packedLength,p.VertexFormat.pack(t._vertexFormat,r,a),a+=p.VertexFormat.packedLength,r[a++]=t._semiMajorAxis,r[a++]=t._semiMinorAxis,r[a++]=t._rotation,r[a++]=t._stRotation,r[a++]=t._height,r[a++]=t._granularity,r[a++]=t._extrudedHeight,r[a++]=t._shadowVolume?1:0,r[a]=e.defaultValue(t._offsetAttribute,-1),r};var L=new i.Cartesian3,R=new i.Ellipsoid,j=new p.VertexFormat,k={center:L,ellipsoid:R,vertexFormat:j,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,stRotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};S.unpack=function(t,r,a){r=e.defaultValue(r,0);var n=i.Cartesian3.unpack(t,r,L);r+=i.Cartesian3.packedLength;var o=i.Ellipsoid.unpack(t,r,R);r+=i.Ellipsoid.packedLength;var s=p.VertexFormat.unpack(t,r,j);r+=p.VertexFormat.packedLength;var u=t[r++],l=t[r++],m=t[r++],c=t[r++],y=t[r++],d=t[r++],f=t[r++],A=1===t[r++];return r=t[r],e.defined(a)?(a._center=i.Cartesian3.clone(n,a._center),a._ellipsoid=i.Ellipsoid.clone(o,a._ellipsoid),a._vertexFormat=p.VertexFormat.clone(s,a._vertexFormat),a._semiMajorAxis=u,a._semiMinorAxis=l,a._rotation=m,a._stRotation=c,a._height=y,a._granularity=d,a._extrudedHeight=f,a._shadowVolume=A,a._offsetAttribute=-1===r?void 0:r,a):(k.height=y,k.extrudedHeight=f,k.granularity=d,k.stRotation=c,k.rotation=m,k.semiMajorAxis=u,k.semiMinorAxis=l,k.shadowVolume=A,k.offsetAttribute=-1===r?void 0:r,new S(k))},S.computeRectangle=function(t,r){var n=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).center,o=e.defaultValue(t.ellipsoid,i.Ellipsoid.WGS84),s=t.semiMajorAxis,u=t.semiMinorAxis,l=e.defaultValue(t.granularity,a.CesiumMath.RADIANS_PER_DEGREE);return O(n,s,u,e.defaultValue(t.rotation,0),l,o,r)},S.createGeometry=function(t){if(!(t._semiMajorAxis<=0||t._semiMinorAxis<=0)){var r,p=t._height,b=t._extrudedHeight,O=!a.CesiumMath.equalsEpsilon(p,b,0,a.CesiumMath.EPSILON2);return t._center=t._ellipsoid.scaleToGeodeticSurface(t._center,t._center),p={center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,ellipsoid:t._ellipsoid,rotation:t._rotation,height:p,granularity:t._granularity,vertexFormat:t._vertexFormat,stRotation:t._stRotation},O?(p.extrudedHeight=b,p.shadowVolume=t._shadowVolume,p.offsetAttribute=t._offsetAttribute,r=function(t){var r=t.center,a=t.ellipsoid,p=t.semiMajorAxis,b=i.Cartesian3.multiplyByScalar(a.geodeticSurfaceNormal(r,f),t.height,f);V.center=i.Cartesian3.add(r,b,V.center),V.radius=p,b=i.Cartesian3.multiplyByScalar(a.geodeticSurfaceNormal(r,b),t.extrudedHeight,b),D.center=i.Cartesian3.add(r,b,D.center),D.radius=p,a=(F=y.EllipseGeometryLibrary.computeEllipsePositions(t,!0,!0)).positions,r=F.numPts,b=F.outerPositions,p=n.BoundingSphere.union(V,D);var F=N(a,t,!0),O=(R=P(r)).length;R.length=2*O;for(var S=a.length/3,L=0;L<O;L+=3)R[L+O]=R[L+2]+S,R[L+1+O]=R[L+1]+S,R[L+2+O]=R[L]+S;a=m.IndexDatatype.createTypedArray(2*S/3,R),a=new s.Geometry({attributes:F,indices:a,primitiveType:s.PrimitiveType.TRIANGLES}),t=function(t,r){var a=r.vertexFormat,l=r.center,m=r.semiMajorAxis,p=r.semiMinorAxis,y=r.ellipsoid,d=r.height,b=r.extrudedHeight,N=r.stRotation,P=t.length/3*2,F=new Float64Array(3*P),V=a.st?new Float32Array(2*P):void 0,D=a.normal?new Float32Array(3*P):void 0,O=a.tangent?new Float32Array(3*P):void 0,S=a.bitangent?new Float32Array(3*P):void 0,L=r.shadowVolume,R=L?new Float32Array(3*P):void 0,j=0,k=v,z=w,B=M,Y=new n.GeographicProjection(y),H=Y.project(y.cartesianToCartographic(l,E),I);l=y.scaleToGeodeticSurface(l,f),y.geodeticSurfaceNormal(l,l),l=n.Quaternion.fromAxisAngle(l,N,C);for(var U=n.Matrix3.fromQuaternion(l,_),Q=i.Cartesian2.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,T),W=i.Cartesian2.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,G),J=t.length,q=J/3*2,Z=0;Z<J;Z+=3){var K=Z+1,X=Z+2,$=i.Cartesian3.fromArray(t,Z,f);a.st&&(et=n.Matrix3.multiplyByVector(U,$,A),tt=Y.project(y.cartesianToCartographic(et,E),h),i.Cartesian3.subtract(tt,H,tt),g.x=(tt.x+m)/(2*m),g.y=(tt.y+p)/(2*p),Q.x=Math.min(g.x,Q.x),Q.y=Math.min(g.y,Q.y),W.x=Math.max(g.x,W.x),W.y=Math.max(g.y,W.y),V[j+q]=g.x,V[j+1+q]=g.y,V[j++]=g.x,V[j++]=g.y),$=y.scaleToGeodeticSurface($,$),et=i.Cartesian3.clone($,A),k=y.geodeticSurfaceNormal($,k),L&&(R[Z+J]=-k.x,R[K+J]=-k.y,R[X+J]=-k.z);var tt=i.Cartesian3.multiplyByScalar(k,d,x),et=($=i.Cartesian3.add($,tt,$),tt=i.Cartesian3.multiplyByScalar(k,b,tt),i.Cartesian3.add(et,tt,et));a.position&&(F[Z+J]=et.x,F[K+J]=et.y,F[X+J]=et.z,F[Z]=$.x,F[K]=$.y,F[X]=$.z),(a.normal||a.tangent||a.bitangent)&&(B=i.Cartesian3.clone(k,B),tt=i.Cartesian3.fromArray(t,(Z+3)%J,x),i.Cartesian3.subtract(tt,$,tt),$=i.Cartesian3.subtract(et,$,h),k=i.Cartesian3.normalize(i.Cartesian3.cross($,tt,k),k),a.normal&&(D[Z]=k.x,D[K]=k.y,D[X]=k.z,D[Z+J]=k.x,D[K+J]=k.y,D[X+J]=k.z),a.tangent&&(z=i.Cartesian3.normalize(i.Cartesian3.cross(B,k,z),z),O[Z]=z.x,O[K]=z.y,O[X]=z.z,O[Z+J]=z.x,O[Z+1+J]=z.y,O[Z+2+J]=z.z),a.bitangent&&(S[Z]=B.x,S[K]=B.y,S[X]=B.z,S[Z+J]=B.x,S[K+J]=B.y,S[X+J]=B.z))}if(a.st){J=V.length;for(var rt=0;rt<J;rt+=2)V[rt]=(V[rt]-Q.x)/(W.x-Q.x),V[rt+1]=(V[rt+1]-Q.y)/(W.y-Q.y)}return N=new u.GeometryAttributes,a.position&&(N.position=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:F})),a.st&&(N.st=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:V})),a.normal&&(N.normal=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:D})),a.tangent&&(N.tangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:O})),a.bitangent&&(N.bitangent=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:S})),L&&(N.extrudeDirection=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:R})),e.defined(r.offsetAttribute)&&(l=new Uint8Array(P),l=r.offsetAttribute===c.GeometryOffsetAttribute.TOP?c.arrayFill(l,1,0,P/2):(r=r.offsetAttribute===c.GeometryOffsetAttribute.NONE?0:1,c.arrayFill(l,r)),N.applyOffset=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:l})),N}(b,t);var R=function(t){for(var e=t.length/3,r=m.IndexDatatype.createTypedArray(e,6*e),a=0,i=0;i<e;i++){var n=i+e,o=(i+1)%e,s=o+e;r[a++]=i,r[a++]=n,r[a++]=o,r[a++]=o,r[a++]=n,r[a++]=s}return r}(b);return b=m.IndexDatatype.createTypedArray(2*b.length/3,R),b=new s.Geometry({attributes:t,indices:b,primitiveType:s.PrimitiveType.TRIANGLES}),{boundingSphere:p,attributes:(b=l.GeometryPipeline.combineInstances([new d.GeometryInstance({geometry:a}),new d.GeometryInstance({geometry:b})]))[0].attributes,indices:b[0].indices}}(p)):(r=function(t){var e=t.center;F=i.Cartesian3.multiplyByScalar(t.ellipsoid.geodeticSurfaceNormal(e,F),t.height,F),F=i.Cartesian3.add(e,F,F);var r=new n.BoundingSphere(F,t.semiMajorAxis),a=(e=(a=y.EllipseGeometryLibrary.computeEllipsePositions(t,!0,!1)).positions,a.numPts);return t=N(e,t,!1),a=P(a),{boundingSphere:r,attributes:t,indices:a=m.IndexDatatype.createTypedArray(e.length/3,a)}}(p),e.defined(t._offsetAttribute)&&(b=r.attributes.position.values.length,p=new Uint8Array(b/3),b=t._offsetAttribute===c.GeometryOffsetAttribute.NONE?0:1,c.arrayFill(p,b),r.attributes.applyOffset=new s.GeometryAttribute({componentDatatype:o.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:p}))),new s.Geometry({attributes:r.attributes,indices:r.indices,primitiveType:s.PrimitiveType.TRIANGLES,boundingSphere:r.boundingSphere,offsetAttribute:t._offsetAttribute})}},S.createShadowVolume=function(t,e,r){var a=t._granularity,i=t._ellipsoid;return e=e(a,i),r=r(a,i),new S({center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,ellipsoid:i,rotation:t._rotation,stRotation:t._stRotation,granularity:a,extrudedHeight:e,height:r,vertexFormat:p.VertexFormat.POSITION_ONLY,shadowVolume:!0})},Object.defineProperties(S.prototype,{rectangle:{get:function(){return e.defined(this._rectangle)||(this._rectangle=O(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return e.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(t){var e=-t._stRotation;if(0==e)return[0,0,0,1,1,0];for(var r=y.EllipseGeometryLibrary.computeEllipsePositions({center:t._center,semiMajorAxis:t._semiMajorAxis,semiMinorAxis:t._semiMinorAxis,rotation:t._rotation,granularity:t._granularity},!1,!0).outerPositions,a=r.length/3,n=new Array(a),o=0;o<a;++o)n[o]=i.Cartesian3.fromArray(r,3*o);var u=t._ellipsoid;return t=t.rectangle,s.Geometry._textureCoordinateRotationPoints(n,e,u,t)}(this)),this._textureCoordinateRotationPoints}}}),t.EllipseGeometry=S}));