define(["./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-6f81ad4c","./RuntimeError-2109023a","./WebGLConstants-76bb35d1","./ComponentDatatype-6d99a1ee","./GeometryAttribute-700c1da0","./GeometryAttributes-4fcfcf40","./IndexDatatype-53503fee","./IntersectionTests-7f3bcd5c","./Plane-b6058d9b","./GeometryOffsetAttribute-7350d9af","./arrayRemoveDuplicates-ebc732b0","./EllipsoidTangentPlane-c3f203b0","./EllipsoidRhumbLine-c704bf4c","./PolygonPipeline-1aceedbc","./PolylineVolumeGeometryLibrary-0216ec14","./EllipsoidGeodesic-30fae80b","./PolylinePipeline-7685bebd","./CorridorGeometryLibrary-69ffa0db"],(function(e,t,i,r,o,a,n,s,l,d,u,p,f,h,c,y,b,g,m,v,A,_){"use strict";var E=new r.Cartesian3,C=new r.Cartesian3,G=new r.Cartesian3;function T(t,i){var o,a=[],n=t.positions,p=t.corners,f=t.endPositions,h=new d.GeometryAttributes,c=0,y=0,b=0;for(M=0;M<n.length;M+=2)c+=o=n[M].length-3,b+=o/3*4,y+=n[M+1].length-3;for(c+=3,y+=3,M=0;M<p.length;M++){Y=p[M];var g=p[M].leftPositions;e.defined(g)?c+=o=g.length:y+=o=p[M].rightPositions.length,b+=o/3*2}var v,A=e.defined(f);A&&(c+=v=f[0].length-3,y+=v,b+=4*(v/=3)),t=c+y;var T,P,w,L,D,k,N=new Float64Array(t),O=0,V=t-1,x=v/2,H=u.IndexDatatype.createTypedArray(t/3,b+4),I=0;if(H[I++]=O/3,H[I++]=(V-2)/3,A){a.push(O/3),k=E,D=C;for(var S=f[0],M=0;M<x;M++)k=r.Cartesian3.fromArray(S,3*(x-1-M),k),D=r.Cartesian3.fromArray(S,3*(x+M),D),_.CorridorGeometryLibrary.addAttribute(N,D,O),_.CorridorGeometryLibrary.addAttribute(N,k,void 0,V),L=1+(P=O/3),w=(T=(V-2)/3)-1,H[I++]=T,H[I++]=w,H[I++]=P,H[I++]=L,O+=3,V-=3}var R=0,B=n[R++],U=n[R++];for(N.set(B,O),N.set(U,V-U.length+1),o=U.length-3,a.push(O/3,(V-2)/3),M=0;M<o;M+=3)L=1+(P=O/3),w=(T=(V-2)/3)-1,H[I++]=T,H[I++]=w,H[I++]=P,H[I++]=L,O+=3,V-=3;for(M=0;M<p.length;M++){var F,Y,q,W=(Y=p[M]).leftPositions,J=Y.rightPositions,j=G;if(e.defined(W)){for(V-=3,q=w,a.push(L),F=0;F<W.length/3;F++)j=r.Cartesian3.fromArray(W,3*F,j),H[I++]=q-F-1,H[I++]=q-F,_.CorridorGeometryLibrary.addAttribute(N,j,void 0,V),V-=3;a.push(q-Math.floor(W.length/6)),i===m.CornerType.BEVELED&&a.push((V-2)/3+1),O+=3}else{for(O+=3,q=L,a.push(w),F=0;F<J.length/3;F++)j=r.Cartesian3.fromArray(J,3*F,j),H[I++]=q+F,H[I++]=q+F+1,_.CorridorGeometryLibrary.addAttribute(N,j,O),O+=3;a.push(q+Math.floor(J.length/6)),i===m.CornerType.BEVELED&&a.push(O/3-1),V-=3}for(B=n[R++],U=n[R++],B.splice(0,3),U.splice(U.length-3,3),N.set(B,O),N.set(U,V-U.length+1),o=U.length-3,F=0;F<U.length;F+=3)P=(L=O/3)-1,T=1+(w=(V-2)/3),H[I++]=T,H[I++]=w,H[I++]=P,H[I++]=L,O+=3,V-=3;O-=3,V+=3,a.push(O/3,(V-2)/3)}if(A){O+=3,V-=3,k=E,D=C;var z=f[1];for(M=0;M<x;M++)k=r.Cartesian3.fromArray(z,3*(v-M-1),k),D=r.Cartesian3.fromArray(z,3*M,D),_.CorridorGeometryLibrary.addAttribute(N,k,void 0,V),_.CorridorGeometryLibrary.addAttribute(N,D,O),P=(L=O/3)-1,T=1+(w=(V-2)/3),H[I++]=T,H[I++]=w,H[I++]=P,H[I++]=L,O+=3,V-=3;a.push(O/3)}else a.push(O/3,(V-2)/3);return H[I++]=O/3,H[I++]=(V-2)/3,h.position=new l.GeometryAttribute({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:N}),{attributes:h,indices:H,wallIndices:a}}function P(t){var o=(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).positions,a=t.width,n=e.defaultValue(t.height,0),s=e.defaultValue(t.extrudedHeight,n);this._positions=o,this._ellipsoid=r.Ellipsoid.clone(e.defaultValue(t.ellipsoid,r.Ellipsoid.WGS84)),this._width=a,this._height=Math.max(n,s),this._extrudedHeight=Math.min(n,s),this._cornerType=e.defaultValue(t.cornerType,m.CornerType.ROUNDED),this._granularity=e.defaultValue(t.granularity,i.CesiumMath.RADIANS_PER_DEGREE),this._offsetAttribute=t.offsetAttribute,this._workerName="createCorridorOutlineGeometry",this.packedLength=1+o.length*r.Cartesian3.packedLength+r.Ellipsoid.packedLength+6}P.pack=function(t,i,o){o=e.defaultValue(o,0);var a=t._positions,n=a.length;i[o++]=n;for(var s=0;s<n;++s,o+=r.Cartesian3.packedLength)r.Cartesian3.pack(a[s],i,o);return r.Ellipsoid.pack(t._ellipsoid,i,o),o+=r.Ellipsoid.packedLength,i[o++]=t._width,i[o++]=t._height,i[o++]=t._extrudedHeight,i[o++]=t._cornerType,i[o++]=t._granularity,i[o]=e.defaultValue(t._offsetAttribute,-1),i};var w=r.Ellipsoid.clone(r.Ellipsoid.UNIT_SPHERE),L={positions:void 0,ellipsoid:w,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,offsetAttribute:void 0};return P.unpack=function(t,i,o){i=e.defaultValue(i,0);for(var a=t[i++],n=new Array(a),s=0;s<a;++s,i+=r.Cartesian3.packedLength)n[s]=r.Cartesian3.unpack(t,i);var l=r.Ellipsoid.unpack(t,i,w);i+=r.Ellipsoid.packedLength;var d=t[i++],u=t[i++],p=t[i++],f=t[i++],h=t[i++],c=t[i];return e.defined(o)?(o._positions=n,o._ellipsoid=r.Ellipsoid.clone(l,o._ellipsoid),o._width=d,o._height=u,o._extrudedHeight=p,o._cornerType=f,o._granularity=h,o._offsetAttribute=-1===c?void 0:c,o):(L.positions=n,L.width=d,L.height=u,L.extrudedHeight=p,L.cornerType=f,L.granularity=h,L.offsetAttribute=-1===c?void 0:c,new P(L))},P.createGeometry=function(t){var a=t._positions,n=t._width,d=t._ellipsoid,p=(a=function(e,t){for(var i=0;i<e.length;i++)e[i]=t.scaleToGeodeticSurface(e[i],e[i]);return e}(a,d),c.arrayRemoveDuplicates(a,r.Cartesian3.equalsEpsilon));if(!(p.length<2||n<=0)){var f,y=t._height,b=t._extrudedHeight;a=!i.CesiumMath.equalsEpsilon(y,b,0,i.CesiumMath.EPSILON2),n={ellipsoid:d,positions:p,width:n,cornerType:t._cornerType,granularity:t._granularity,saveAttributes:!1},a?(n.height=y,n.extrudedHeight=b,n.offsetAttribute=t._offsetAttribute,f=function(t){var i=t.ellipsoid,r=(f=T(_.CorridorGeometryLibrary.computePositions(t),t.cornerType)).wallIndices,o=t.height,a=t.extrudedHeight,n=f.attributes,d=f.indices,p=(c=n.position.values).length;(y=new Float64Array(p)).set(c);var f=new Float64Array(2*p),c=g.PolygonPipeline.scaleToGeodeticHeight(c,o,i),y=g.PolygonPipeline.scaleToGeodeticHeight(y,a,i);f.set(c),f.set(y,p),n.position.values=f,p/=3,e.defined(t.offsetAttribute)&&(y=new Uint8Array(2*p),y=t.offsetAttribute===h.GeometryOffsetAttribute.TOP?h.arrayFill(y,1,0,p):(t=t.offsetAttribute===h.GeometryOffsetAttribute.NONE?0:1,h.arrayFill(y,t)),n.applyOffset=new l.GeometryAttribute({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:y}));var b=d.length,m=u.IndexDatatype.createTypedArray(f.length/3,2*(b+r.length));m.set(d);for(var v,A,E=b,C=0;C<b;C+=2){var G=d[C],P=d[C+1];m[E++]=G+p,m[E++]=P+p}for(C=0;C<r.length;C++)A=(v=r[C])+p,m[E++]=v,m[E++]=A;return{attributes:n,indices:m}}(n)):((f=T(_.CorridorGeometryLibrary.computePositions(n),n.cornerType)).attributes.position.values=g.PolygonPipeline.scaleToGeodeticHeight(f.attributes.position.values,y,d),e.defined(t._offsetAttribute)&&(m=f.attributes.position.values.length,v=new Uint8Array(m/3),m=t._offsetAttribute===h.GeometryOffsetAttribute.NONE?0:1,h.arrayFill(v,m),f.attributes.applyOffset=new l.GeometryAttribute({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:v})));var m=f.attributes,v=o.BoundingSphere.fromVertices(m.position.values,void 0,3);return new l.Geometry({attributes:m,indices:f.indices,primitiveType:l.PrimitiveType.LINES,boundingSphere:v,offsetAttribute:t._offsetAttribute})}},function(t,i){return e.defined(i)&&(t=P.unpack(t,i)),t._ellipsoid=r.Ellipsoid.clone(t._ellipsoid),P.createGeometry(t)}}));