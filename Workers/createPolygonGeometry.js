define(["./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-6f81ad4c","./RuntimeError-2109023a","./WebGLConstants-76bb35d1","./ComponentDatatype-6d99a1ee","./GeometryAttribute-700c1da0","./GeometryAttributes-4fcfcf40","./AttributeCompression-9fc99391","./GeometryPipeline-e6a15a43","./EncodedCartesian3-4df2eabb","./IndexDatatype-53503fee","./IntersectionTests-7f3bcd5c","./Plane-b6058d9b","./GeometryOffsetAttribute-7350d9af","./VertexFormat-7572c785","./GeometryInstance-bee96382","./arrayRemoveDuplicates-ebc732b0","./BoundingRectangle-4f9baeda","./EllipsoidTangentPlane-c3f203b0","./ArcType-dc1c5aee","./EllipsoidRhumbLine-c704bf4c","./PolygonPipeline-1aceedbc","./PolygonGeometryLibrary-82c2c5a4","./EllipsoidGeodesic-30fae80b"],(function(e,t,r,o,a,i,n,s,l,u,c,p,y,m,g,d,h,f,b,_,v,P,C,w,x,T,I){"use strict";var A=new o.Cartographic,E=new o.Cartographic,G=new v.BoundingRectangle,O=new o.Cartesian3,V=new o.Cartesian3,F=new o.Cartesian3,D=new o.Cartesian3,L=new o.Cartesian3,N=new o.Cartesian3,H=new o.Cartesian3,R=new o.Cartesian3,M=new o.Cartesian3,S=new o.Cartesian2,B=new o.Cartesian2,k=new o.Cartesian3,z=new a.Quaternion,W=new a.Matrix3,Y=new a.Matrix3;function U(t){var i,n=t.vertexFormat,u=t.geometry,c=t.shadowVolume,p=u.attributes.position.values,y=p.length,m=t.wall,g=t.top||m,d=t.bottom||m;if(n.st||n.normal||n.tangent||n.bitangent||c){var f=t.boundingRectangle,b=t.tangentPlane,_=t.ellipsoid,v=t.stRotation,P=t.perPositionHeight,C=S;C.x=f.x,C.y=f.y;var w,x=n.st?new Float32Array(y/3*2):void 0;n.normal&&(w=P&&g&&!m?u.attributes.normal.values:new Float32Array(y));var T,I=n.tangent?new Float32Array(y):void 0,G=n.bitangent?new Float32Array(y):void 0,U=c?new Float32Array(y):void 0,j=0,Q=0,q=V,K=F,Z=D,J=!0,X=W,$=Y;$=0!==v?(T=a.Quaternion.fromAxisAngle(b._plane.normal,v,z),X=a.Matrix3.fromQuaternion(T,X),T=a.Quaternion.fromAxisAngle(b._plane.normal,-v,z),a.Matrix3.fromQuaternion(T,$)):(X=a.Matrix3.clone(a.Matrix3.IDENTITY,X),a.Matrix3.clone(a.Matrix3.IDENTITY,$));var ee=0,te=0;g&&d&&(ee=y/2,te=y/3,y/=2);for(var re=0;re<y;re+=3){var oe,ae,ie,ne,se,le,ue,ce,pe=o.Cartesian3.fromArray(p,re,k);n.st&&(oe=a.Matrix3.multiplyByVector(X,pe,O),oe=_.scaleToGeodeticSurface(oe,oe),ae=b.projectPointOntoPlane(oe,B),o.Cartesian2.subtract(ae,C,ae),ie=r.CesiumMath.clamp(ae.x/f.width,0,1),ne=r.CesiumMath.clamp(ae.y/f.height,0,1),d&&(x[j+te]=ie,x[j+1+te]=ne),g&&(x[j]=ie,x[j+1]=ne),j+=2),(n.normal||n.tangent||n.bitangent||c)&&(se=Q+1,le=Q+2,m?(re+3<y&&(ue=o.Cartesian3.fromArray(p,re+3,L),J&&(ce=o.Cartesian3.fromArray(p,re+y,N),P&&(i=pe,oe=ue,ae=ce,ie=void 0,ie=(ne=_).cartesianToCartographic(i,A).height,(i=ne.cartesianToCartographic(oe,E)).height=ie,ne.cartographicToCartesian(i,oe),(oe=ne.cartesianToCartographic(ae,E)).height=ie-100,ne.cartographicToCartesian(oe,ae)),o.Cartesian3.subtract(ue,pe,ue),o.Cartesian3.subtract(ce,pe,ce),q=o.Cartesian3.normalize(o.Cartesian3.cross(ce,ue,q),q),J=!1),o.Cartesian3.equalsEpsilon(ue,pe,r.CesiumMath.EPSILON10)&&(J=!0)),(n.tangent||n.bitangent)&&(Z=_.geodeticSurfaceNormal(pe,Z),n.tangent&&(K=o.Cartesian3.normalize(o.Cartesian3.cross(Z,q,K),K)))):(q=_.geodeticSurfaceNormal(pe,q),(n.tangent||n.bitangent)&&(P&&(H=o.Cartesian3.fromArray(w,Q,H),R=o.Cartesian3.cross(o.Cartesian3.UNIT_Z,H,R),R=o.Cartesian3.normalize(a.Matrix3.multiplyByVector($,R,R),R),n.bitangent&&(M=o.Cartesian3.normalize(o.Cartesian3.cross(H,R,M),M))),K=o.Cartesian3.cross(o.Cartesian3.UNIT_Z,q,K),K=o.Cartesian3.normalize(a.Matrix3.multiplyByVector($,K,K),K),n.bitangent&&(Z=o.Cartesian3.normalize(o.Cartesian3.cross(q,K,Z),Z)))),n.normal&&(t.wall?(w[Q+ee]=q.x,w[se+ee]=q.y,w[le+ee]=q.z):d&&(w[Q+ee]=-q.x,w[se+ee]=-q.y,w[le+ee]=-q.z),(g&&!P||m)&&(w[Q]=q.x,w[se]=q.y,w[le]=q.z)),c&&(m&&(q=_.geodeticSurfaceNormal(pe,q)),U[Q+ee]=-q.x,U[se+ee]=-q.y,U[le+ee]=-q.z),n.tangent&&(t.wall?(I[Q+ee]=K.x,I[se+ee]=K.y,I[le+ee]=K.z):d&&(I[Q+ee]=-K.x,I[se+ee]=-K.y,I[le+ee]=-K.z),g&&(P?(I[Q]=R.x,I[se]=R.y,I[le]=R.z):(I[Q]=K.x,I[se]=K.y,I[le]=K.z))),n.bitangent&&(d&&(G[Q+ee]=Z.x,G[se+ee]=Z.y,G[le+ee]=Z.z),g&&(P?(G[Q]=M.x,G[se]=M.y,G[le]=M.z):(G[Q]=Z.x,G[se]=Z.y,G[le]=Z.z))),Q+=3)}n.st&&(u.attributes.st=new l.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:x})),n.normal&&(u.attributes.normal=new l.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:w})),n.tangent&&(u.attributes.tangent=new l.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:I})),n.bitangent&&(u.attributes.bitangent=new l.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:G})),c&&(u.attributes.extrudeDirection=new l.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:U}))}return t.extrude&&e.defined(t.offsetAttribute)&&(v=p.length/3,T=new Uint8Array(v),t.offsetAttribute===h.GeometryOffsetAttribute.TOP?g&&d||m?T=h.arrayFill(T,1,0,v/2):g&&(T=h.arrayFill(T,1)):(v=t.offsetAttribute===h.GeometryOffsetAttribute.NONE?0:1,T=h.arrayFill(T,v)),u.attributes.applyOffset=new l.GeometryAttribute({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:T})),u}var j=new o.Cartographic,Q=new o.Cartographic,q={westOverIDL:0,eastOverIDL:0},K=new I.EllipsoidGeodesic;function Z(t,a,i,n,s){if(s=e.defaultValue(s,new o.Rectangle),!e.defined(t)||t.length<3)return s.west=0,s.north=0,s.south=0,s.east=0,s;if(i===C.ArcType.RHUMB)return o.Rectangle.fromCartesianArray(t,a,s);K.ellipsoid.equals(a)||(K=new I.EllipsoidGeodesic(void 0,void 0,a)),s.west=Number.POSITIVE_INFINITY,s.east=Number.NEGATIVE_INFINITY,s.south=Number.POSITIVE_INFINITY,s.north=Number.NEGATIVE_INFINITY,q.westOverIDL=Number.POSITIVE_INFINITY,q.eastOverIDL=Number.NEGATIVE_INFINITY;for(var l,u=1/r.CesiumMath.chordLength(n,a.maximumRadius),c=t.length,p=a.cartesianToCartographic(t[0],Q),y=j,m=1;m<c;m++)l=y,y=p,p=a.cartesianToCartographic(t[m],l),K.setEndPoints(y,p),X(K,u,s,q);return l=y,y=p,p=a.cartesianToCartographic(t[0],l),K.setEndPoints(y,p),X(K,u,s,q),s.east-s.west>q.eastOverIDL-q.westOverIDL&&(s.west=q.westOverIDL,s.east=q.eastOverIDL,s.east>r.CesiumMath.PI&&(s.east=s.east-r.CesiumMath.TWO_PI),s.west>r.CesiumMath.PI&&(s.west=s.west-r.CesiumMath.TWO_PI)),s}var J=new o.Cartographic;function X(e,t,o,a){for(var i=e.surfaceDistance,n=Math.ceil(i*t),s=0<n?i/(n-1):Number.POSITIVE_INFINITY,l=0,u=0;u<n;u++){var c=e.interpolateUsingSurfaceDistance(l,J);l+=s;var p=c.longitude;c=c.latitude,o.west=Math.min(o.west,p),o.east=Math.max(o.east,p),o.south=Math.min(o.south,c),o.north=Math.max(o.north,c),p=0<=p?p:p+r.CesiumMath.TWO_PI,a.westOverIDL=Math.min(a.westOverIDL,p),a.eastOverIDL=Math.max(a.eastOverIDL,p)}}var $=[];function ee(t){var a,i=t.polygonHierarchy,n=e.defaultValue(t.vertexFormat,f.VertexFormat.DEFAULT),s=e.defaultValue(t.ellipsoid,o.Ellipsoid.WGS84),l=e.defaultValue(t.granularity,r.CesiumMath.RADIANS_PER_DEGREE),u=e.defaultValue(t.stRotation,0),c=e.defaultValue(t.perPositionHeight,!1),p=c&&e.defined(t.extrudedHeight),y=e.defaultValue(t.height,0),m=e.defaultValue(t.extrudedHeight,y);p||(a=Math.max(y,m),m=Math.min(y,m),y=a),this._vertexFormat=f.VertexFormat.clone(n),this._ellipsoid=o.Ellipsoid.clone(s),this._granularity=l,this._stRotation=u,this._height=y,this._extrudedHeight=m,this._closeTop=e.defaultValue(t.closeTop,!0),this._closeBottom=e.defaultValue(t.closeBottom,!0),this._polygonHierarchy=i,this._perPositionHeight=c,this._perPositionHeightExtrude=p,this._shadowVolume=e.defaultValue(t.shadowVolume,!1),this._workerName="createPolygonGeometry",this._offsetAttribute=t.offsetAttribute,this._arcType=e.defaultValue(t.arcType,C.ArcType.GEODESIC),this._rectangle=void 0,this._textureCoordinateRotationPoints=void 0,this.packedLength=T.PolygonGeometryLibrary.computeHierarchyPackedLength(i)+o.Ellipsoid.packedLength+f.VertexFormat.packedLength+12}ee.fromPositions=function(t){return new ee({polygonHierarchy:{positions:(t=e.defaultValue(t,e.defaultValue.EMPTY_OBJECT)).positions},height:t.height,extrudedHeight:t.extrudedHeight,vertexFormat:t.vertexFormat,stRotation:t.stRotation,ellipsoid:t.ellipsoid,granularity:t.granularity,perPositionHeight:t.perPositionHeight,closeTop:t.closeTop,closeBottom:t.closeBottom,offsetAttribute:t.offsetAttribute,arcType:t.arcType})},ee.pack=function(t,r,a){return a=e.defaultValue(a,0),a=T.PolygonGeometryLibrary.packPolygonHierarchy(t._polygonHierarchy,r,a),o.Ellipsoid.pack(t._ellipsoid,r,a),a+=o.Ellipsoid.packedLength,f.VertexFormat.pack(t._vertexFormat,r,a),a+=f.VertexFormat.packedLength,r[a++]=t._height,r[a++]=t._extrudedHeight,r[a++]=t._granularity,r[a++]=t._stRotation,r[a++]=t._perPositionHeightExtrude?1:0,r[a++]=t._perPositionHeight?1:0,r[a++]=t._closeTop?1:0,r[a++]=t._closeBottom?1:0,r[a++]=t._shadowVolume?1:0,r[a++]=e.defaultValue(t._offsetAttribute,-1),r[a++]=t._arcType,r[a]=t.packedLength,r};var te=o.Ellipsoid.clone(o.Ellipsoid.UNIT_SPHERE),re=new f.VertexFormat,oe={polygonHierarchy:{}};return ee.unpack=function(t,r,a){r=e.defaultValue(r,0);var i=T.PolygonGeometryLibrary.unpackPolygonHierarchy(t,r);r=i.startingIndex,delete i.startingIndex;var n=o.Ellipsoid.unpack(t,r,te);r+=o.Ellipsoid.packedLength;var s=f.VertexFormat.unpack(t,r,re);r+=f.VertexFormat.packedLength;var l=t[r++],u=t[r++],c=t[r++],p=t[r++],y=1===t[r++],m=1===t[r++],g=1===t[r++],d=1===t[r++],h=1===t[r++],b=t[r++],_=t[r++];return r=t[r],e.defined(a)||(a=new ee(oe)),a._polygonHierarchy=i,a._ellipsoid=o.Ellipsoid.clone(n,a._ellipsoid),a._vertexFormat=f.VertexFormat.clone(s,a._vertexFormat),a._height=l,a._extrudedHeight=u,a._granularity=c,a._stRotation=p,a._perPositionHeightExtrude=y,a._perPositionHeight=m,a._closeTop=g,a._closeBottom=d,a._shadowVolume=h,a._offsetAttribute=-1===b?void 0:b,a._arcType=_,a.packedLength=r,a},ee.computeRectangle=function(t,a){var i=e.defaultValue(t.granularity,r.CesiumMath.RADIANS_PER_DEGREE),n=e.defaultValue(t.arcType,C.ArcType.GEODESIC),s=t.polygonHierarchy;return t=e.defaultValue(t.ellipsoid,o.Ellipsoid.WGS84),Z(s.positions,t,n,i,a)},ee.createGeometry=function(t){var o=t._vertexFormat,i=t._ellipsoid,n=t._granularity,u=t._stRotation,c=t._polygonHierarchy,y=t._perPositionHeight,g=t._closeTop,d=t._closeBottom,f=t._arcType;if(!((I=c.positions).length<3)){var _=P.EllipsoidTangentPlane.fromPoints(I,i),v=(c=T.PolygonGeometryLibrary.polygonsFromHierarchy(c,_.projectPointsOntoPlane.bind(_),!y,i)).hierarchy,C=c.polygons;if(0!==v.length){I=v[0].outerRing;var w,I=T.PolygonGeometryLibrary.computeBoundingRectangle(_.plane.normal,_.projectPointOntoPlane.bind(_),I,u,G),A=[],E=t._height,O=t._extrudedHeight,V={perPositionHeight:y,vertexFormat:o,geometry:void 0,tangentPlane:_,boundingRectangle:I,ellipsoid:i,stRotation:u,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:f};if(t._perPositionHeightExtrude||!r.CesiumMath.equalsEpsilon(E,O,0,r.CesiumMath.EPSILON2))for(V.extrude=!0,V.top=g,V.bottom=d,V.shadowVolume=t._shadowVolume,V.offsetAttribute=t._offsetAttribute,w=0;w<C.length;w++){var F,D=function(e,t,r,o,a,i,n,s,l){var u={walls:[]};if(i||n){t=(C=T.PolygonGeometryLibrary.createGeometryFromPositions(e,t,r,a,s,l)).attributes.position.values;var c=C.indices;if(i&&n){var p,y=(i=t.concat(t)).length/3;(p=m.IndexDatatype.createTypedArray(y,2*c.length)).set(c);for(var g=c.length,d=y/2,h=0;h<g;h+=3){var f=p[h]+d,_=p[h+1]+d,v=p[h+2]+d;p[h+g]=v,p[h+1+g]=_,p[h+2+g]=f}C.attributes.position.values=i,a&&s.normal&&(s=C.attributes.normal.values,C.attributes.normal.values=new Float32Array(i.length),C.attributes.normal.values.set(s)),C.indices=p}else if(n){for(y=t.length/3,p=m.IndexDatatype.createTypedArray(y,c.length),h=0;h<c.length;h+=3)p[h]=c[h+2],p[h+1]=c[h+1],p[h+2]=c[h];C.indices=p}u.topAndBottom=new b.GeometryInstance({geometry:C})}var C=o.outerRing,w=P.EllipsoidTangentPlane.fromPoints(C,e).projectPointsOntoPlane(C,$);x.PolygonPipeline.computeWindingOrder2D(w)===x.WindingOrder.CLOCKWISE&&(C=C.slice().reverse());var I=T.PolygonGeometryLibrary.computeWallGeometry(C,e,r,a,l);u.walls.push(new b.GeometryInstance({geometry:I}));var A=o.holes;for(h=0;h<A.length;h++){var E=A[h];w=P.EllipsoidTangentPlane.fromPoints(E,e).projectPointsOntoPlane(E,$),x.PolygonPipeline.computeWindingOrder2D(w)===x.WindingOrder.COUNTER_CLOCKWISE&&(E=E.slice().reverse()),I=T.PolygonGeometryLibrary.computeWallGeometry(E,e,r,a,l),u.walls.push(new b.GeometryInstance({geometry:I}))}return u}(i,C[w],n,v[w],y,g,d,o,f);g&&d?(F=D.topAndBottom,V.geometry=T.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(F.geometry,E,O,i,y)):g?((F=D.topAndBottom).geometry.attributes.position.values=x.PolygonPipeline.scaleToGeodeticHeight(F.geometry.attributes.position.values,E,i,!y),V.geometry=F.geometry):d&&((F=D.topAndBottom).geometry.attributes.position.values=x.PolygonPipeline.scaleToGeodeticHeight(F.geometry.attributes.position.values,O,i,!0),V.geometry=F.geometry),(g||d)&&(V.wall=!1,F.geometry=U(V),A.push(F));var L=D.walls;V.wall=!0;for(var N=0;N<L.length;N++){var H=L[N];V.geometry=T.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(H.geometry,E,O,i,y),H.geometry=U(V),A.push(H)}}else for(w=0;w<C.length;w++){var R,M,S=new b.GeometryInstance({geometry:T.PolygonGeometryLibrary.createGeometryFromPositions(i,C[w],n,y,o,f)});S.geometry.attributes.position.values=x.PolygonPipeline.scaleToGeodeticHeight(S.geometry.attributes.position.values,E,i,!y),V.geometry=S.geometry,S.geometry=U(V),e.defined(t._offsetAttribute)&&(M=S.geometry.attributes.position.values.length,R=new Uint8Array(M/3),M=t._offsetAttribute===h.GeometryOffsetAttribute.NONE?0:1,h.arrayFill(R,M),S.geometry.attributes.applyOffset=new l.GeometryAttribute({componentDatatype:s.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:R})),A.push(S)}return(_=p.GeometryPipeline.combineInstances(A)[0]).attributes.position.values=new Float64Array(_.attributes.position.values),_.indices=m.IndexDatatype.createTypedArray(_.attributes.position.values.length/3,_.indices),I=_.attributes,u=a.BoundingSphere.fromVertices(I.position.values),o.position||delete I.position,new l.Geometry({attributes:I,indices:_.indices,primitiveType:_.primitiveType,boundingSphere:u,offsetAttribute:t._offsetAttribute})}}},ee.createShadowVolume=function(e,t,r){var o=e._granularity,a=e._ellipsoid;return t=t(o,a),r=r(o,a),new ee({polygonHierarchy:e._polygonHierarchy,ellipsoid:a,stRotation:e._stRotation,granularity:o,perPositionHeight:!1,extrudedHeight:t,height:r,vertexFormat:f.VertexFormat.POSITION_ONLY,shadowVolume:!0,arcType:e._arcType})},Object.defineProperties(ee.prototype,{rectangle:{get:function(){var t;return e.defined(this._rectangle)||(t=this._polygonHierarchy.positions,this._rectangle=Z(t,this._ellipsoid,this._arcType,this._granularity)),this._rectangle}},textureCoordinateRotationPoints:{get:function(){return e.defined(this._textureCoordinateRotationPoints)||(this._textureCoordinateRotationPoints=function(e){var t=-e._stRotation;if(0==t)return[0,0,0,1,1,0];var r=e._ellipsoid,o=e._polygonHierarchy.positions;return e=e.rectangle,l.Geometry._textureCoordinateRotationPoints(o,t,r,e)}(this)),this._textureCoordinateRotationPoints}}}),function(t,r){return e.defined(r)&&(t=ee.unpack(t,r)),t._ellipsoid=o.Ellipsoid.clone(t._ellipsoid),ee.createGeometry(t)}}));