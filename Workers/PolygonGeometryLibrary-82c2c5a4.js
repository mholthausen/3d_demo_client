define(["exports","./when-54c2dc71","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-6f81ad4c","./ComponentDatatype-6d99a1ee","./GeometryAttribute-700c1da0","./GeometryAttributes-4fcfcf40","./GeometryPipeline-e6a15a43","./IndexDatatype-53503fee","./arrayRemoveDuplicates-ebc732b0","./ArcType-dc1c5aee","./EllipsoidRhumbLine-c704bf4c","./PolygonPipeline-1aceedbc"],(function(e,t,r,i,n,a,o,s,u,l,c,h,f,p){"use strict";function d(){this._array=[],this._offset=0,this._length=0}Object.defineProperties(d.prototype,{length:{get:function(){return this._length}}}),d.prototype.enqueue=function(e){this._array.push(e),this._length++},d.prototype.dequeue=function(){if(0!==this._length){var e=this._array,t=this._offset,r=e[t];return e[t]=void 0,10<++t&&2*t>e.length&&(this._array=e.slice(t),t=0),this._offset=t,this._length--,r}},d.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]},d.prototype.contains=function(e){return-1!==this._array.indexOf(e)},d.prototype.clear=function(){this._array.length=this._offset=this._length=0},d.prototype.sort=function(e){0<this._offset&&(this._array=this._array.slice(this._offset),this._offset=0),this._array.sort(e)};var y={computeHierarchyPackedLength:function(e){for(var r=0,n=[e];0<n.length;){var a=n.pop();if(t.defined(a)){r+=2;var o=a.positions,s=a.holes;if(t.defined(o)&&(r+=o.length*i.Cartesian3.packedLength),t.defined(s))for(var u=s.length,l=0;l<u;++l)n.push(s[l])}}return r},packPolygonHierarchy:function(e,r,n){for(var a=[e];0<a.length;){var o=a.pop();if(t.defined(o)){var s=o.positions,u=o.holes;if(r[n++]=t.defined(s)?s.length:0,r[n++]=t.defined(u)?u.length:0,t.defined(s))for(var l=s.length,c=0;c<l;++c,n+=3)i.Cartesian3.pack(s[c],r,n);if(t.defined(u))for(var h=u.length,f=0;f<h;++f)a.push(u[f])}}return n},unpackPolygonHierarchy:function(e,t){for(var r=e[t++],n=e[t++],a=new Array(r),o=0<n?new Array(n):void 0,s=0;s<r;++s,t+=i.Cartesian3.packedLength)a[s]=i.Cartesian3.unpack(e,t);for(var u=0;u<n;++u)o[u]=y.unpackPolygonHierarchy(e,t),t=o[u].startingIndex,delete o[u].startingIndex;return{positions:a,holes:o,startingIndex:t}}},g=new i.Cartesian3;y.subdivideLineCount=function(e,t,n){return n=i.Cartesian3.distance(e,t)/n,n=Math.max(0,Math.ceil(r.CesiumMath.log2(n))),Math.pow(2,n)};var v=new i.Cartographic,m=new i.Cartographic,C=new i.Cartographic,b=new i.Cartesian3;y.subdivideRhumbLineCount=function(e,t,i,n){return t=e.cartesianToCartographic(t,v),i=e.cartesianToCartographic(i,m),n=new f.EllipsoidRhumbLine(t,i,e).surfaceDistance/n,n=Math.max(0,Math.ceil(r.CesiumMath.log2(n))),Math.pow(2,n)},y.subdivideLine=function(e,r,n,a){var o=y.subdivideLineCount(e,r,n),s=i.Cartesian3.distance(e,r),u=s/o;t.defined(a)||(a=[]);var l=a;l.length=3*o;for(var c,h,f,p=0,d=0;d<o;d++){var v=(v=e,c=r,h=d*u,f=s,i.Cartesian3.subtract(c,v,g),i.Cartesian3.multiplyByScalar(g,h/f,g),i.Cartesian3.add(v,g,g),[g.x,g.y,g.z]);l[p++]=v[0],l[p++]=v[1],l[p++]=v[2]}return l},y.subdivideRhumbLine=function(e,i,n,a,o){i=e.cartesianToCartographic(i,v),n=e.cartesianToCartographic(n,m);var s=new f.EllipsoidRhumbLine(i,n,e),u=(a=s.surfaceDistance/a,a=Math.max(0,Math.ceil(r.CesiumMath.log2(a))),Math.pow(2,a)),l=s.surfaceDistance/u;t.defined(o)||(o=[]);var c=o;c.length=3*u;for(var h=0,p=0;p<u;p++){var d=s.interpolateUsingSurfaceDistance(p*l,C);d=e.cartographicToCartesian(d,b),c[h++]=d.x,c[h++]=d.y,c[h++]=d.z}return c};var w=new i.Cartesian3,T=new i.Cartesian3,I=new i.Cartesian3,x=new i.Cartesian3;y.scaleToGeodeticHeightExtruded=function(e,r,n,a,o){a=t.defaultValue(a,i.Ellipsoid.WGS84);var s=w,u=T,l=I,c=x;if(t.defined(e)&&t.defined(e.attributes)&&t.defined(e.attributes.position))for(var h=e.attributes.position.values,f=h.length/2,p=0;p<f;p+=3)i.Cartesian3.fromArray(h,p,l),a.geodeticSurfaceNormal(l,s),c=a.scaleToGeodeticSurface(l,c),u=i.Cartesian3.multiplyByScalar(s,n,u),u=i.Cartesian3.add(c,u,u),h[p+f]=u.x,h[p+1+f]=u.y,h[p+2+f]=u.z,o&&(c=i.Cartesian3.clone(l,c)),u=i.Cartesian3.multiplyByScalar(s,r,u),u=i.Cartesian3.add(c,u,u),h[p]=u.x,h[p+1]=u.y,h[p+2]=u.z;return e},y.polygonOutlinesFromHierarchy=function(e,r,n){var a,o,s=[],u=new d;for(u.enqueue(e);0!==u.length;){var l=u.dequeue(),h=l.positions;if(r)for(o=h.length,p=0;p<o;p++)n.scaleToGeodeticSurface(h[p],h[p]);if(!((h=c.arrayRemoveDuplicates(h,i.Cartesian3.equalsEpsilon,!0)).length<3)){for(var f=l.holes?l.holes.length:0,p=0;p<f;p++){var y=l.holes[p],g=y.positions;if(r)for(o=g.length,a=0;a<o;++a)n.scaleToGeodeticSurface(g[a],g[a]);if(!((g=c.arrayRemoveDuplicates(g,i.Cartesian3.equalsEpsilon,!0)).length<3)){s.push(g);var v=0;for(t.defined(y.holes)&&(v=y.holes.length),a=0;a<v;a++)u.enqueue(y.holes[a])}}s.push(h)}}return s},y.polygonsFromHierarchy=function(e,r,n,a){var o=[],s=[],u=new d;for(u.enqueue(e);0!==u.length;){var l,h=u.dequeue(),f=h.positions,y=h.holes;if(n)for(l=f.length,T=0;T<l;T++)a.scaleToGeodeticSurface(f[T],f[T]);if(!((f=c.arrayRemoveDuplicates(f,i.Cartesian3.equalsEpsilon,!0)).length<3)){var g=r(f);if(t.defined(g)){var v=[];p.PolygonPipeline.computeWindingOrder2D(g)===p.WindingOrder.CLOCKWISE&&(g.reverse(),f=f.slice().reverse());for(var m,C=f.slice(),b=t.defined(y)?y.length:0,w=[],T=0;T<b;T++){var I=y[T],x=I.positions;if(n)for(l=x.length,m=0;m<l;++m)a.scaleToGeodeticSurface(x[m],x[m]);if(!((x=c.arrayRemoveDuplicates(x,i.Cartesian3.equalsEpsilon,!0)).length<3)){var E=r(x);if(t.defined(E)){p.PolygonPipeline.computeWindingOrder2D(E)===p.WindingOrder.CLOCKWISE&&(E.reverse(),x=x.slice().reverse()),w.push(x),v.push(C.length),C=C.concat(x),g=g.concat(E);var A=0;for(t.defined(I.holes)&&(A=I.holes.length),m=0;m<A;m++)u.enqueue(I.holes[m])}}}o.push({outerRing:f,holes:w}),s.push({positions:C,positions2D:g,holes:v})}}}return{hierarchy:o,polygons:s}};var E=new i.Cartesian2,A=new i.Cartesian3,P=new n.Quaternion,_=new n.Matrix3;y.computeBoundingRectangle=function(e,r,a,o,s){o=n.Quaternion.fromAxisAngle(e,o,P);for(var u=n.Matrix3.fromQuaternion(o,_),l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,h=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,p=a.length,d=0;d<p;++d){var y=i.Cartesian3.clone(a[d],A);n.Matrix3.multiplyByVector(u,y,y),y=r(y,E),t.defined(y)&&(l=Math.min(l,y.x),c=Math.max(c,y.x),h=Math.min(h,y.y),f=Math.max(f,y.y))}return s.x=l,s.y=h,s.width=c-l,s.height=f-h,s},y.createGeometryFromPositions=function(e,t,r,i,n,s){var l=p.PolygonPipeline.triangulate(t.positions2D,t.holes);l.length<3&&(l=[0,1,2]);var c=t.positions;if(i){for(var f=c.length,d=new Array(3*f),y=0,g=0;g<f;g++){var v=c[g];d[y++]=v.x,d[y++]=v.y,d[y++]=v.z}return i=new o.Geometry({attributes:{position:new o.GeometryAttribute({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:d})},indices:l,primitiveType:o.PrimitiveType.TRIANGLES}),n.normal?u.GeometryPipeline.computeNormal(i):i}return s===h.ArcType.GEODESIC?p.PolygonPipeline.computeSubdivision(e,c,l,r):s===h.ArcType.RHUMB?p.PolygonPipeline.computeRhumbLineSubdivision(e,c,l,r):void 0};var G=[],L=new i.Cartesian3,M=new i.Cartesian3;y.computeWallGeometry=function(e,t,n,u,c){var f,p,d,g=e.length,v=0;if(u)for(p=3*g*2,f=new Array(2*p),d=0;d<g;d++)w=e[d],T=e[(d+1)%g],f[v]=f[v+p]=w.x,f[++v]=f[v+p]=w.y,f[++v]=f[v+p]=w.z,f[++v]=f[v+p]=T.x,f[++v]=f[v+p]=T.y,f[++v]=f[v+p]=T.z,++v;else{var m=r.CesiumMath.chordLength(n,t.maximumRadius),C=0;if(c===h.ArcType.GEODESIC)for(d=0;d<g;d++)C+=y.subdivideLineCount(e[d],e[(d+1)%g],m);else if(c===h.ArcType.RHUMB)for(d=0;d<g;d++)C+=y.subdivideRhumbLineCount(t,e[d],e[(d+1)%g],m);for(p=3*(C+g),f=new Array(2*p),d=0;d<g;d++){var b,w=e[d],T=e[(d+1)%g];c===h.ArcType.GEODESIC?b=y.subdivideLine(w,T,m,G):c===h.ArcType.RHUMB&&(b=y.subdivideRhumbLine(t,w,T,m,G));for(var I=b.length,x=0;x<I;++x,++v)f[v]=b[x],f[v+p]=b[x];f[v]=T.x,f[v+p]=T.x,f[++v]=T.y,f[v+p]=T.y,f[++v]=T.z,f[v+p]=T.z,++v}}g=f.length;var E=l.IndexDatatype.createTypedArray(g/3,g-6*e.length),A=0;for(g/=6,d=0;d<g;d++){var P=d,_=P+1,D=P+g,S=D+1;w=i.Cartesian3.fromArray(f,3*P,L),T=i.Cartesian3.fromArray(f,3*_,M),i.Cartesian3.equalsEpsilon(w,T,r.CesiumMath.EPSILON10,r.CesiumMath.EPSILON10)||(E[A++]=P,E[A++]=D,E[A++]=_,E[A++]=_,E[A++]=D,E[A++]=S)}return new o.Geometry({attributes:new s.GeometryAttributes({position:new o.GeometryAttribute({componentDatatype:a.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:f})}),indices:E,primitiveType:o.PrimitiveType.TRIANGLES})},e.PolygonGeometryLibrary=y}));