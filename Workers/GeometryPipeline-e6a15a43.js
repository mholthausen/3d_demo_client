define(["exports","./when-54c2dc71","./Check-6c0211bc","./Math-fc8cecf5","./Cartesian2-bddc1162","./Transforms-6f81ad4c","./ComponentDatatype-6d99a1ee","./GeometryAttribute-700c1da0","./AttributeCompression-9fc99391","./EncodedCartesian3-4df2eabb","./IndexDatatype-53503fee","./IntersectionTests-7f3bcd5c","./Plane-b6058d9b"],(function(e,t,r,a,n,i,s,o,u,p,d,y,l){"use strict";var f=new n.Cartesian3,c=new n.Cartesian3,v=new n.Cartesian3,m=function(e){var r=(e=t.defaultValue(e,t.defaultValue.EMPTY_OBJECT)).indices,a=e.maximumIndex,n=t.defaultValue(e.cacheSize,24);function i(e,t,r,a,n,i,s){for(var o,u=-1,p=-1,d=0;d<r.length;){var y=r[d];a[y].numLiveTriangles&&(o=0,n-a[y].timeStamp+2*a[y].numLiveTriangles<=t&&(o=n-a[y].timeStamp),(p<o||-1===p)&&(p=o,u=y)),++d}return-1===u?function(e,t,r){for(;1<=t.length;){var a=t[t.length-1];if(t.splice(t.length-1,1),0<e[a].numLiveTriangles)return a}for(;h<r;){if(0<e[h].numLiveTriangles)return++h-1;++h}return-1}(a,i,s):u}e=r.length;var s=0,o=0,u=r[o],p=e;if(t.defined(a))s=a+1;else{for(;o<p;)s<u&&(s=u),u=r[++o];if(-1===s)return 0;++s}for(var d=[],y=0;y<s;y++)d[y]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};for(var l=o=0;o<p;)d[r[o]].vertexTriangles.push(l),++d[r[o]].numLiveTriangles,d[r[o+1]].vertexTriangles.push(l),++d[r[o+1]].numLiveTriangles,d[r[o+2]].vertexTriangles.push(l),++d[r[o+2]].numLiveTriangles,++l,o+=3;var f,c,v,m=0,C=n+1,h=1,b=[],g=[],A=0,T=[],x=e/3,P=[];for(y=0;y<x;y++)P[y]=!1;for(;-1!==m;){b=[],v=(f=d[m]).vertexTriangles.length;for(var w=0;w<v;++w)if(!P[l=f.vertexTriangles[w]]){P[l]=!0,o=l+l+l;for(var S=0;S<3;++S)c=r[o],b.push(c),g.push(c),T[A]=c,++A,--(c=d[c]).numLiveTriangles,C-c.timeStamp>n&&(c.timeStamp=C,++C),++o}m=i(0,n,b,d,C,g,s)}return T},C={};function h(e,t,r,a,n){e[t++]=r,e[t++]=a,e[t++]=a,e[t++]=n,e[t++]=n,e[t]=r}function b(e){var r,a,n={};for(r in e)e.hasOwnProperty(r)&&t.defined(e[r])&&t.defined(e[r].values)&&(a=e[r],n[r]=new o.GeometryAttribute({componentDatatype:a.componentDatatype,componentsPerAttribute:a.componentsPerAttribute,normalize:a.normalize,values:[]}));return n}C.toWireframe=function(e){var r=e.indices;if(t.defined(r)){switch(e.primitiveType){case o.PrimitiveType.TRIANGLES:e.indices=function(e){for(var t=e.length,r=t/3*6,a=d.IndexDatatype.createTypedArray(t,r),n=0,i=0;i<t;i+=3,n+=6)h(a,n,e[i],e[i+1],e[i+2]);return a}(r);break;case o.PrimitiveType.TRIANGLE_STRIP:e.indices=function(e){var t=e.length;if(3<=t){var r=6*(t-2),a=d.IndexDatatype.createTypedArray(t,r);h(a,0,e[0],e[1],e[2]);for(var n=6,i=3;i<t;++i,n+=6)h(a,n,e[i-1],e[i],e[i-2]);return a}return new Uint16Array}(r);break;case o.PrimitiveType.TRIANGLE_FAN:e.indices=function(e){if(0<e.length){for(var t=e.length-1,r=6*(t-1),a=d.IndexDatatype.createTypedArray(t,r),n=e[0],i=0,s=1;s<t;++s,i+=6)h(a,i,n,e[s],e[s+1]);return a}return new Uint16Array}(r)}e.primitiveType=o.PrimitiveType.LINES}return e},C.createLineSegmentsForVectors=function(e,r,a){r=t.defaultValue(r,"normal"),a=t.defaultValue(a,1e4);for(var n,u=e.attributes.position.values,p=e.attributes[r].values,d=u.length,y=new Float64Array(2*d),l=0,f=0;f<d;f+=3)y[l++]=u[f],y[l++]=u[f+1],y[l++]=u[f+2],y[l++]=u[f]+p[f]*a,y[l++]=u[f+1]+p[f+1]*a,y[l++]=u[f+2]+p[f+2]*a;return e=e.boundingSphere,t.defined(e)&&(n=new i.BoundingSphere(e.center,e.radius+a)),new o.Geometry({attributes:{position:new o.GeometryAttribute({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:y})},primitiveType:o.PrimitiveType.LINES,boundingSphere:n})},C.createAttributeLocations=function(e){for(var r,a=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],n=e.attributes,i={},s=0,o=a.length,u=0;u<o;++u){var p=a[u];t.defined(n[p])&&(i[p]=s++)}for(r in n)n.hasOwnProperty(r)&&!t.defined(i[r])&&(i[r]=s++);return i},C.reorderForPreVertexCache=function(e){var r=o.Geometry.computeNumberOfVertices(e),a=e.indices;if(t.defined(a)){for(var n=new Int32Array(r),i=0;i<r;i++)n[i]=-1;for(var u,p=a,y=p.length,l=d.IndexDatatype.createTypedArray(r,y),f=0,c=0,v=0;f<y;)-1!==(u=n[p[f]])?l[c]=u:(n[u=p[f]]=v,l[c]=v,++v),++f,++c;e.indices=l;var m,C=e.attributes;for(m in C)if(C.hasOwnProperty(m)&&t.defined(C[m])&&t.defined(C[m].values)){for(var h=C[m],b=h.values,g=0,A=h.componentsPerAttribute,T=s.ComponentDatatype.createTypedArray(h.componentDatatype,v*A);g<r;){var x=n[g];if(-1!==x)for(var P=0;P<A;P++)T[A*x+P]=b[A*g+P];++g}h.values=T}}return e},C.reorderForPostVertexCache=function(e,r){var a=e.indices;if(e.primitiveType===o.PrimitiveType.TRIANGLES&&t.defined(a)){for(var n=a.length,i=0,s=0;s<n;s++)a[s]>i&&(i=a[s]);e.indices=m({indices:a,maximumIndex:i,cacheSize:r})}return e},C.fitToUnsignedShortIndices=function(e){var r=[],n=o.Geometry.computeNumberOfVertices(e);if(t.defined(e.indices)&&n>=a.CesiumMath.SIXTY_FOUR_KILOBYTES){var i,s=[],u=[],p=0,d=b(e.attributes),y=e.indices,l=y.length;e.primitiveType===o.PrimitiveType.TRIANGLES?i=3:e.primitiveType===o.PrimitiveType.LINES?i=2:e.primitiveType===o.PrimitiveType.POINTS&&(i=1);for(var f=0;f<l;f+=i){for(var c=0;c<i;++c){var v=y[f+c],m=s[v];t.defined(m)||(m=p++,s[v]=m,function(e,r,a){for(var n in r)if(r.hasOwnProperty(n)&&t.defined(r[n])&&t.defined(r[n].values))for(var i=r[n],s=0;s<i.componentsPerAttribute;++s)e[n].values.push(i.values[a*i.componentsPerAttribute+s])}(d,e.attributes,v)),u.push(m)}p+i>=a.CesiumMath.SIXTY_FOUR_KILOBYTES&&(r.push(new o.Geometry({attributes:d,indices:u,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),s=[],u=[],p=0,d=b(e.attributes))}0!==u.length&&r.push(new o.Geometry({attributes:d,indices:u,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else r.push(e);return r};var g=new n.Cartesian3,A=new n.Cartographic;C.projectTo2D=function(e,r,a,u,p){for(var d=e.attributes[r],y=(p=t.defined(p)?p:new i.GeographicProjection).ellipsoid,l=d.values,f=new Float64Array(l.length),c=0,v=0;v<l.length;v+=3){var m=n.Cartesian3.fromArray(l,v,g);m=y.cartesianToCartographic(m,A),m=p.project(m,g),f[c++]=m.x,f[c++]=m.y,f[c++]=m.z}return e.attributes[a]=d,e.attributes[u]=new o.GeometryAttribute({componentDatatype:s.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:f}),delete e.attributes[r],e};var T={high:0,low:0};C.encodeAttribute=function(e,t,r,a){for(var n=e.attributes[t],i=n.values,u=i.length,d=new Float32Array(u),y=new Float32Array(u),l=0;l<u;++l)p.EncodedCartesian3.encode(i[l],T),d[l]=T.high,y[l]=T.low;return n=n.componentsPerAttribute,e.attributes[r]=new o.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:n,values:d}),e.attributes[a]=new o.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:n,values:y}),delete e.attributes[t],e};var x=new n.Cartesian3;function P(e,r){if(t.defined(r))for(var a=r.values,s=a.length,o=0;o<s;o+=3)n.Cartesian3.unpack(a,o,x),i.Matrix4.multiplyByPoint(e,x,x),n.Cartesian3.pack(x,a,o)}function w(e,r){if(t.defined(r))for(var a=r.values,s=a.length,o=0;o<s;o+=3)n.Cartesian3.unpack(a,o,x),i.Matrix3.multiplyByVector(e,x,x),x=n.Cartesian3.normalize(x,x),n.Cartesian3.pack(x,a,o)}var S=new i.Matrix4,I=new i.Matrix3;C.transformToWorldCoordinates=function(e){var r=e.modelMatrix;if(i.Matrix4.equals(r,i.Matrix4.IDENTITY))return e;var a=e.geometry.attributes;return P(r,a.position),P(r,a.prevPosition),P(r,a.nextPosition),(t.defined(a.normal)||t.defined(a.tangent)||t.defined(a.bitangent))&&(i.Matrix4.inverse(r,S),i.Matrix4.transpose(S,S),i.Matrix4.getMatrix3(S,I),w(I,a.normal),w(I,a.tangent),w(I,a.bitangent)),a=e.geometry.boundingSphere,t.defined(a)&&(e.geometry.boundingSphere=i.BoundingSphere.transform(a,r,a)),e.modelMatrix=i.Matrix4.clone(i.Matrix4.IDENTITY),e};var O=new n.Cartesian3;function E(e,r){var a,u,p,y,l,f=e.length,c=(e[0].modelMatrix,t.defined(e[0][r].indices)),v=e[0][r].primitiveType,m=function(e,r){var a,n=e.length,i={},u=e[0][r].attributes;for(a in u)if(u.hasOwnProperty(a)&&t.defined(u[a])&&t.defined(u[a].values)){for(var p=u[a],d=p.values.length,y=!0,l=1;l<n;++l){var f=e[l][r].attributes[a];if(!t.defined(f)||p.componentDatatype!==f.componentDatatype||p.componentsPerAttribute!==f.componentsPerAttribute||p.normalize!==f.normalize){y=!1;break}d+=f.values.length}y&&(i[a]=new o.GeometryAttribute({componentDatatype:p.componentDatatype,componentsPerAttribute:p.componentsPerAttribute,normalize:p.normalize,values:s.ComponentDatatype.createTypedArray(p.componentDatatype,d)}))}return i}(e,r);for(a in m)if(m.hasOwnProperty(a))for(p=m[a].values,h=w=0;h<f;++h)for(l=(y=e[h][r].attributes[a].values).length,u=0;u<l;++u)p[w++]=y[u];if(c){for(var C=0,h=0;h<f;++h)C+=e[h][r].indices.length;var b=o.Geometry.computeNumberOfVertices(new o.Geometry({attributes:m,primitiveType:o.PrimitiveType.POINTS})),g=d.IndexDatatype.createTypedArray(b,C),A=0,T=0;for(h=0;h<f;++h){for(var x=e[h][r].indices,P=x.length,w=0;w<P;++w)g[A++]=T+x[w];T+=o.Geometry.computeNumberOfVertices(e[h][r])}b=g}var S,I=new n.Cartesian3,E=0;for(h=0;h<f;++h){if(S=e[h][r].boundingSphere,!t.defined(S)){I=void 0;break}n.Cartesian3.add(S.center,I,I)}if(t.defined(I))for(n.Cartesian3.divideByScalar(I,f,I),h=0;h<f;++h){S=e[h][r].boundingSphere;var N=n.Cartesian3.magnitude(n.Cartesian3.subtract(S.center,I,O))+S.radius;E<N&&(E=N)}return new o.Geometry({attributes:m,indices:b,primitiveType:v,boundingSphere:t.defined(I)?new i.BoundingSphere(I,E):void 0})}C.combineInstances=function(e){for(var r=[],a=[],n=e.length,i=0;i<n;++i){var s=e[i];t.defined(s.geometry)?r.push(s):t.defined(s.westHemisphereGeometry)&&t.defined(s.eastHemisphereGeometry)&&a.push(s)}var o=[];return 0<r.length&&o.push(E(r,"geometry")),0<a.length&&(o.push(E(a,"westHemisphereGeometry")),o.push(E(a,"eastHemisphereGeometry"))),o};var N=new n.Cartesian3,L=new n.Cartesian3,z=new n.Cartesian3,D=new n.Cartesian3;C.computeNormal=function(e){for(var t=e.indices,r=e.attributes,i=r.position.values,u=r.position.values.length/3,p=t.length,d=new Array(u),y=new Array(p/3),l=new Array(p),f=0;f<u;f++)d[f]={indexOffset:0,count:0,currentCount:0};var c=0;for(f=0;f<p;f+=3){var v=t[f],m=t[f+1],C=t[f+2],h=3*v,b=3*m,g=3*C;L.x=i[h],L.y=i[1+h],L.z=i[2+h],z.x=i[b],z.y=i[1+b],z.z=i[2+b],D.x=i[g],D.y=i[1+g],D.z=i[2+g],d[v].count++,d[m].count++,d[C].count++,n.Cartesian3.subtract(z,L,z),n.Cartesian3.subtract(D,L,D),y[c]=n.Cartesian3.cross(z,D,new n.Cartesian3),c++}var A=0;for(f=0;f<u;f++)d[f].indexOffset+=A,A+=d[f].count;for(f=c=0;f<p;f+=3)l[(P=d[t[f]]).indexOffset+P.currentCount]=c,P.currentCount++,l[(P=d[t[f+1]]).indexOffset+P.currentCount]=c,P.currentCount++,l[(P=d[t[f+2]]).indexOffset+P.currentCount]=c,P.currentCount++,c++;var T=new Float32Array(3*u);for(f=0;f<u;f++){var x=3*f,P=d[f];if(n.Cartesian3.clone(n.Cartesian3.ZERO,N),0<P.count){for(c=0;c<P.count;c++)n.Cartesian3.add(N,y[l[P.indexOffset+c]],N);n.Cartesian3.equalsEpsilon(n.Cartesian3.ZERO,N,a.CesiumMath.EPSILON10)&&n.Cartesian3.clone(y[l[P.indexOffset]],N)}n.Cartesian3.equalsEpsilon(n.Cartesian3.ZERO,N,a.CesiumMath.EPSILON10)&&(N.z=1),n.Cartesian3.normalize(N,N),T[x]=N.x,T[1+x]=N.y,T[2+x]=N.z}return e.attributes.normal=new o.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:T}),e};var M=new n.Cartesian3,G=new n.Cartesian3,R=new n.Cartesian3;C.computeTangentAndBitangent=function(e){e.attributes;for(var t=e.indices,r=e.attributes.position.values,a=e.attributes.normal.values,i=e.attributes.st.values,u=e.attributes.position.values.length/3,p=t.length,d=new Array(3*u),y=0;y<d.length;y++)d[y]=0;for(y=0;y<p;y+=3){var l,f=t[y],c=3*(A=t[y+1]),v=3*(T=t[y+2]),m=2*f,C=2*A,h=2*T,b=r[l=3*f],g=r[l+1],A=r[l+2],T=i[m];f=i[1+m],m=i[1+C]-f,f=i[1+h]-f,T=1/((i[C]-T)*f-(i[h]-T)*m),b=(f*(r[c]-b)-m*(r[v]-b))*T,g=(f*(r[c+1]-g)-m*(r[v+1]-g))*T,T=(f*(r[c+2]-A)-m*(r[v+2]-A))*T,d[l]+=b,d[l+1]+=g,d[l+2]+=T,d[c]+=b,d[c+1]+=g,d[c+2]+=T,d[v]+=b,d[v+1]+=g,d[v+2]+=T}var x=new Float32Array(3*u),P=new Float32Array(3*u);for(y=0;y<u;y++){c=1+(l=3*y),v=l+2;var w=n.Cartesian3.fromArray(a,l,M),S=n.Cartesian3.fromArray(d,l,R),I=n.Cartesian3.dot(w,S);n.Cartesian3.multiplyByScalar(w,I,G),n.Cartesian3.normalize(n.Cartesian3.subtract(S,G,S),S),x[l]=S.x,x[c]=S.y,x[v]=S.z,n.Cartesian3.normalize(n.Cartesian3.cross(w,S,S),S),P[l]=S.x,P[c]=S.y,P[v]=S.z}return e.attributes.tangent=new o.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:x}),e.attributes.bitangent=new o.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:P}),e};var F=new n.Cartesian2,V=new n.Cartesian3,B=new n.Cartesian3,k=new n.Cartesian3,_=new n.Cartesian2;function q(e,t){Math.abs(e.y)<a.CesiumMath.EPSILON6&&(e.y=t?-a.CesiumMath.EPSILON6:a.CesiumMath.EPSILON6)}C.compressVertices=function(e){var r=e.attributes.extrudeDirection;if(t.defined(r)){for(var a=r.values,i=a.length/3,p=new Float32Array(2*i),d=0,y=0;y<i;++y)n.Cartesian3.fromArray(a,3*y,V),n.Cartesian3.equals(V,n.Cartesian3.ZERO)?d+=2:(_=u.AttributeCompression.octEncodeInRange(V,65535,_),p[d++]=_.x,p[d++]=_.y);return e.attributes.compressedAttributes=new o.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:p}),delete e.attributes.extrudeDirection,e}var l=e.attributes.normal,f=e.attributes.st,c=t.defined(l),v=t.defined(f);if(!c&&!v)return e;var m,C,h,b,g=e.attributes.tangent,A=(r=e.attributes.bitangent,t.defined(g)),T=t.defined(r);c&&(m=l.values),v&&(C=f.values),A&&(h=g.values),T&&(b=r.values),g=i=(c?m:C).length/(c?3:2),r=v&&c?2:1,g*=r+=A||T?1:0;var x=new Float32Array(g),P=0;for(y=0;y<i;++y){v&&(n.Cartesian2.fromArray(C,2*y,F),x[P++]=u.AttributeCompression.compressTextureCoordinates(F));var w=3*y;c&&t.defined(h)&&t.defined(b)?(n.Cartesian3.fromArray(m,w,V),n.Cartesian3.fromArray(h,w,B),n.Cartesian3.fromArray(b,w,k),u.AttributeCompression.octPack(V,B,k,F),x[P++]=F.x,x[P++]=F.y):(c&&(n.Cartesian3.fromArray(m,w,V),x[P++]=u.AttributeCompression.octEncodeFloat(V)),A&&(n.Cartesian3.fromArray(h,w,V),x[P++]=u.AttributeCompression.octEncodeFloat(V)),T&&(n.Cartesian3.fromArray(b,w,V),x[P++]=u.AttributeCompression.octEncodeFloat(V)))}return e.attributes.compressedAttributes=new o.GeometryAttribute({componentDatatype:s.ComponentDatatype.FLOAT,componentsPerAttribute:r,values:x}),c&&delete e.attributes.normal,v&&delete e.attributes.st,T&&delete e.attributes.bitangent,A&&delete e.attributes.tangent,e};var U=new n.Cartesian3;function Y(e,t,r,a){n.Cartesian3.add(e,n.Cartesian3.multiplyByScalar(n.Cartesian3.subtract(t,e,U),e.y/(e.y-t.y),U),r),n.Cartesian3.clone(r,a),q(r,!0),q(a,!1)}var Z=new n.Cartesian3,H=new n.Cartesian3,W=new n.Cartesian3,X=new n.Cartesian3,j={positions:new Array(7),indices:new Array(9)};function K(e,t,r){if(!(0<=e.x||0<=t.x||0<=r.x)){!function(e,t,r){if(0!==e.y&&0!==t.y&&0!==r.y)return q(e,e.y<0),q(t,t.y<0),q(r,r.y<0),0;var n=Math.abs(e.y),i=Math.abs(t.y),s=Math.abs(r.y);q(e,i=(i=i<n?s<n?a.CesiumMath.sign(e.y):a.CesiumMath.sign(r.y):s<i?a.CesiumMath.sign(t.y):a.CesiumMath.sign(r.y))<0),q(t,i),q(r,i)}(e,t,r);var n=e.y<0,i=t.y<0,s=r.y<0,o=0;o+=n?1:0,o+=i?1:0;var u=j.indices;return 1==(o+=s?1:0)?(u[1]=3,u[2]=4,u[5]=6,u[7]=6,u[8]=5,n?(Y(e,t,Z,W),Y(e,r,H,X),u[0]=0,u[3]=1,u[4]=2,u[6]=1):i?(Y(t,r,Z,W),Y(t,e,H,X),u[0]=1,u[3]=2,u[4]=0,u[6]=2):s&&(Y(r,e,Z,W),Y(r,t,H,X),u[0]=2,u[3]=0,u[4]=1,u[6]=0)):2==o&&(u[2]=4,u[4]=4,u[5]=3,u[7]=5,u[8]=6,n?i?s||(Y(r,e,Z,W),Y(r,t,H,X),u[0]=0,u[1]=1,u[3]=0,u[6]=2):(Y(t,r,Z,W),Y(t,e,H,X),u[0]=2,u[1]=0,u[3]=2,u[6]=1):(Y(e,t,Z,W),Y(e,r,H,X),u[0]=1,u[1]=2,u[3]=1,u[6]=0)),(u=j.positions)[0]=e,u[1]=t,u[2]=r,u.length=3,1!=o&&2!=o||(u[3]=Z,u[4]=H,u[5]=W,u[6]=X,u.length=7),j}}function J(e,r){var a,n=e.attributes;if(0!==n.position.values.length){for(var u in n)n.hasOwnProperty(u)&&t.defined(n[u])&&t.defined(n[u].values)&&((a=n[u]).values=s.ComponentDatatype.createTypedArray(a.componentDatatype,a.values));var p=o.Geometry.computeNumberOfVertices(e);return e.indices=d.IndexDatatype.createTypedArray(p,e.indices),r&&(e.boundingSphere=i.BoundingSphere.fromVertices(n.position.values)),e}}function Q(e){var r,a,n=e.attributes,i={};for(r in n)n.hasOwnProperty(r)&&t.defined(n[r])&&t.defined(n[r].values)&&(a=n[r],i[r]=new o.GeometryAttribute({componentDatatype:a.componentDatatype,componentsPerAttribute:a.componentsPerAttribute,normalize:a.normalize,values:[]}));return new o.Geometry({attributes:i,indices:[],primitiveType:e.primitiveType})}function $(e,r,a){var n=t.defined(e.geometry.boundingSphere);r=J(r,n),a=J(a,n),t.defined(a)&&!t.defined(r)?e.geometry=a:!t.defined(a)&&t.defined(r)?e.geometry=r:(e.westHemisphereGeometry=r,e.eastHemisphereGeometry=a,e.geometry=void 0)}function ee(e,t){var r=new e,a=new e,n=new e;return function(i,s,o,u,p,d,y,l){i=e.fromArray(p,i*t,r),s=e.fromArray(p,s*t,a),o=e.fromArray(p,o*t,n),e.multiplyByScalar(i,u.x,i),e.multiplyByScalar(s,u.y,s),e.multiplyByScalar(o,u.z,o),i=e.add(i,s,i),e.add(i,o,i),l&&e.normalize(i,i),e.pack(i,d,y*t)}}var te=ee(i.Cartesian4,4),re=ee(n.Cartesian3,3),ae=ee(n.Cartesian2,2),ne=new n.Cartesian3,ie=new n.Cartesian3,se=new n.Cartesian3,oe=new n.Cartesian3;function ue(e,r,i,s,o,u,p,d,y,l,m,C,h,b,g,A){if(t.defined(u)||t.defined(p)||t.defined(d)||t.defined(y)||t.defined(l)||0!==b){var T,x=function(e,r,i,s,o){var u,p,d,y,l,m,C;if(t.defined(o)||(o=new n.Cartesian3),t.defined(r.z)){if(n.Cartesian3.equalsEpsilon(e,r,a.CesiumMath.EPSILON14))return n.Cartesian3.clone(n.Cartesian3.UNIT_X,o);if(n.Cartesian3.equalsEpsilon(e,i,a.CesiumMath.EPSILON14))return n.Cartesian3.clone(n.Cartesian3.UNIT_Y,o);if(n.Cartesian3.equalsEpsilon(e,s,a.CesiumMath.EPSILON14))return n.Cartesian3.clone(n.Cartesian3.UNIT_Z,o);u=n.Cartesian3.subtract(i,r,f),p=n.Cartesian3.subtract(s,r,c),d=n.Cartesian3.subtract(e,r,v),y=n.Cartesian3.dot(u,u),h=n.Cartesian3.dot(u,p),l=n.Cartesian3.dot(u,d),m=n.Cartesian3.dot(p,p),C=n.Cartesian3.dot(p,d)}else{if(n.Cartesian2.equalsEpsilon(e,r,a.CesiumMath.EPSILON14))return n.Cartesian3.clone(n.Cartesian3.UNIT_X,o);if(n.Cartesian2.equalsEpsilon(e,i,a.CesiumMath.EPSILON14))return n.Cartesian3.clone(n.Cartesian3.UNIT_Y,o);if(n.Cartesian2.equalsEpsilon(e,s,a.CesiumMath.EPSILON14))return n.Cartesian3.clone(n.Cartesian3.UNIT_Z,o);u=n.Cartesian2.subtract(i,r,f),p=n.Cartesian2.subtract(s,r,c),d=n.Cartesian2.subtract(e,r,v),y=n.Cartesian2.dot(u,u),h=n.Cartesian2.dot(u,p),l=n.Cartesian2.dot(u,d),m=n.Cartesian2.dot(p,p),C=n.Cartesian2.dot(p,d)}o.y=m*l-h*C,o.z=y*C-h*l;var h=y*m-h*h;return 0!==o.y&&(o.y/=h),0!==o.z&&(o.z/=h),o.x=1-o.y-o.z,o}(s,n.Cartesian3.fromArray(o,3*e,ne),n.Cartesian3.fromArray(o,3*r,ie),n.Cartesian3.fromArray(o,3*i,se),oe);if(t.defined(u)&&re(e,r,i,x,u,C.normal.values,A,!0),t.defined(l)&&(o=n.Cartesian3.fromArray(l,3*e,ne),u=n.Cartesian3.fromArray(l,3*r,ie),l=n.Cartesian3.fromArray(l,3*i,se),n.Cartesian3.multiplyByScalar(o,x.x,o),n.Cartesian3.multiplyByScalar(u,x.y,u),n.Cartesian3.multiplyByScalar(l,x.z,l),n.Cartesian3.equals(o,n.Cartesian3.ZERO)&&n.Cartesian3.equals(u,n.Cartesian3.ZERO)&&n.Cartesian3.equals(l,n.Cartesian3.ZERO)?((T=ne).x=0,T.y=0,T.z=0):(T=n.Cartesian3.add(o,u,o),n.Cartesian3.add(T,l,T),n.Cartesian3.normalize(T,T)),n.Cartesian3.pack(T,C.extrudeDirection.values,3*A)),t.defined(m)&&function(e,t,r,n,i,s,o){e=i[e]*n.x,t=i[t]*n.y,n=i[r]*n.z,s[o]=e+t+n>a.CesiumMath.EPSILON6?1:0}(e,r,i,x,m,C.applyOffset.values,A),t.defined(p)&&re(e,r,i,x,p,C.tangent.values,A,!0),t.defined(d)&&re(e,r,i,x,d,C.bitangent.values,A,!0),t.defined(y)&&ae(e,r,i,x,y,C.st.values,A),0<b)for(var P=0;P<b;P++){var w=h[P];!function(e,t,r,a,n,i,s){var o=i.componentsPerAttribute,u=i.values,p=s.values;switch(o){case 4:te(e,t,r,a,u,p,n,!1);break;case 3:re(e,t,r,a,u,p,n,!1);break;case 2:ae(e,t,r,a,u,p,n,!1);break;default:p[n]=u[e]*a.x+u[t]*a.y+u[r]*a.z}}(e,r,i,x,A,g[w],C[w])}}}function pe(e,t,r,a,n,i){var s=e.position.values.length/3;return-1===n?(e.position.values.push(i.x,i.y,i.z),t.push(s),s):-1===(n=r[a=a[n]])?(r[a]=s,e.position.values.push(i.x,i.y,i.z),t.push(s),s):(t.push(n),n)}var de={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function ye(e){var r,a=e.geometry,i=a.attributes,s=i.position.values,o=t.defined(i.normal)?i.normal.values:void 0,u=t.defined(i.bitangent)?i.bitangent.values:void 0,p=t.defined(i.tangent)?i.tangent.values:void 0,d=t.defined(i.st)?i.st.values:void 0,y=t.defined(i.extrudeDirection)?i.extrudeDirection.values:void 0,l=t.defined(i.applyOffset)?i.applyOffset.values:void 0,f=a.indices,c=[];for(r in i)i.hasOwnProperty(r)&&!de[r]&&t.defined(i[r])&&c.push(r);var v,m,C=c.length,h=Q(a),b=Q(a),g=[];g.length=s.length/3;var A=[];for(A.length=s.length/3,x=0;x<g.length;++x)g[x]=-1,A[x]=-1;for(var T=f.length,x=0;x<T;x+=3){var P=f[x],w=f[x+1],S=f[x+2],I=n.Cartesian3.fromArray(s,3*P),O=n.Cartesian3.fromArray(s,3*w),E=n.Cartesian3.fromArray(s,3*S),N=K(I,O,E);if(t.defined(N)&&3<N.positions.length)for(var L=N.positions,z=N.indices,D=z.length,M=0;M<D;++M){var G=z[M],R=L[G],F=R.y<0?(v=b.attributes,m=b.indices,g):(v=h.attributes,m=h.indices,A);ue(P,w,S,R,s,o,p,u,d,y,l,v,c,C,i,pe(v,m,F,f,G<3?x+G:-1,R))}else t.defined(N)&&(I=N.positions[0],O=N.positions[1],E=N.positions[2]),F=I.y<0?(v=b.attributes,m=b.indices,g):(v=h.attributes,m=h.indices,A),ue(P,w,S,I,s,o,p,u,d,y,l,v,c,C,i,pe(v,m,F,f,x,I)),ue(P,w,S,O,s,o,p,u,d,y,l,v,c,C,i,pe(v,m,F,f,x+1,O)),ue(P,w,S,E,s,o,p,u,d,y,l,v,c,C,i,pe(v,m,F,f,x+2,E))}$(e,b,h)}var le=l.Plane.fromPointNormal(n.Cartesian3.ZERO,n.Cartesian3.UNIT_Y),fe=new n.Cartesian3,ce=new n.Cartesian3;function ve(e,r,i,s,o,u,p){t.defined(p)&&(s=n.Cartesian3.fromArray(s,3*e,ne),n.Cartesian3.equalsEpsilon(s,i,a.CesiumMath.EPSILON10)?u.applyOffset.values[o]=p[e]:u.applyOffset.values[o]=p[r])}function me(e){var r,i=e.geometry,s=i.attributes,o=s.position.values,u=t.defined(s.applyOffset)?s.applyOffset.values:void 0,p=i.indices,d=Q(i),l=Q(i),f=p.length,c=[];c.length=o.length/3;var v=[];for(v.length=o.length/3,r=0;r<c.length;++r)c[r]=-1,v[r]=-1;for(r=0;r<f;r+=2){var m=p[r],C=p[r+1],h=n.Cartesian3.fromArray(o,3*m,ne),b=n.Cartesian3.fromArray(o,3*C,ie);Math.abs(h.y)<a.CesiumMath.EPSILON6&&(h.y<0?h.y=-a.CesiumMath.EPSILON6:h.y=a.CesiumMath.EPSILON6),Math.abs(b.y)<a.CesiumMath.EPSILON6&&(b.y<0?b.y=-a.CesiumMath.EPSILON6:b.y=a.CesiumMath.EPSILON6);var g,A,T,x,P=d.attributes,w=d.indices,S=v,I=l.attributes,O=l.indices,E=c,N=y.IntersectionTests.lineSegmentPlane(h,b,le,se);t.defined(N)?(g=n.Cartesian3.multiplyByScalar(n.Cartesian3.UNIT_Y,5*a.CesiumMath.EPSILON9,fe),h.y<0&&(n.Cartesian3.negate(g,g),P=l.attributes,w=l.indices,S=c,I=d.attributes,O=d.indices,E=v),A=n.Cartesian3.add(N,g,ce),ve(m,C,h,o,pe(P,w,S,p,r,h),P,u),ve(m,C,A,o,pe(P,w,S,p,-1,A),P,u),n.Cartesian3.negate(g,g),n.Cartesian3.add(N,g,A),ve(m,C,A,o,pe(I,O,E,p,-1,A),I,u),ve(m,C,b,o,pe(I,O,E,p,r+1,b),I,u)):(I=h.y<0?(T=l.attributes,x=l.indices,c):(T=d.attributes,x=d.indices,v),ve(m,C,h,o,pe(T,x,I,p,r,h),T,u),ve(m,C,b,o,pe(T,x,I,p,r+1,b),T,u))}$(e,l,d)}var Ce=new n.Cartesian2,he=new n.Cartesian2,be=new n.Cartesian3,ge=new n.Cartesian3,Ae=new n.Cartesian3,Te=new n.Cartesian3,xe=new n.Cartesian3,Pe=new n.Cartesian3,we=new i.Cartesian4;function Se(e){for(var t=(e=e.attributes).position.values,r=e.prevPosition.values,a=e.nextPosition.values,i=t.length,s=0;s<i;s+=3){var o,u=n.Cartesian3.unpack(t,s,be);0<u.x||(o=n.Cartesian3.unpack(r,s,ge),(u.y<0&&0<o.y||0<u.y&&o.y<0)&&(0<s-3?(r[s]=t[s-3],r[s+1]=t[s-2],r[s+2]=t[s-1]):n.Cartesian3.pack(u,r,s)),o=n.Cartesian3.unpack(a,s,Ae),(u.y<0&&0<o.y||0<u.y&&o.y<0)&&(s+3<i?(a[s]=t[s+3],a[s+1]=t[s+4],a[s+2]=t[s+5]):n.Cartesian3.pack(u,a,s)))}}var Ie=5*a.CesiumMath.EPSILON9,Oe=a.CesiumMath.EPSILON6;C.splitLongitude=function(e){var r=e.geometry,s=r.boundingSphere;if(t.defined(s)&&(0<s.center.x-s.radius||i.BoundingSphere.intersectPlane(s,l.Plane.ORIGIN_ZX_PLANE)!==i.Intersect.INTERSECTING))return e;if(r.geometryType!==o.GeometryType.NONE)switch(r.geometryType){case o.GeometryType.POLYLINES:!function(e){for(var r=e.geometry,s=r.attributes,o=s.position.values,u=s.prevPosition.values,p=s.nextPosition.values,d=s.expandAndWidth.values,l=t.defined(s.st)?s.st.values:void 0,f=t.defined(s.color)?s.color.values:void 0,c=Q(r),v=Q(r),m=!1,C=o.length/3,h=0;h<C;h+=4){var b=h,g=h+2,A=n.Cartesian3.fromArray(o,3*b,be),T=n.Cartesian3.fromArray(o,3*g,ge);if(Math.abs(A.y)<Oe)for(A.y=Oe*(T.y<0?-1:1),o[3*h+1]=A.y,o[3*(h+1)+1]=A.y,D=3*b;D<3*b+12;D+=3)u[D]=o[3*h],u[D+1]=o[3*h+1],u[D+2]=o[3*h+2];if(Math.abs(T.y)<Oe)for(T.y=Oe*(A.y<0?-1:1),o[3*(h+2)+1]=T.y,o[3*(h+3)+1]=T.y,D=3*b;D<3*b+12;D+=3)p[D]=o[3*(h+2)],p[D+1]=o[3*(h+2)+1],p[D+2]=o[3*(h+2)+2];var x=c.attributes,P=c.indices,w=v.attributes,S=v.indices,I=y.IntersectionTests.lineSegmentPlane(A,T,le,Te);if(t.defined(I)){m=!0;var O=n.Cartesian3.multiplyByScalar(n.Cartesian3.UNIT_Y,Ie,xe);A.y<0&&(n.Cartesian3.negate(O,O),x=v.attributes,P=v.indices,w=c.attributes,S=c.indices);var E=n.Cartesian3.add(I,O,Pe);x.position.values.push(A.x,A.y,A.z,A.x,A.y,A.z),x.position.values.push(E.x,E.y,E.z),x.position.values.push(E.x,E.y,E.z),x.prevPosition.values.push(u[3*b],u[3*b+1],u[3*b+2]),x.prevPosition.values.push(u[3*b+3],u[3*b+4],u[3*b+5]),x.prevPosition.values.push(A.x,A.y,A.z,A.x,A.y,A.z),x.nextPosition.values.push(E.x,E.y,E.z),x.nextPosition.values.push(E.x,E.y,E.z),x.nextPosition.values.push(E.x,E.y,E.z),x.nextPosition.values.push(E.x,E.y,E.z),n.Cartesian3.negate(O,O),n.Cartesian3.add(I,O,E),w.position.values.push(E.x,E.y,E.z),w.position.values.push(E.x,E.y,E.z),w.position.values.push(T.x,T.y,T.z,T.x,T.y,T.z),w.prevPosition.values.push(E.x,E.y,E.z),w.prevPosition.values.push(E.x,E.y,E.z),w.prevPosition.values.push(E.x,E.y,E.z),w.prevPosition.values.push(E.x,E.y,E.z),w.nextPosition.values.push(T.x,T.y,T.z,T.x,T.y,T.z),w.nextPosition.values.push(p[3*g],p[3*g+1],p[3*g+2]),w.nextPosition.values.push(p[3*g+3],p[3*g+4],p[3*g+5]);var N=n.Cartesian2.fromArray(d,2*b,Ce),L=Math.abs(N.y);if(x.expandAndWidth.values.push(-1,L,1,L),x.expandAndWidth.values.push(-1,-L,1,-L),w.expandAndWidth.values.push(-1,L,1,L),w.expandAndWidth.values.push(-1,-L,1,-L),O=n.Cartesian3.magnitudeSquared(n.Cartesian3.subtract(I,A,Ae)),O/=n.Cartesian3.magnitudeSquared(n.Cartesian3.subtract(T,A,Ae)),t.defined(f)){E=i.Cartesian4.fromArray(f,4*b,we);for(var z=i.Cartesian4.fromArray(f,4*g,we),D=(N=a.CesiumMath.lerp(E.x,z.x,O),L=a.CesiumMath.lerp(E.y,z.y,O),I=a.CesiumMath.lerp(E.z,z.z,O),z=a.CesiumMath.lerp(E.w,z.w,O),4*b);D<4*b+8;++D)x.color.values.push(f[D]);for(x.color.values.push(N,L,I,z),x.color.values.push(N,L,I,z),w.color.values.push(N,L,I,z),w.color.values.push(N,L,I,z),D=4*g;D<4*g+8;++D)w.color.values.push(f[D])}if(t.defined(l)){z=n.Cartesian2.fromArray(l,2*b,Ce);var M=n.Cartesian2.fromArray(l,2*(h+3),he);for(O=a.CesiumMath.lerp(z.x,M.x,O),D=2*b;D<2*b+4;++D)x.st.values.push(l[D]);for(x.st.values.push(O,z.y),x.st.values.push(O,M.y),w.st.values.push(O,z.y),w.st.values.push(O,M.y),D=2*g;D<2*g+4;++D)w.st.values.push(l[D])}M=x.position.values.length/3-4,P.push(M,M+2,M+1),P.push(M+1,M+2,M+3),M=w.position.values.length/3-4,S.push(M,M+2,M+1),S.push(M+1,M+2,M+3)}else{var G;for(S=A.y<0?(G=v.attributes,v.indices):(G=c.attributes,c.indices),G.position.values.push(A.x,A.y,A.z),G.position.values.push(A.x,A.y,A.z),G.position.values.push(T.x,T.y,T.z),G.position.values.push(T.x,T.y,T.z),D=3*h;D<3*h+12;++D)G.prevPosition.values.push(u[D]),G.nextPosition.values.push(p[D]);for(D=2*h;D<2*h+8;++D)G.expandAndWidth.values.push(d[D]),t.defined(l)&&G.st.values.push(l[D]);if(t.defined(f))for(D=4*h;D<4*h+16;++D)G.color.values.push(f[D]);M=G.position.values.length/3-4,S.push(M,M+2,M+1),S.push(M+1,M+2,M+3)}}m&&(Se(v),Se(c)),$(e,v,c)}(e);break;case o.GeometryType.TRIANGLES:ye(e);break;case o.GeometryType.LINES:me(e)}else(function(e){switch(e.primitiveType){case o.PrimitiveType.TRIANGLE_FAN:return function(e){var t=o.Geometry.computeNumberOfVertices(e),r=d.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=1,r[1]=0,r[2]=2;for(var a=3,n=3;n<t;++n)r[a++]=n-1,r[a++]=0,r[a++]=n;return e.indices=r,e.primitiveType=o.PrimitiveType.TRIANGLES,e}(e);case o.PrimitiveType.TRIANGLE_STRIP:return function(e){var t=o.Geometry.computeNumberOfVertices(e),r=d.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=0,r[1]=1,r[2]=2,3<t&&(r[3]=0,r[4]=2,r[5]=3);for(var a=6,n=3;n<t-1;n+=2)r[a++]=n,r[a++]=n-1,r[a++]=n+1,n+2<t&&(r[a++]=n,r[a++]=n+1,r[a++]=n+2);return e.indices=r,e.primitiveType=o.PrimitiveType.TRIANGLES,e}(e);case o.PrimitiveType.TRIANGLES:return function(e){if(t.defined(e.indices))return e;for(var r=o.Geometry.computeNumberOfVertices(e),a=d.IndexDatatype.createTypedArray(r,r),n=0;n<r;++n)a[n]=n;return e.indices=a,e}(e);case o.PrimitiveType.LINE_STRIP:return function(e){var t=o.Geometry.computeNumberOfVertices(e),r=d.IndexDatatype.createTypedArray(t,2*(t-1));r[0]=0,r[1]=1;for(var a=2,n=2;n<t;++n)r[a++]=n-1,r[a++]=n;return e.indices=r,e.primitiveType=o.PrimitiveType.LINES,e}(e);case o.PrimitiveType.LINE_LOOP:return function(e){var t=o.Geometry.computeNumberOfVertices(e),r=d.IndexDatatype.createTypedArray(t,2*t);r[0]=0,r[1]=1;for(var a=2,n=2;n<t;++n)r[a++]=n-1,r[a++]=n;return r[a++]=t-1,r[a]=0,e.indices=r,e.primitiveType=o.PrimitiveType.LINES,e}(e);case o.PrimitiveType.LINES:(function(e){if(t.defined(e.indices))return e;for(var r=o.Geometry.computeNumberOfVertices(e),a=d.IndexDatatype.createTypedArray(r,r),n=0;n<r;++n)a[n]=n;e.indices=a})(e)}})(r),r.primitiveType===o.PrimitiveType.TRIANGLES?ye(e):r.primitiveType===o.PrimitiveType.LINES&&me(e);return e},e.GeometryPipeline=C}));