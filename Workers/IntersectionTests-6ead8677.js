define(["exports","./Cartesian2-49b1de22","./when-54c2dc71","./Check-6c0211bc","./Transforms-e9dbfb40","./Math-44e92d6b"],(function(a,t,e,r,n,i){"use strict";var s={};function o(a,t,e){var r=a+t;return i.CesiumMath.sign(a)!==i.CesiumMath.sign(t)&&Math.abs(r/Math.max(Math.abs(a),Math.abs(t)))<e?0:r}s.computeDiscriminant=function(a,t,e){return t*t-4*a*e},s.computeRealRoots=function(a,t,e){if(0===a)return 0===t?[]:[-e/t];if(0===t){if(0===e)return[0,0];var r=Math.abs(e),n=Math.abs(a);return r<n&&r/n<i.CesiumMath.EPSILON14?[0,0]:n<r&&n/r<i.CesiumMath.EPSILON14||(n=-e/a)<0?[]:[-(r=Math.sqrt(n)),r]}return 0===e?(n=-t/a)<0?[n,0]:[0,n]:(n=o(t*t,-4*a*e,i.CesiumMath.EPSILON14))<0?[]:(n=-.5*o(t,i.CesiumMath.sign(t)*Math.sqrt(n),i.CesiumMath.EPSILON14),0<t?[n/a,e/n]:[e/n,n/a])};var u={};function C(a,t,e,r){var n=t/3,i=e/3,s=(d=a)*i,o=n*(c=r);if((e=4*(m=d*i-(M=n*n))*(t=n*c-(h=i*i))-(a=d*c-n*i)*a)<0){r=s*h<=M*o?-2*n*(l=m)+(u=d)*a:-(u=c)*a+2*i*(l=t);var u=(u=(f=(C=-(r<0?-1:1)*Math.abs(u)*Math.sqrt(-e))-r)/2)<0?-Math.pow(-u,1/3):Math.pow(u,1/3),C=f===C?-u:-l/u;return C=l<=0?u+C:-r/(u*u+C*C+l),s*h<=M*o?[(C-n)/d]:[-c/(C+i)]}var c,l=m,h=(s=-2*n*m+d*a,t),M=-c*a+2*i*t,m=(o=Math.sqrt(e),Math.sqrt(3)/2),d=(a=Math.abs(Math.atan2(d*o,-s)/3),(s=2*n<(f=(C=2*Math.sqrt(-l))*(t=Math.cos(a)))+(e=C*(-t/2-m*Math.sin(a)))?f-n:e-n)/(l=d)),f=(a=Math.abs(Math.atan2(c*o,-M)/3),(c=-c)/(a=(f=(C=2*Math.sqrt(-h))*(t=Math.cos(a)))+(e=C*(-t/2-m*Math.sin(a)))<2*i?f+i:e+i));return d<=(a=(i*(e=-s*a-l*c)-n*(s*c))/(-n*e+i*(l*a)))?d<=f?a<=f?[d,a,f]:[d,f,a]:[f,d,a]:d<=f?[a,d,f]:a<=f?[a,f,d]:[f,a,d]}u.computeDiscriminant=function(a,t,e,r){var n=t*t,i=e*e;return 18*a*t*e*r+n*i-a*a*27*(r*r)-4*(a*i*e+n*t*r)},u.computeRealRoots=function(a,t,e,r){var n;if(0===a)return s.computeRealRoots(t,e,r);if(0!==t)return 0===e?0===r?(i=-t/a)<0?[i,0,0]:[0,0,i]:C(a,t,0,r):0===r?0===(n=s.computeRealRoots(a,t,e)).length?[0]:n[1]<=0?[n[0],n[1],0]:0<=n[0]?[0,n[0],n[1]]:[n[0],0,n[1]]:C(a,t,e,r);if(0!==e)return 0===r?0===(n=s.computeRealRoots(a,0,e)).Length?[0]:[n[0],0,n[1]]:C(a,0,e,r);if(0===r)return[0,0,0];var i=(i=-r/a)<0?-Math.pow(-i,1/3):Math.pow(i,1/3);return[i,i,i]};var c={};function l(a,t,e,r){var n=a*a,o=t-3*n/8,C=e-t*a/2+n*a/8;if(r=r-e*a/4+t*n/16-3*n*n/256,0<(e=u.computeRealRoots(1,2*o,o*o-4*r,-C*C)).length){if(t=-a/4,n=e[e.length-1],Math.abs(n)<i.CesiumMath.EPSILON14){if(2===(a=s.computeRealRoots(1,o,r)).length){e=a[0];var c=a[1];if(0<=e&&0<=c)return r=Math.sqrt(e),[t-(a=Math.sqrt(c)),t-r,t+r,t+a];if(0<=e&&c<0)return[t-(l=Math.sqrt(e)),t+l];if(e<0&&0<=c)return[t-(l=Math.sqrt(c)),t+l]}return[]}if(0<n){var l=(o+n-C/(c=Math.sqrt(n)))/2;return C=(o+n+C/c)/2,l=s.computeRealRoots(1,c,l),C=s.computeRealRoots(1,-c,C),0!==l.length?(l[0]+=t,l[1]+=t,0!==C.length?(C[0]+=t,C[1]+=t,l[1]<=C[0]?[l[0],l[1],C[0],C[1]]:C[1]<=l[0]?[C[0],C[1],l[0],l[1]]:l[0]>=C[0]&&l[1]<=C[1]?[C[0],l[0],l[1],C[1]]:C[0]>=l[0]&&C[1]<=l[1]?[l[0],C[0],C[1],l[1]]:l[0]>C[0]&&l[0]<C[1]?[C[0],l[0],C[1],l[1]]:[l[0],C[0],l[1],C[1]]):l):0!==C.length?(C[0]+=t,C[1]+=t,C):[]}}return[]}function h(a,t,e,r){var n=-2*t,o=e*a+t*t-4*r,C=(f=a*a)*r-e*t*a+e*e;if(0<(d=u.computeRealRoots(1,n,o,C)).length){var c,l,h,M,m=d[0],d=(C=a/2,(n=t-m)/2),f=(t=(o=n*n)-4*r,n=o+4*Math.abs(r),o=f-4*m,f+4*Math.abs(m));l=m<0||t*f<o*n?(c=(o=Math.sqrt(o))/2,0===o?0:(a*d-e)/o):(c=0===(l=Math.sqrt(t))?0:(a*d-e)/l,l/2),0==C&&0===c?M=h=0:i.CesiumMath.sign(C)===i.CesiumMath.sign(c)?M=m/(h=C+c):h=m/(M=C-c),0==d&&0===l?p=g=0:i.CesiumMath.sign(d)===i.CesiumMath.sign(l)?p=r/(g=d+l):g=r/(p=d-l);var g=s.computeRealRoots(1,h,g),p=s.computeRealRoots(1,M,p);if(0!==g.length)return 0!==p.length?g[1]<=p[0]?[g[0],g[1],p[0],p[1]]:p[1]<=g[0]?[p[0],p[1],g[0],g[1]]:g[0]>=p[0]&&g[1]<=p[1]?[p[0],g[0],g[1],p[1]]:p[0]>=g[0]&&p[1]<=g[1]?[g[0],p[0],p[1],g[1]]:g[0]>p[0]&&g[0]<p[1]?[p[0],g[0],p[1],g[1]]:[g[0],p[0],g[1],p[1]]:g;if(0!==p.length)return p}return[]}function M(a,r){r=t.Cartesian3.clone(e.defaultValue(r,t.Cartesian3.ZERO)),t.Cartesian3.equals(r,t.Cartesian3.ZERO)||t.Cartesian3.normalize(r,r),this.origin=t.Cartesian3.clone(e.defaultValue(a,t.Cartesian3.ZERO)),this.direction=r}c.computeDiscriminant=function(a,t,e,r,n){var i=a*a,s=t*t,o=s*t,u=e*e,C=u*e,c=r*r,l=c*r,h=n*n;return s*u*c-4*o*l-4*a*C*c+18*a*t*e*l-27*i*c*c+i*a*256*(h*n)+n*(18*o*e*r-4*s*C+16*a*u*u-80*a*t*u*r-6*a*s*c+144*i*e*c)+h*(144*a*s*e-27*s*s-128*i*u-192*i*t*r)},c.computeRealRoots=function(a,t,e,r,n){if(Math.abs(a)<i.CesiumMath.EPSILON15)return u.computeRealRoots(t,e,r,n);var s=t/a,o=e/a,C=r/a,c=n/a;switch(a=s<0?1:0,a+=o<0?a+1:a,a+=C<0?a+1:a,a+=c<0?a+1:a){case 0:return l(s,o,C,c);case 1:case 2:return h(s,o,C,c);case 3:case 4:return l(s,o,C,c);case 5:return h(s,o,C,c);case 6:case 7:return l(s,o,C,c);case 8:return h(s,o,C,c);case 9:case 10:return l(s,o,C,c);case 11:return h(s,o,C,c);case 12:case 13:case 14:case 15:return l(s,o,C,c);default:return}},M.clone=function(a,r){if(e.defined(a))return e.defined(r)?(r.origin=t.Cartesian3.clone(a.origin),r.direction=t.Cartesian3.clone(a.direction),r):new M(a.origin,a.direction)},M.getPoint=function(a,r,n){return e.defined(n)||(n=new t.Cartesian3),n=t.Cartesian3.multiplyByScalar(a.direction,r,n),t.Cartesian3.add(a.origin,n,n)};var m={rayPlane:function(a,r,n){e.defined(n)||(n=new t.Cartesian3);var s=a.origin,o=a.direction,u=r.normal;if(a=t.Cartesian3.dot(u,o),!(Math.abs(a)<i.CesiumMath.EPSILON15||(a=(-r.distance-t.Cartesian3.dot(u,s))/a)<0))return n=t.Cartesian3.multiplyByScalar(o,a,n),t.Cartesian3.add(s,n,n)}},d=new t.Cartesian3,f=new t.Cartesian3,g=new t.Cartesian3,p=new t.Cartesian3,v=new t.Cartesian3;m.rayTriangleParametric=function(a,r,n,s,o){o=e.defaultValue(o,!1);var u,C,c,l=a.origin,h=a.direction,M=t.Cartesian3.subtract(n,r,d);if(a=t.Cartesian3.subtract(s,r,f),n=t.Cartesian3.cross(h,a,g),s=t.Cartesian3.dot(M,n),o){if(s<i.CesiumMath.EPSILON6)return;if(w=t.Cartesian3.subtract(l,r,p),(m=t.Cartesian3.dot(w,n))<0||s<m)return;if(u=t.Cartesian3.cross(w,M,v),(C=t.Cartesian3.dot(h,u))<0||s<m+C)return;c=t.Cartesian3.dot(a,u)/s}else{if(Math.abs(s)<i.CesiumMath.EPSILON6)return;s=1/s;var m,w=t.Cartesian3.subtract(l,r,p);if((m=t.Cartesian3.dot(w,n)*s)<0||1<m)return;if(u=t.Cartesian3.cross(w,M,v),(C=t.Cartesian3.dot(h,u)*s)<0||1<m+C)return;c=t.Cartesian3.dot(a,u)*s}return c},m.rayTriangle=function(a,r,n,i,s,o){if(s=m.rayTriangleParametric(a,r,n,i,s),e.defined(s)&&!(s<0))return e.defined(o)||(o=new t.Cartesian3),t.Cartesian3.multiplyByScalar(a.direction,s,o),t.Cartesian3.add(a.origin,o,o)};var w=new M;m.lineSegmentTriangle=function(a,r,n,i,s,o,u){var C=w;if(t.Cartesian3.clone(a,C.origin),t.Cartesian3.subtract(r,a,C.direction),t.Cartesian3.normalize(C.direction,C.direction),o=m.rayTriangleParametric(C,n,i,s,o),!(!e.defined(o)||o<0||o>t.Cartesian3.distance(a,r)))return e.defined(u)||(u=new t.Cartesian3),t.Cartesian3.multiplyByScalar(C.direction,o,u),t.Cartesian3.add(C.origin,u,u)};var R={root0:0,root1:0};function S(a,r,i){e.defined(i)||(i=new n.Interval);var s=a.origin,o=a.direction;if(a=r.center,r=r.radius*r.radius,a=t.Cartesian3.subtract(s,a,g),r=function(a,t,e,r){if(!((i=t*t-4*a*e)<0)){if(0<i){var n=1/(2*a),i=(-t+(e=Math.sqrt(i)))*n;return i<(n*=-t-e)?(r.root0=i,r.root1=n):(r.root0=n,r.root1=i),r}if(0!=(a=-t/(2*a)))return r.root0=r.root1=a,r}}(t.Cartesian3.dot(o,o),2*t.Cartesian3.dot(o,a),t.Cartesian3.magnitudeSquared(a)-r,R),e.defined(r))return i.start=r.root0,i.stop=r.root1,i}m.raySphere=function(a,t,r){if(r=S(a,t,r),e.defined(r)&&!(r.stop<0))return r.start=Math.max(r.start,0),r};var O=new M;m.lineSegmentSphere=function(a,r,n,i){var s=O;if(t.Cartesian3.clone(a,s.origin),r=t.Cartesian3.subtract(r,a,s.direction),a=t.Cartesian3.magnitude(r),t.Cartesian3.normalize(r,r),i=S(s,n,i),!(!e.defined(i)||i.stop<0||i.start>a))return i.start=Math.max(i.start,0),i.stop=Math.min(i.stop,a),i};var x=new t.Cartesian3,y=new t.Cartesian3;function P(a,t,e){var r=a+t;return i.CesiumMath.sign(a)!==i.CesiumMath.sign(t)&&Math.abs(r/Math.max(Math.abs(a),Math.abs(t)))<e?0:r}m.rayEllipsoid=function(a,e){var r,i,s=e.oneOverRadii,o=t.Cartesian3.multiplyComponents(s,a.origin,x);if(e=t.Cartesian3.multiplyComponents(s,a.direction,y),s=t.Cartesian3.magnitudeSquared(o),a=t.Cartesian3.dot(o,e),1<s){if(0<=a)return;var u,C,c=s-1;if((o=a*a)<(C=(u=t.Cartesian3.magnitudeSquared(e))*c))return;if(C<o){r=a*a-C;var l=(i=-a+Math.sqrt(r))/u;return l<(o=c/i)?new n.Interval(l,o):{start:o,stop:l}}return l=Math.sqrt(c/u),new n.Interval(l,l)}return s<1?(c=s-1,r=a*a-(C=(u=t.Cartesian3.magnitudeSquared(e))*c),i=-a+Math.sqrt(r),new n.Interval(0,i/u)):a<0?(u=t.Cartesian3.magnitudeSquared(e),new n.Interval(0,-a/u)):void 0};var b=new t.Cartesian3,N=new t.Cartesian3,q=new t.Cartesian3,L=new t.Cartesian3,I=new t.Cartesian3,E=new n.Matrix3,z=new n.Matrix3,T=new n.Matrix3,U=new n.Matrix3,W=new n.Matrix3,B=new n.Matrix3,V=new n.Matrix3,Z=new t.Cartesian3,A=new t.Cartesian3,D=new t.Cartographic;m.grazingAltitudeLocation=function(a,r){var o=a.origin,u=a.direction;if(!t.Cartesian3.equals(o,t.Cartesian3.ZERO)){var C=r.geodeticSurfaceNormal(o,b);if(0<=t.Cartesian3.dot(u,C))return o}var l=e.defined(this.rayEllipsoid(a,r)),h=r.transformPositionToScaledSpace(u,b),M=(C=t.Cartesian3.normalize(h,h),a=t.Cartesian3.mostOrthogonalAxis(h,L),h=t.Cartesian3.normalize(t.Cartesian3.cross(a,C,N),N),a=t.Cartesian3.normalize(t.Cartesian3.cross(C,h,q),q),E);M[0]=C.x,M[1]=C.y,M[2]=C.z,M[3]=h.x,M[4]=h.y,M[5]=h.z,M[6]=a.x,M[7]=a.y,M[8]=a.z,C=n.Matrix3.transpose(M,z);var m=n.Matrix3.fromScale(r.radii,T);h=n.Matrix3.fromScale(r.oneOverRadii,U),(a=W)[0]=0,a[1]=-u.z,a[2]=u.y,a[3]=u.z,a[4]=0,a[5]=-u.x,a[6]=-u.y,a[7]=u.x,a[8]=0,h=n.Matrix3.multiply(n.Matrix3.multiply(C,h,B),a,B),a=n.Matrix3.multiply(n.Matrix3.multiply(h,m,V),M,V),h=n.Matrix3.multiplyByVector(h,o,I);var d,f=function(a,e,r,o,u){var C,l=1*(a[n.Matrix3.COLUMN1ROW1]-a[n.Matrix3.COLUMN2ROW2]),h=1*(0*P(a[n.Matrix3.COLUMN1ROW0],a[n.Matrix3.COLUMN0ROW1],i.CesiumMath.EPSILON15)+e.y),M=0*a[n.Matrix3.COLUMN0ROW0]+1*a[n.Matrix3.COLUMN2ROW2]+0*e.x+0,m=1*P(a[n.Matrix3.COLUMN2ROW1],a[n.Matrix3.COLUMN1ROW2],i.CesiumMath.EPSILON15),d=1*(0*P(a[n.Matrix3.COLUMN2ROW0],a[n.Matrix3.COLUMN0ROW2])+e.z),f=[];if(0==d&&0==m){if(0===(C=s.computeRealRoots(l,h,M)).length)return f;var g=C[0],p=Math.sqrt(Math.max(1-g*g,0));return f.push(new t.Cartesian3(0,1*g,1*-p)),f.push(new t.Cartesian3(0,1*g,1*p)),2===C.length&&(v=C[1],w=Math.sqrt(Math.max(1-v*v,0)),f.push(new t.Cartesian3(0,1*v,1*-w)),f.push(new t.Cartesian3(0,1*v,1*w))),f}var v=l*l+(g=m*m),w=2*(h*l+(p=d*m));if(g=2*M*l+h*h-g+(e=d*d),p=2*(M*h-p),e=M*M-e,0==v&&0==w&&0==g&&0==p)return f;var R=(C=c.computeRealRoots(v,w,g,p,e)).length;if(0===R)return f;for(var S=0;S<R;++S){var O=C[S],x=O*O,y=Math.max(1-x,0);y=Math.sqrt(y),(x=(x=i.CesiumMath.sign(l)===i.CesiumMath.sign(M)?P(l*x+M,h*O,i.CesiumMath.EPSILON12):i.CesiumMath.sign(M)===i.CesiumMath.sign(h*O)?P(l*x,h*O+M,i.CesiumMath.EPSILON12):P(l*x+h*O,M,i.CesiumMath.EPSILON12))*P(m*O,d,i.CesiumMath.EPSILON15))<0?f.push(new t.Cartesian3(0,1*O,1*y)):0<x?f.push(new t.Cartesian3(0,1*O,1*-y)):0!==y?(f.push(new t.Cartesian3(0,1*O,1*-y)),f.push(new t.Cartesian3(0,1*O,1*y)),++S):f.push(new t.Cartesian3(0,1*O,1*y))}return f}(a,t.Cartesian3.negate(h,b)),g=f.length;if(0<g){for(var p=t.Cartesian3.clone(t.Cartesian3.ZERO,A),v=Number.NEGATIVE_INFINITY,w=0;w<g;++w){d=n.Matrix3.multiplyByVector(m,n.Matrix3.multiplyByVector(M,f[w],Z),Z);var R=t.Cartesian3.normalize(t.Cartesian3.subtract(d,o,L),L);v<(R=t.Cartesian3.dot(R,u))&&(v=R,p=t.Cartesian3.clone(d,p))}return a=r.cartesianToCartographic(p,D),v=i.CesiumMath.clamp(v,0,1),h=t.Cartesian3.magnitude(t.Cartesian3.subtract(p,o,L))*Math.sqrt(1-v*v),h=l?-h:h,a.height=h,r.cartographicToCartesian(a,new t.Cartesian3)}};var k=new t.Cartesian3;m.lineSegmentPlane=function(a,r,n,s){e.defined(s)||(s=new t.Cartesian3);var o=t.Cartesian3.subtract(r,a,k),u=n.normal;if(r=t.Cartesian3.dot(u,o),!(Math.abs(r)<i.CesiumMath.EPSILON6||(u=t.Cartesian3.dot(u,a),(r=-(n.distance+u)/r)<0||1<r)))return t.Cartesian3.multiplyByScalar(o,r,s),t.Cartesian3.add(a,s,s),s},m.trianglePlaneIntersection=function(a,e,r,n){var i,s,o=n.normal,u=n.distance,C=t.Cartesian3.dot(o,a)+u<0,c=t.Cartesian3.dot(o,e)+u<0;if(o=t.Cartesian3.dot(o,r)+u<0,u=0,u+=C?1:0,u+=c?1:0,1!=(u+=o?1:0)&&2!=u||(i=new t.Cartesian3,s=new t.Cartesian3),1==u){if(C)return m.lineSegmentPlane(a,e,n,i),m.lineSegmentPlane(a,r,n,s),{positions:[a,e,r,i,s],indices:[0,3,4,1,2,4,1,4,3]};if(c)return m.lineSegmentPlane(e,r,n,i),m.lineSegmentPlane(e,a,n,s),{positions:[a,e,r,i,s],indices:[1,3,4,2,0,4,2,4,3]};if(o)return m.lineSegmentPlane(r,a,n,i),m.lineSegmentPlane(r,e,n,s),{positions:[a,e,r,i,s],indices:[2,3,4,0,1,4,0,4,3]}}else if(2==u){if(!C)return m.lineSegmentPlane(e,a,n,i),m.lineSegmentPlane(r,a,n,s),{positions:[a,e,r,i,s],indices:[1,2,4,1,4,3,0,3,4]};if(!c)return m.lineSegmentPlane(r,e,n,i),m.lineSegmentPlane(a,e,n,s),{positions:[a,e,r,i,s],indices:[2,0,4,2,4,3,1,3,4]};if(!o)return m.lineSegmentPlane(a,r,n,i),m.lineSegmentPlane(e,r,n,s),{positions:[a,e,r,i,s],indices:[0,1,4,0,4,3,2,3,4]}}},a.IntersectionTests=m,a.Ray=M}));